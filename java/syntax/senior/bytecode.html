<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.15" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://x.app/java/syntax/senior/bytecode.html"><meta property="og:site_name" content="ventix"><meta property="og:title" content="虚拟机字节码"><meta property="og:description" content="Java字节码是Java程序在编译后的中间表示形式，它由JVM解释执行或即时编译为机器码。理解和操作字节码可以让我们更深入地了解Java程序的执行过程，同时也提供了在运行时修改和优化代码的强大工具。通过使用像ASM这样的库，开发人员可以获得对字节码级细节的完全控制，从而实现更高级别的代码定制和优化。 Java字节码 javac/javap 当使用jav..."><meta property="og:type" content="article"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2025-01-10T15:19:41.000Z"><meta property="article:author" content="ventixy"><meta property="article:modified_time" content="2025-01-10T15:19:41.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"虚拟机字节码","image":[""],"dateModified":"2025-01-10T15:19:41.000Z","author":[{"@type":"Person","name":"ventixy","url":"https://www.ventix.top"}]}</script><link rel="icon" href="/jav.ico"><title>虚拟机字节码 | ventix</title><meta name="description" content="Java字节码是Java程序在编译后的中间表示形式，它由JVM解释执行或即时编译为机器码。理解和操作字节码可以让我们更深入地了解Java程序的执行过程，同时也提供了在运行时修改和优化代码的强大工具。通过使用像ASM这样的库，开发人员可以获得对字节码级细节的完全控制，从而实现更高级别的代码定制和优化。 Java字节码 javac/javap 当使用jav...">
    <link rel="preload" href="/assets/style-DlWEdz0Y.css" as="style"><link rel="stylesheet" href="/assets/style-DlWEdz0Y.css">
    <link rel="modulepreload" href="/assets/app-BPJY8eZI.js"><link rel="modulepreload" href="/assets/bytecode.html-DZNT3igw.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-Dr4aNeV-.js" as="script"><link rel="prefetch" href="/assets/blog.html-B0ZoDgKY.js" as="script"><link rel="prefetch" href="/assets/intro.html-BETJRSoQ.js" as="script"><link rel="prefetch" href="/assets/index.html-B6G9Ngow.js" as="script"><link rel="prefetch" href="/assets/index.html-Zk9F9v5O.js" as="script"><link rel="prefetch" href="/assets/资源分享.html-CGfFfRVj.js" as="script"><link rel="prefetch" href="/assets/index.html-Ivwf1K9U.js" as="script"><link rel="prefetch" href="/assets/index.html-hEXS_Ko8.js" as="script"><link rel="prefetch" href="/assets/Gradle.html-mgA_7BCG.js" as="script"><link rel="prefetch" href="/assets/index.html-UdDtM60c.js" as="script"><link rel="prefetch" href="/assets/maven.html-CWetsKzQ.js" as="script"><link rel="prefetch" href="/assets/theme.html-CsW-FeqY.js" as="script"><link rel="prefetch" href="/assets/index.html-CZI45nzf.js" as="script"><link rel="prefetch" href="/assets/index.html-CcY9MOzL.js" as="script"><link rel="prefetch" href="/assets/index.html-BxjcUcCH.js" as="script"><link rel="prefetch" href="/assets/mybatis.html-D7BZio4L.js" as="script"><link rel="prefetch" href="/assets/mysql.html-BLrGixQT.js" as="script"><link rel="prefetch" href="/assets/redis.html-B6JESWr4.js" as="script"><link rel="prefetch" href="/assets/security.html-CWZSxVvD.js" as="script"><link rel="prefetch" href="/assets/spring.html-RQFORqZK.js" as="script"><link rel="prefetch" href="/assets/springboot.html-CuxH7b-1.js" as="script"><link rel="prefetch" href="/assets/index.html-WaM-Umho.js" as="script"><link rel="prefetch" href="/assets/base.html-BDZjGHUS.js" as="script"><link rel="prefetch" href="/assets/collect.html-Cn6rbeUy.js" as="script"><link rel="prefetch" href="/assets/concurrency.html-776c1IZv.js" as="script"><link rel="prefetch" href="/assets/jvm.html-CnfBlfWZ.js" as="script"><link rel="prefetch" href="/assets/index.html-DNJQ12c9.js" as="script"><link rel="prefetch" href="/assets/es.html-DcyWyOQZ.js" as="script"><link rel="prefetch" href="/assets/rocketmq.html-t-eF-JnU.js" as="script"><link rel="prefetch" href="/assets/sys.html-Ciraw5dl.js" as="script"><link rel="prefetch" href="/assets/index.html-BGSI31Pe.js" as="script"><link rel="prefetch" href="/assets/index.html-5ltqIlcy.js" as="script"><link rel="prefetch" href="/assets/index.html-CsclGuiM.js" as="script"><link rel="prefetch" href="/assets/index.html-C9PsQhQU.js" as="script"><link rel="prefetch" href="/assets/index.html-DF0lF6pq.js" as="script"><link rel="prefetch" href="/assets/picgo.html-Cs30SpIw.js" as="script"><link rel="prefetch" href="/assets/website.html-BvZIoLvy.js" as="script"><link rel="prefetch" href="/assets/index.html-Cc7JYx_m.js" as="script"><link rel="prefetch" href="/assets/encoding.html-C00judjy.js" as="script"><link rel="prefetch" href="/assets/index.html-kE8A9K7H.js" as="script"><link rel="prefetch" href="/assets/mysql-binlog.html-DKIcAqCE.js" as="script"><link rel="prefetch" href="/assets/mysql-lock.html-C0t8xery.js" as="script"><link rel="prefetch" href="/assets/mysql.html-D146a4Ko.js" as="script"><link rel="prefetch" href="/assets/index.html-DcZHHUu7.js" as="script"><link rel="prefetch" href="/assets/env.html-DbNP9WK_.js" as="script"><link rel="prefetch" href="/assets/history.html-B18xwhKS.js" as="script"><link rel="prefetch" href="/assets/jar.html-DktK_6xe.js" as="script"><link rel="prefetch" href="/assets/index.html-eAUDrKQ-.js" as="script"><link rel="prefetch" href="/assets/k8s.html-DnQEU9rj.js" as="script"><link rel="prefetch" href="/assets/ks-install.html-BhuH34yX.js" as="script"><link rel="prefetch" href="/assets/linux.html-k6It6Gob.js" as="script"><link rel="prefetch" href="/assets/vm.html-sUmRHyBE.js" as="script"><link rel="prefetch" href="/assets/index.html-C98xQSCu.js" as="script"><link rel="prefetch" href="/assets/springboot.html-B59MLE0C.js" as="script"><link rel="prefetch" href="/assets/index.html-YoEkrkOw.js" as="script"><link rel="prefetch" href="/assets/index.html-KpodSCWp.js" as="script"><link rel="prefetch" href="/assets/begin.html-CH4A0uKe.js" as="script"><link rel="prefetch" href="/assets/index.html-BfgGnq5n.js" as="script"><link rel="prefetch" href="/assets/index.html-C_Naa-aq.js" as="script"><link rel="prefetch" href="/assets/index.html-CE-UIyU1.js" as="script"><link rel="prefetch" href="/assets/pywin32.html-BlnpYFtr.js" as="script"><link rel="prefetch" href="/assets/index.html-Dwr--Wej.js" as="script"><link rel="prefetch" href="/assets/damb.html-CFEME9d0.js" as="script"><link rel="prefetch" href="/assets/sd.html-B5rFLq-6.js" as="script"><link rel="prefetch" href="/assets/yolo.html-DhBchOHT.js" as="script"><link rel="prefetch" href="/assets/index.html-C9xWXv2V.js" as="script"><link rel="prefetch" href="/assets/env.html-ByaaT1jU.js" as="script"><link rel="prefetch" href="/assets/Linux.html-Btki-PNS.js" as="script"><link rel="prefetch" href="/assets/index.html-DDTP2nOq.js" as="script"><link rel="prefetch" href="/assets/shell.html-CqcDfo2L.js" as="script"><link rel="prefetch" href="/assets/vim.html-CGK2IK4K.js" as="script"><link rel="prefetch" href="/assets/Docker.html-DrXUJ9Tk.js" as="script"><link rel="prefetch" href="/assets/index.html-BRIQlFNO.js" as="script"><link rel="prefetch" href="/assets/index.html-DPOse6eh.js" as="script"><link rel="prefetch" href="/assets/git.html-CV334KeL.js" as="script"><link rel="prefetch" href="/assets/gitlab.html-BagsAmvZ.js" as="script"><link rel="prefetch" href="/assets/jenkins.html-6VKntS7y.js" as="script"><link rel="prefetch" href="/assets/index.html-jrv241lr.js" as="script"><link rel="prefetch" href="/assets/idea.html-BEoamvvB.js" as="script"><link rel="prefetch" href="/assets/mac.html-CU61WPFU.js" as="script"><link rel="prefetch" href="/assets/windows.html-CUNSy5vE.js" as="script"><link rel="prefetch" href="/assets/index.html-C17xnN6R.js" as="script"><link rel="prefetch" href="/assets/index.html-CdS_qG1C.js" as="script"><link rel="prefetch" href="/assets/index.html-3zfBlo2D.js" as="script"><link rel="prefetch" href="/assets/index.html-CSKIg9qb.js" as="script"><link rel="prefetch" href="/assets/Architecture.html-CsDd_KU0.js" as="script"><link rel="prefetch" href="/assets/index.html-DKwaQOvJ.js" as="script"><link rel="prefetch" href="/assets/Transaction.html-BaFAjN75.js" as="script"><link rel="prefetch" href="/assets/mysql-index.html-CtKitAk6.js" as="script"><link rel="prefetch" href="/assets/redis-java.html-BkhsnGzk.js" as="script"><link rel="prefetch" href="/assets/redis.html-BUKgPsrf.js" as="script"><link rel="prefetch" href="/assets/sql.html-HhWqGFlZ.js" as="script"><link rel="prefetch" href="/assets/Hibernate.html--PrZRwIC.js" as="script"><link rel="prefetch" href="/assets/index.html-DAWL4ugA.js" as="script"><link rel="prefetch" href="/assets/generator.html-BNLMtOQY.js" as="script"><link rel="prefetch" href="/assets/mybatis-resource.html-B4OVikgE.js" as="script"><link rel="prefetch" href="/assets/mybatis.html-D4nkeAuB.js" as="script"><link rel="prefetch" href="/assets/tk-mybatis.html-iV0LnqXX.js" as="script"><link rel="prefetch" href="/assets/index.html-F2o7Wjgz.js" as="script"><link rel="prefetch" href="/assets/Servlet.html-B4ddwpEc.js" as="script"><link rel="prefetch" href="/assets/http.html-BiyVnKN0.js" as="script"><link rel="prefetch" href="/assets/jsp.html-CBAsa3ec.js" as="script"><link rel="prefetch" href="/assets/mvc.html-i2meXMkR.js" as="script"><link rel="prefetch" href="/assets/nginx.html-BTWxg_Ah.js" as="script"><link rel="prefetch" href="/assets/tomcat.html-Dv4XLiTK.js" as="script"><link rel="prefetch" href="/assets/index.html-Cnl52Jqs.js" as="script"><link rel="prefetch" href="/assets/crossDomain.html-xdNsVhBS.js" as="script"><link rel="prefetch" href="/assets/excel.html-DrvMlLlV.js" as="script"><link rel="prefetch" href="/assets/log.html-UMv5g12U.js" as="script"><link rel="prefetch" href="/assets/shiro.html-BPT_4Be_.js" as="script"><link rel="prefetch" href="/assets/index.html-DPlGZUao.js" as="script"><link rel="prefetch" href="/assets/design.html-D-48lQh4.js" as="script"><link rel="prefetch" href="/assets/life.html-j89aWDwP.js" as="script"><link rel="prefetch" href="/assets/mvc-core.html-D1RsbgHx.js" as="script"><link rel="prefetch" href="/assets/sec.html-BoqRw4Hm.js" as="script"><link rel="prefetch" href="/assets/spring.html-CsQWrLoz.js" as="script"><link rel="prefetch" href="/assets/springboot.html-DYhdgyy6.js" as="script"><link rel="prefetch" href="/assets/springmvc.html-Dv34JOX8.js" as="script"><link rel="prefetch" href="/assets/transaction.html-XRbm9AO2.js" as="script"><link rel="prefetch" href="/assets/index.html-D2H1YpGn.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ.html-DFrbAKVm.js" as="script"><link rel="prefetch" href="/assets/RockMQ.html-CVFL3qfa.js" as="script"><link rel="prefetch" href="/assets/Sentinel.html-ThfoAbxD.js" as="script"><link rel="prefetch" href="/assets/dubbo.html-C8EMLEz3.js" as="script"><link rel="prefetch" href="/assets/es.html-DpCyxWpD.js" as="script"><link rel="prefetch" href="/assets/eureka.html-D-ELwZkQ.js" as="script"><link rel="prefetch" href="/assets/gateway.html-B6vu6L7I.js" as="script"><link rel="prefetch" href="/assets/hystrix.html-D5pYizf7.js" as="script"><link rel="prefetch" href="/assets/kafka.html-C70_cu2x.js" as="script"><link rel="prefetch" href="/assets/nacos.html-BtTZk13u.js" as="script"><link rel="prefetch" href="/assets/zookeeper.html-gX9ew5GN.js" as="script"><link rel="prefetch" href="/assets/index.html-rTq0UeUs.js" as="script"><link rel="prefetch" href="/assets/cron.html-TXU--INY.js" as="script"><link rel="prefetch" href="/assets/db.html-DJgD48m-.js" as="script"><link rel="prefetch" href="/assets/dup.html-DCNay48h.js" as="script"><link rel="prefetch" href="/assets/lock.html-Bg5JgwVx.js" as="script"><link rel="prefetch" href="/assets/redis.html-cvqfq3bp.js" as="script"><link rel="prefetch" href="/assets/transac.html-3ITHifNG.js" as="script"><link rel="prefetch" href="/assets/walk.html-BmH-vKhr.js" as="script"><link rel="prefetch" href="/assets/HashMap源码分析.html-C-z5FuUl.js" as="script"><link rel="prefetch" href="/assets/Java基础.html-BXAAmoLD.js" as="script"><link rel="prefetch" href="/assets/Java常用类库.html-DwxAR92e.js" as="script"><link rel="prefetch" href="/assets/Java面向对象.html-N1LrNCTM.js" as="script"><link rel="prefetch" href="/assets/index.html-Da5cP1Vq.js" as="script"><link rel="prefetch" href="/assets/collection.html-DU6BheMV.js" as="script"><link rel="prefetch" href="/assets/generics.html-s7SYtUuT.js" as="script"><link rel="prefetch" href="/assets/javaIO.html-4AnqAdOg.js" as="script"><link rel="prefetch" href="/assets/set和map.html-B_mV6Q6w.js" as="script"><link rel="prefetch" href="/assets/数组和字符串.html-JN84niIN.js" as="script"><link rel="prefetch" href="/assets/index.html-kNAdt2f8.js" as="script"><link rel="prefetch" href="/assets/netty.html-DtbNB0dp.js" as="script"><link rel="prefetch" href="/assets/nio.html-BgIlcDdR.js" as="script"><link rel="prefetch" href="/assets/socket.html-C6e3lyOB.js" as="script"><link rel="prefetch" href="/assets/theory.html-BFwwme01.js" as="script"><link rel="prefetch" href="/assets/Annotation.html-CdHMjSvk.js" as="script"><link rel="prefetch" href="/assets/Enum.html-DlaNnsIM.js" as="script"><link rel="prefetch" href="/assets/Jvm内存管理.html-KYdLzV9u.js" as="script"><link rel="prefetch" href="/assets/Jvm类加载.html-BswTaF72.js" as="script"><link rel="prefetch" href="/assets/Lambda.html-BZ5f94HP.js" as="script"><link rel="prefetch" href="/assets/index.html-DJY00PkQ.js" as="script"><link rel="prefetch" href="/assets/Reflection.html-BpZKCy5U.js" as="script"><link rel="prefetch" href="/assets/Stream.html-BoC-tQPX.js" as="script"><link rel="prefetch" href="/assets/pt.html-DCAIHfZp.js" as="script"><link rel="prefetch" href="/assets/index.html-DwEznv6e.js" as="script"><link rel="prefetch" href="/assets/lock.html-CVlvtQ9U.js" as="script"><link rel="prefetch" href="/assets/pool.html-DE6yNxLp.js" as="script"><link rel="prefetch" href="/assets/thread.html-DVsdRotZ.js" as="script"><link rel="prefetch" href="/assets/tool.html-BH0GsuDS.js" as="script"><link rel="prefetch" href="/assets/index.html-KdoE871Y.js" as="script"><link rel="prefetch" href="/assets/base.html-DpN9PsvJ.js" as="script"><link rel="prefetch" href="/assets/numpy.html-DJcN0PiS.js" as="script"><link rel="prefetch" href="/assets/opencv.html-3kD5x8DL.js" as="script"><link rel="prefetch" href="/assets/pillow.html-B13n5VwX.js" as="script"><link rel="prefetch" href="/assets/python.html-Ca1XPqqK.js" as="script"><link rel="prefetch" href="/assets/index.html-Bskq4w9a.js" as="script"><link rel="prefetch" href="/assets/base.html-BgcPL660.js" as="script"><link rel="prefetch" href="/assets/data.html-BN5A8qUV.js" as="script"><link rel="prefetch" href="/assets/file.html-DOrR2QH3.js" as="script"><link rel="prefetch" href="/assets/function.html-B-8_0RFR.js" as="script"><link rel="prefetch" href="/assets/oop.html-SPJFQpPu.js" as="script"><link rel="prefetch" href="/assets/index.html-BEIzVuqT.js" as="script"><link rel="prefetch" href="/assets/numpy.html-B20v1cqd.js" as="script"><link rel="prefetch" href="/assets/pandas.html-Dl4Pf8Z1.js" as="script"><link rel="prefetch" href="/assets/index.html-DzFTI7_O.js" as="script"><link rel="prefetch" href="/assets/css.html-D8VkHcJn.js" as="script"><link rel="prefetch" href="/assets/css2.html-C1iziCTA.js" as="script"><link rel="prefetch" href="/assets/css3.html-YJk1iRII.js" as="script"><link rel="prefetch" href="/assets/css4.html-C-YNukgd.js" as="script"><link rel="prefetch" href="/assets/index.html-mjYEeNg5.js" as="script"><link rel="prefetch" href="/assets/html.html-BDcI1T84.js" as="script"><link rel="prefetch" href="/assets/html5.html-CfBn_n_C.js" as="script"><link rel="prefetch" href="/assets/index.html-CSpNTBGM.js" as="script"><link rel="prefetch" href="/assets/dom.html-1sWWeJUp.js" as="script"><link rel="prefetch" href="/assets/es6.html-CDJqzoPZ.js" as="script"><link rel="prefetch" href="/assets/js.html-DwG8v8ch.js" as="script"><link rel="prefetch" href="/assets/js2.html-CppGoDgA.js" as="script"><link rel="prefetch" href="/assets/index.html-CINsYmWW.js" as="script"><link rel="prefetch" href="/assets/ts.html-DSs1ybsJ.js" as="script"><link rel="prefetch" href="/assets/ts2.html-rXzCOvUW.js" as="script"><link rel="prefetch" href="/assets/index.html-C2bx6ulR.js" as="script"><link rel="prefetch" href="/assets/react.html-CclOsgKL.js" as="script"><link rel="prefetch" href="/assets/ui.html-DE-cDZat.js" as="script"><link rel="prefetch" href="/assets/vue.html-BxqaCBPM.js" as="script"><link rel="prefetch" href="/assets/index.html-B3PQwlJd.js" as="script"><link rel="prefetch" href="/assets/build.html-CJUB9JhY.js" as="script"><link rel="prefetch" href="/assets/format.html-BJaw0h73.js" as="script"><link rel="prefetch" href="/assets/node.html-Dnvjr-yN.js" as="script"><link rel="prefetch" href="/assets/index.html-BMhycyrI.js" as="script"><link rel="prefetch" href="/assets/index.html-MiVGQn9N.js" as="script"><link rel="prefetch" href="/assets/index.html-Csq64GH8.js" as="script"><link rel="prefetch" href="/assets/baz.html-C2BC_mQa.js" as="script"><link rel="prefetch" href="/assets/index.html-CK4t-NCp.js" as="script"><link rel="prefetch" href="/assets/ray.html-CS0LIH1-.js" as="script"><link rel="prefetch" href="/assets/404.html-DWSzjapY.js" as="script"><link rel="prefetch" href="/assets/index.html-B--rOBkI.js" as="script"><link rel="prefetch" href="/assets/index.html-BVOAtSZc.js" as="script"><link rel="prefetch" href="/assets/index.html-gNaN7QaW.js" as="script"><link rel="prefetch" href="/assets/index.html-CnSYy-BD.js" as="script"><link rel="prefetch" href="/assets/index.html-CB7uKe8_.js" as="script"><link rel="prefetch" href="/assets/index.html-D2mhbfXu.js" as="script"><link rel="prefetch" href="/assets/index.html-DDij0IAa.js" as="script"><link rel="prefetch" href="/assets/index.html-Bni-vQtn.js" as="script"><link rel="prefetch" href="/assets/index.html-pMFnOjtg.js" as="script"><link rel="prefetch" href="/assets/index.html-CCupsihm.js" as="script"><link rel="prefetch" href="/assets/index.html-CtLPyPRF.js" as="script"><link rel="prefetch" href="/assets/index.html-CRMsVlx8.js" as="script"><link rel="prefetch" href="/assets/index.html-Eqn6Hl3B.js" as="script"><link rel="prefetch" href="/assets/index.html-BzhVr3Uy.js" as="script"><link rel="prefetch" href="/assets/index.html-CGEVQB6M.js" as="script"><link rel="prefetch" href="/assets/index.html-Dr5OFk9G.js" as="script"><link rel="prefetch" href="/assets/index.html-CGEVQB6M.js" as="script"><link rel="prefetch" href="/assets/index.html-BzR6_34R.js" as="script"><link rel="prefetch" href="/assets/index.html-C-c26yhl.js" as="script"><link rel="prefetch" href="/assets/index.html-B088mKIv.js" as="script"><link rel="prefetch" href="/assets/index.html-DyfMD-HX.js" as="script"><link rel="prefetch" href="/assets/index.html-h064vCoO.js" as="script"><link rel="prefetch" href="/assets/index.html-CaLpUjM2.js" as="script"><link rel="prefetch" href="/assets/index.html-CM-nESWT.js" as="script"><link rel="prefetch" href="/assets/index.html-C6GuafNU.js" as="script"><link rel="prefetch" href="/assets/index.html-CACzn0Jq.js" as="script"><link rel="prefetch" href="/assets/index.html-S8gHAR_g.js" as="script"><link rel="prefetch" href="/assets/index.html-Ck99-_GQ.js" as="script"><link rel="prefetch" href="/assets/index.html-BCwe8fhS.js" as="script"><link rel="prefetch" href="/assets/index.html-Yq8GGbtK.js" as="script"><link rel="prefetch" href="/assets/index.html-BAxIeknU.js" as="script"><link rel="prefetch" href="/assets/index.html-C36FFRaK.js" as="script"><link rel="prefetch" href="/assets/index.html-DKZzueeP.js" as="script"><link rel="prefetch" href="/assets/index.html-DCtvHceC.js" as="script"><link rel="prefetch" href="/assets/index.html-DJREh_fa.js" as="script"><link rel="prefetch" href="/assets/index.html-DReYwts0.js" as="script"><link rel="prefetch" href="/assets/index.html-Glja-nyv.js" as="script"><link rel="prefetch" href="/assets/index.html-wTDRVLKS.js" as="script"><link rel="prefetch" href="/assets/index.html-4KWh4QL5.js" as="script"><link rel="prefetch" href="/assets/index.html-CHv58dH_.js" as="script"><link rel="prefetch" href="/assets/index.html-DI45RWG0.js" as="script"><link rel="prefetch" href="/assets/index.html-Cu5cPk_S.js" as="script"><link rel="prefetch" href="/assets/index.html-cvrb7D7t.js" as="script"><link rel="prefetch" href="/assets/index.html-CV889rcZ.js" as="script"><link rel="prefetch" href="/assets/index.html-C3ZpiYFz.js" as="script"><link rel="prefetch" href="/assets/index.html-DZSRFzay.js" as="script"><link rel="prefetch" href="/assets/index.html-DI45RWG0.js" as="script"><link rel="prefetch" href="/assets/index.html-hD055yzF.js" as="script"><link rel="prefetch" href="/assets/index.html-CUZs5EwZ.js" as="script"><link rel="prefetch" href="/assets/index.html-vIksoghd.js" as="script"><link rel="prefetch" href="/assets/giscus-B3IT9xos.js" as="script"><link rel="prefetch" href="/assets/flowchart-CAFN9Lqb.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-BIpcuheA.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-CMg0yb1C.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">ventix</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/blog.html" aria-label="Blog"><!--[--><span class="font-icon icon iconfont icon-blog" style=""></span><!--]-->Blog<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/java/" aria-label="Java"><!--[--><span class="font-icon icon iconfont icon-java" style=""></span><!--]-->Java<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/project/" aria-label="Project"><!--[--><span class="font-icon icon iconfont icon-app" style=""></span><!--]-->Project<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/web/" aria-label="Web"><!--[--><span class="font-icon icon iconfont icon-net" style=""></span><!--]-->Web<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/python/" aria-label="Python"><!--[--><span class="font-icon icon iconfont icon-python" style=""></span><!--]-->Python<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Other"><!--[--><span class="font-icon icon iconfont icon-project" style=""></span>Other<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/interview/" aria-label="Java面试题库"><!--[--><span class="font-icon icon iconfont icon-java" style=""></span><!--]-->Java面试题库<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/tool/theme.html" aria-label="Theme-Hope"><!--[--><span class="font-icon icon iconfont icon-web-design" style=""></span><!--]-->Theme-Hope<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/ventixy/notebook" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable active"><span class="font-icon icon iconfont icon-java" style=""></span><a class="route-link route-link-active auto-link vp-sidebar-title no-external-link-icon" href="/java/" aria-label="Java Programming"><!---->Java Programming<!----></a><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header active"><span class="font-icon icon iconfont icon-app" style=""></span><span class="vp-sidebar-title">Java基础及核心特性</span><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Java基础语法</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">进阶语法和JVM</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/java/syntax/senior/Enum.html" aria-label="Enum枚举"><!---->Enum枚举<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/java/syntax/senior/Annotation.html" aria-label="Annotation注解"><!---->Annotation注解<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/java/syntax/senior/Reflection.html" aria-label="Reflection反射"><!---->Reflection反射<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/java/syntax/senior/Lambda.html" aria-label="Lambda表达式"><!---->Lambda表达式<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/java/syntax/senior/Stream.html" aria-label="Stream API"><!---->Stream API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/java/syntax/senior/Jvm%E7%B1%BB%E5%8A%A0%E8%BD%BD.html" aria-label="Jvm类加载机制"><!---->Jvm类加载机制<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/java/syntax/senior/Jvm%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86.html" aria-label="内存管理与垃圾回收"><!---->内存管理与垃圾回收<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/java/syntax/senior/pt.html" aria-label="JVM性能调优"><!---->JVM性能调优<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/java/syntax/senior/bytecode.html" aria-label="虚拟机字节码"><!---->虚拟机字节码<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">网络编程与高性能IO</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Java并发编程</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon iconfont icon-net" style=""></span><span class="vp-sidebar-title">JavaWeb及常用框架</span><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Web基础与常用服务器</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Spring Framework</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">其他常用工具和框架</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon iconfont icon-db" style=""></span><span class="vp-sidebar-title">数据库与ORM框架</span><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">常用数据库</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">ORM框架</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon iconfont icon-microservice" style=""></span><span class="vp-sidebar-title">分布式与微服务架构</span><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">微服务框架和中间件</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">分布式系统问题解决方案</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->虚拟机字节码</h1><div class="page-info"><span class="page-author-info" aria-label="Author🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://www.ventix.top" target="_blank" rel="noopener noreferrer">ventixy</a></span><span property="author" content="ventixy"></span></span><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2025-01-10T15:19:41.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 49 min</span><meta property="timeRequired" content="PT49M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">On This Page<button type="button" class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#java字节码">Java字节码</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#javac-javap">javac/javap</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#字节码文件">字节码文件</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#类加载和使用">类加载和使用</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#常见字节码指令">常见字节码指令</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#常量入栈指令">常量入栈指令</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#变量操作指令">变量操作指令</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#数字操作指令">数字操作指令</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#数据转换指令">数据转换指令</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#控制流指令">控制流指令</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#对象创建和方法调用">对象创建和方法调用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#数组操作指令">数组操作指令</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#异常处理指令">异常处理指令</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#方法返回指令">方法返回指令</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#同步指令">同步指令</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#访问常量池">访问常量池</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#asm库及其应用">ASM库及其应用</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#asm库的使用">ASM库的使用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#常见asm应用">常见ASM应用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#asm与性能优化">ASM与性能优化</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><p>Java字节码是Java程序在编译后的中间表示形式，它由JVM解释执行或即时编译为机器码。理解和操作字节码可以让我们更深入地了解Java程序的执行过程，同时也提供了在运行时修改和优化代码的强大工具。通过使用像ASM这样的库，开发人员可以获得对字节码级细节的完全控制，从而实现更高级别的代码定制和优化。</p><h2 id="java字节码" tabindex="-1"><a class="header-anchor" href="#java字节码"><span>Java字节码</span></a></h2><h3 id="javac-javap" tabindex="-1"><a class="header-anchor" href="#javac-javap"><span>javac/javap</span></a></h3><p>当使用<code>javac</code>命令编译Java源代码时，编译器会将<code>.java</code>源文件转换成<code>.class</code>字节码文件。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">javac</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SimpleClass.java</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>SimpleClass.class</code>文件的内容本质上是一系列的字节码指令和元数据，这是Java虚拟机（JVM）用来执行程序的低级表示。需要注意的是 <strong><code>SimpleClass.class</code></strong> 是二进制格式的，包含了字节码指令和元数据，直接阅读非常困难，而且需要特殊的工具才能解析。</p><details class="hint-container details"><summary>`.class`文件的包括如下内容：</summary><ol><li><strong>魔数（Magic Number）</strong> - 占用4个字节，通常是<code>0xCAFEBABE</code>，用于标识这是一个有效的字节码文件。</li><li><strong>次要版本号（Minor Version）</strong> - 占用2个字节，表示字节码文件的次要版本。</li><li><strong>主要版本号（Major Version）</strong> - 占用2个字节，表示字节码文件的主要版本，这决定了字节码的兼容性。</li><li><strong>常量池表计数器（Constant Pool Count）</strong> - 占用2个字节，表示常量池中条目的数量。</li><li><strong>常量池（Constant Pool）</strong> - 一系列的常量条目，包括类名、接口名、字段名、方法名、字符串、整数、浮点数等，以及对这些常量的引用。</li><li><strong>访问标志（Access Flags）</strong> - 占用2个字节，表示类或接口的访问权限和特性。</li><li><strong>此类的类索引（This Class Index）</strong> - 占用2个字节，指向常量池中表示当前类的全限定名的条目。</li><li><strong>超类的类索引（Superclass Index）</strong> - 占用2个字节，指向常量池中表示超类的全限定名的条目（对于接口则为<code>0</code>）。</li><li><strong>接口索引集合（Interfaces）</strong> - 包含一系列接口的索引，每个索引指向常量池中的接口全限定名。</li><li><strong>字段表集合（Fields）</strong> - 描述类的所有字段。</li><li><strong>方法表集合（Methods）</strong> - 描述类的所有方法，每个方法包含其属性、代码、异常表等。</li><li><strong>属性表集合（Attributes）</strong> - 提供额外的信息，如源文件名、局部变量表、代码行号映射等。</li></ol></details><br><p><code>javap</code>主要用于分析和学习字节码，输出的是字节码指令的描述。<code>javap</code>会解析<code>.class</code>文件中的字节码和元数据，并将其转换为人类可读的格式。具体来说：</p><ul><li><code>-c</code>选项用于显示每个方法的字节码指令。</li><li><code>-v</code>选项可以显示更多的细节，包括常量池、访问标志等。</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">javap</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SimpleClass</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>总之，<mark><code>.class</code>文件是机器可读的字节码文件，而<code>javap</code>命令则是将这些字节码转换成人可读的文本格式，帮助开发者理解和调试</mark>。</p><p>除了javap以外，还可以使用 <strong>jclasslib Bytecode Viewer</strong> 插件（IDEA）: 这个工具也是主要用来查看和分析字节码的，对于理解字节码指令非常有用。</p><br><p>要将字节码完全反编译回接近原始的Java源代码，需要使用更高级的反编译工具。</p><details class="hint-container details"><summary>反编译及反编译工具</summary><p>字节码反编译是指将已经编译成字节码（<code>.class</code>文件）的程序恢复成接近原始源代码的过程。这个过程对于理解和修改已有的代码、逆向工程、调试和学习编译原理等方面非常有用。</p><h4 id="字节码反编译过程" tabindex="-1"><a class="header-anchor" href="#字节码反编译过程"><span>字节码反编译过程</span></a></h4><ol><li><p><strong>读取字节码文件</strong>：反编译工具首先会读取<code>.class</code>文件，解析其中的元数据和字节码指令。</p></li><li><p><strong>解析元数据</strong>：元数据包含了类的结构、方法签名、字段等信息，这些信息有助于重构类和方法的定义。</p></li><li><p><strong>解析字节码指令</strong>：字节码指令是程序的具体实现部分，反编译工具会尝试理解每条指令的作用，重建控制流和数据流。</p></li><li><p><strong>重构源代码</strong>：反编译工具将字节码指令转换为高级语言的语句，这通常涉及到推测变量名、类型、循环和条件语句等。</p></li><li><p><strong>恢复代码结构</strong>：重构的代码需要有清晰的结构，反编译工具会尽力恢复原始的类结构、方法体和变量声明。</p></li><li><p><strong>后处理</strong>：最后，工具会对生成的代码进行清理，去除冗余和不完整的部分，使代码更易于阅读和理解。</p></li></ol><h4 id="常见的字节码反编译工具" tabindex="-1"><a class="header-anchor" href="#常见的字节码反编译工具"><span>常见的字节码反编译工具</span></a></h4><ul><li><p><strong>JD-GUI</strong>: 这是一个图形界面的Java反编译工具，能够显示反编译后的源代码，但有时可能无法完全恢复所有的代码细节。</p></li><li><p><strong>DJ Java Decompiler</strong>: 相对于JD-GUI，这个工具在反编译准确性上表现更好，尤其是在复杂的代码结构上。</p></li><li><p><strong>CFR</strong>: 一个开源的Java反编译器，以其高质量的反编译结果而著称，特别擅长处理复杂的代码结构。</p></li><li><p><strong>Procyon</strong>: 这是一个多用途的Java工具包，包含了一个高效的反编译器。</p></li><li><p><strong>FernFlower</strong>: 这是 IntelliJ IDEA 和 Eclipse 插件中内置的反编译器，也是相当强大的工具。</p></li></ul></details><h3 id="字节码文件" tabindex="-1"><a class="header-anchor" href="#字节码文件"><span>字节码文件</span></a></h3><p>使用 <code>javac</code> 编译后的字节码文件是供 虚拟机 使用的二进制文件，我们无法直接阅读，通常需要使用 <code>javap</code> 命令来获取易于理解的文本格式。</p><p>以下面的代码为例：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> SimpleClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> NAME </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;Tom&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> SimpleClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> value;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> value;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用 <code>javac SimpleClass.java</code> 编译后获得了 <code>SimpleClass.class</code> 文件，再使用 <code>javap -c -v SimpleClass</code> 即可获取可阅读的文本，如下：</p><details class="hint-container details"><summary>SimpleClass.class文件内容(经过javap处理后的文本)：</summary><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Classfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /Users/xxx/workplace/demo/src/SimpleClass.class</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  Last</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> modified</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Jul</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 9,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2024</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">size</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 375</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  SHA-256</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> checksum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> da094ea9a9b57aec8f527511b5a05301e5ad12292678f6c9bb0e2ca50080b2eb</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  Compiled</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;SimpleClass.java&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">public</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> class</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SimpleClass</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  minor</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> version:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  major</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> version:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 65</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  flags:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0021) ACC_PUBLIC, ACC_SUPER</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  this_class:</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #8                          // SimpleClass</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  super_class:</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #2                         // java/lang/Object</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  interfaces:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fields:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 2,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> methods:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 2,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> attributes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Constant</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pool:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #1 = Methodref          #2.#3          // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #2 = Class              #4             // java/lang/Object</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #3 = NameAndType        #5:#6          // &quot;&lt;init&gt;&quot;:()V</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #4 = Utf8               java/lang/Object</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #5 = Utf8               &lt;init&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #6 = Utf8               ()V</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #7 = Fieldref           #8.#9          // SimpleClass.value:I</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #8 = Class              #10            // SimpleClass</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #9 = NameAndType        #11:#12        // value:I</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #10 = Utf8               SimpleClass</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #11 = Utf8               value</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #12 = Utf8               I</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #13 = Utf8               NAME</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #14 = Utf8               Ljava/lang/String;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #15 = Utf8               ConstantValue</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #16 = String             #17            // Tom</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #17 = Utf8               Tom</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #18 = Utf8               (I)V</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #19 = Utf8               Code</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #20 = Utf8               LineNumberTable</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #21 = Utf8               getValue</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #22 = Utf8               ()I</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #23 = Utf8               SourceFile</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #24 = Utf8               SimpleClass.java</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  public</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> static</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> final</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> java.lang.String</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> NAME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    descriptor:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Ljava/lang/String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    flags:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0019) ACC_PUBLIC, ACC_STATIC, ACC_FINAL</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ConstantValue:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> String</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Tom</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  public</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SimpleClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    descriptor:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (I)V</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    flags:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0001) ACC_PUBLIC</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Code:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      stack</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">2,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> locals</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">2,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> args_size</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         0:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> aload_0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         1:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> invokespecial</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         4:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> aload_0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         5:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> iload_1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         6:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> putfield</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      #7                  // Field value:I</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         9:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> return</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      LineNumberTable:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        line</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 5:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        line</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 6:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        line</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 7:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 9</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  public</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> int</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> getValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    descriptor:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ()</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">I</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    flags:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0001) ACC_PUBLIC</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Code:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      stack</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> locals</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> args_size</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         0:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> aload_0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         1:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> getfield</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      #7                  // Field value:I</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         4:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ireturn</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      LineNumberTable:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        line</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SourceFile:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;SimpleClass.java&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><p>下面是对<code>SimpleClass.class</code>文件字节码信息的详细解读:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Classfile Information:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Classfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /Users/xxx/workplace/demo/src/SimpleClass.class</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # .class文件的路径</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  Last</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> modified</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Jul</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 9,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2024</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">size</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 375</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 文件最后修改时间和大小</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  SHA-256</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> checksum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> da094ea9a9b57aec8f527511b5a05301e5ad12292678f6c9bb0e2ca50080b2eb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 文件的SHA-256校验和，用于验证文件的完整性和一致性。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Class Metadata:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">public</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> class</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SimpleClass</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                      # 类名为SimpleClass，且它是公共的。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  minor</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> version:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                            # 次要版本号，通常为0。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  major</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> version:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 65</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                           # 主要版本号，对应到JDK 17。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  flags:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0021) ACC_PUBLIC, ACC_SUPER       </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 类的标志位，</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # ACC_PUBLIC表示类是公共的，ACC_SUPER表示它使用了super关键字。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Class Structure:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  this_class:</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #8                 # 当前类的引用，在常量池中的索引。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  super_class:</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #2                # 超类的引用，在常量池中的索引，这里是java.lang.Object。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Interface Information: (None in this case)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  interfaces:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                # SimpleClass没有实现任何接口。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Field and Method Counts:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  fields:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                    # SimpleClass有两个字段。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  methods:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                   # SimpleClass有两个方法。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  attributes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                # SimpleClass有一个属性。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Constant Pool:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #1 = Methodref          #2.#3               # Object类的构造函数引用。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #2 = Class              #4                  # 对java.lang.Object类的引用。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #3 = NameAndType        #5:#6               # Object构造函数的名字和类型描述符。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #4 = Utf8               java/lang/Object    # UTF-8编码的java.lang.Object字符串。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #5 = Utf8               &lt;init&gt;              # 构造函数的特殊名字。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #6 = Utf8               ()V                 # 构造函数的参数类型和返回类型描述符，</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                                # 空括号表示无参数，V表示void。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #7 = Fieldref           #8.#9               # SimpleClass类的value字段引用。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #8 = Class              #10                 # 对SimpleClass类的引用。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #9 = NameAndType        #11:#12             # value字段的名字和类型描述符。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #10 = Utf8              SimpleClass         # UTF-8编码的SimpleClass字符串。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #11 = Utf8              value               # value字段的名字。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #12 = Utf8              I                   # value字段的类型描述符，I表示int。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #13 = Utf8              NAME                # NAME字段的名字。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #14 = Utf8              Ljava/lang/String;  # NAME字段的类型描述符，表示String类型。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #15 = Utf8              ConstantValue       # ConstantValue属性的UTF-8编码。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #16 = String            #17                 # String常量“Tom”的引用。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #17 = Utf8              Tom                 # UTF-8编码的字符串“Tom”。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #18 = Utf8              (I)V                # SimpleClass构造函数的参数和返回类型描述符</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #19 = Utf8              Code                # Code属性的UTF-8编码。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #20 = Utf8              LineNumberTable     # LineNumberTable属性的UTF-8编码。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #21 = Utf8              getValue            # getValue方法的名字。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #22 = Utf8              ()I                 # getValue方法的参数和返回类型描述符。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #23 = Utf8              SourceFile          # SourceFile属性的UTF-8编码。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #24 = Utf8              SimpleClass.java    # SimpleClass.java文件的UTF-8编码。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Fields:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  public</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> static</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> final</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> java.lang.String</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> NAME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 声明了一个公共的String静态常量字段NAME</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    descriptor:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Ljava/lang/String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;                     </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 字段的数据类型描述符。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    flags:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0019) ACC_PUBLIC, ACC_STATIC, ACC_FINAL  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 字段的标志位，</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # ACC_PUBLIC表示公共，ACC_STATIC表示静态，ACC_FINAL表示最终不可变。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ConstantValue:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> String</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Tom</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                          # NAME字段的值是“Tom”。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  private</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> int</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;                    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 声明了一个私有的int字段value。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    descriptor:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> I</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                       # 字段的数据类型描述符。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    flags:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0002) ACC_PRIVATE         </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 字段的标志位，ACC_PRIVATE表示私有。</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Methods:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  public</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SimpleClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);            </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># SimpleClass的构造函数，接受一个int参数。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    descriptor:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (I)V                  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 构造函数的参数和返回类型描述符。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    flags:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0001) ACC_PUBLIC        </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 方法的标志位，ACC_PUBLIC表示公共。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Code:</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                             # 方法的字节码指令。</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      stack</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">2,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> locals</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">2,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> args_size</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">2</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 栈深度，局部变量表大小，参数数量。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         0:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> aload_0</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                   # 加载this引用到栈顶。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         1:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> invokespecial</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #1          # 调用Object的构造函数。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         4:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> aload_0</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                   # 再次加载this引用到栈顶。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         5:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> iload_1</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                   # 加载第一个局部变量（int参数）到栈顶。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         6:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> putfield</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      #7          # 将栈顶的值存储到value字段。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         9:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> return</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                    # 返回。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      LineNumberTable:</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                # 行号表，指示字节码指令与源代码行号的关系。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        line</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 5:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                     # 字节码指令0对应的源代码行号5。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        line</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 6:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                     # 字节码指令4对应的源代码行号6。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        line</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 7:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 9</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                     # 字节码指令9对应的源代码行号7。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  public</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> int</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> getValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();              </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 声明了一个公共的int返回类型的方法getValue。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    descriptor:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ()I                   </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 方法的参数和返回类型描述符。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    flags:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0001) ACC_PUBLIC        </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 方法的标志位，ACC_PUBLIC表示公共。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Code:</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                             # 方法的字节码指令。</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      stack</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> locals</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> args_size</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 栈深度，局部变量表大小，参数数量。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         0:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> aload_0</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                   # 加载this引用到栈顶。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         1:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> getfield</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      #7          # 获取value字段的值。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">         4:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ireturn</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                   # 返回栈顶的int值。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      LineNumberTable:</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                # 行号表，指示字节码指令与源代码行号的关系。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        line</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                    # 字节码指令0对应的源代码行号10。</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># SourceFile Attribute:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SourceFile:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;SimpleClass.java&quot;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         # 源代码文件名。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="类加载和使用" tabindex="-1"><a class="header-anchor" href="#类加载和使用"><span>类加载和使用</span></a></h3><p>下面是基于<code>SimpleClass.class</code>字节码文件的一个简化版的类加载和使用过程的描述：</p><p><strong>1. 类加载（Loading）</strong></p><p>类加载过程由JVM的类加载器负责，通常包括加载、验证、准备、解析和初始化五个阶段。</p><div class="hint-container info"><p class="hint-container-title">类加载</p><h4 id="加载-loading" tabindex="-1"><a class="header-anchor" href="#加载-loading"><span>加载（Loading）</span></a></h4><p>当JVM首次遇到<code>new SimpleClass(10);</code>这样的语句时，如果<code>SimpleClass</code>尚未加载，则类加载器（如AppClassLoader）会读取<code>SimpleClass.class</code>文件的内容，将其转化为字节码数组，然后创建一个<code>Class</code>对象。</p><h4 id="验证-verification" tabindex="-1"><a class="header-anchor" href="#验证-verification"><span>验证（Verification）</span></a></h4><p>JVM会对字节码进行一系列的检查，以确保它们符合JVM规范，不会对JVM造成危害，例如检查常量池中的信息是否有效，确保字节码指令正确无误。</p><h4 id="准备-preparation" tabindex="-1"><a class="header-anchor" href="#准备-preparation"><span>准备（Preparation）</span></a></h4><p>在这个阶段，JVM为<code>SimpleClass</code>类的静态变量分配内存并设置默认值。例如，<code>public static final String NAME = &quot;Tom&quot;;</code>的默认值为<code>null</code>（因为<code>String</code>是对象类型），直到初始化阶段才会被赋值。</p><h4 id="解析-resolution" tabindex="-1"><a class="header-anchor" href="#解析-resolution"><span>解析（Resolution）</span></a></h4><p>解析是将类中的符号引用转换为直接引用的过程，例如将<code>Fieldref</code>和<code>Methodref</code>转换为具体的内存地址。</p><h4 id="初始化-initialization" tabindex="-1"><a class="header-anchor" href="#初始化-initialization"><span>初始化（Initialization）</span></a></h4><p>在初始化阶段，<code>&lt;clinit&gt;</code>方法会被调用，执行类的静态初始化代码块，设置静态变量的最终值。在我们的例子中，<code>NAME</code>字段将被赋值为<code>&quot;Tom&quot;</code>。</p></div><p><strong>2. 实例化（Instantiation）</strong></p><p>当执行<code>new SimpleClass(10);</code>时，JVM会执行以下步骤：</p><ol><li><strong>分配内存</strong>：在堆上为新的<code>SimpleClass</code>实例分配内存。</li><li><strong>初始化对象</strong>：调用构造函数<code>SimpleClass(int)</code>。在字节码中，<code>aload_0</code>加载对象引用，<code>invokespecial #1</code>调用<code>Object</code>类的构造函数，<code>iload_1</code>加载参数值，<code>putfield #7</code>将值存储到<code>value</code>字段中。</li></ol><p>当执行<code>SimpleClass.getValue();</code>时，<code>getValue()</code>方法的字节码被执行。<code>aload_0</code>加载对象引用，<code>getfield #7</code>获取<code>value</code>字段的值，然后<code>ireturn</code>返回这个值。</p><div class="hint-container info"><p class="hint-container-title">内存变化</p><h4 id="堆空间" tabindex="-1"><a class="header-anchor" href="#堆空间"><span>堆空间</span></a></h4><ul><li>在类加载时，<code>SimpleClass</code>的<code>Class</code>对象被创建在永久代（JDK 8之前）或元空间（JDK 8之后）。</li><li>当实例化<code>SimpleClass</code>时，新对象被创建在堆空间中，包含<code>value</code>字段。</li></ul><h4 id="栈空间" tabindex="-1"><a class="header-anchor" href="#栈空间"><span>栈空间</span></a></h4><ul><li>每个线程都有自己的栈空间，用于存储局部变量和方法调用的帧。</li><li>在构造函数调用期间，局部变量表和操作数栈被使用，例如<code>iload_1</code>从局部变量表加载值。</li></ul><h4 id="方法区" tabindex="-1"><a class="header-anchor" href="#方法区"><span>方法区</span></a></h4><ul><li>存储了类的信息、静态变量、常量池、方法数据等。</li></ul><h4 id="本地方法栈" tabindex="-1"><a class="header-anchor" href="#本地方法栈"><span>本地方法栈</span></a></h4><ul><li>用于支持本地方法的调用，但在我们的例子中未涉及。</li></ul></div><h2 id="常见字节码指令" tabindex="-1"><a class="header-anchor" href="#常见字节码指令"><span>常见字节码指令</span></a></h2><p>Java字节码指令集是Java虚拟机(JVM)用来执行Java程序的低级指令集。这些指令涵盖了从基本的数据操作到控制流、异常处理、对象创建、方法调用等各种功能。</p><p>Java的指令集选择了基于栈的设计，主要是因为它提供了更好的跨平台兼容性和简化了内存管理。更多内容参照：<a class="route-link" href="/java/syntax/senior/Jvm%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86.html#%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88">虚拟机栈及Java指令集</a></p><div class="hint-container info"><p class="hint-container-title">操作码和操作数</p><p>字节码指令由操作码（opcode）和操作数（operands）组成。操作码是一个字节长度（0-255），而操作数可以是附加的字节，用于指定操作的对象或值。</p></div><p>字节码指令在<code>.class</code>文件中位于方法的代码属性中。当JVM加载类并准备执行方法时，它会读取这些字节码指令并执行它们。</p><h3 id="常量入栈指令" tabindex="-1"><a class="header-anchor" href="#常量入栈指令"><span>常量入栈指令</span></a></h3><p>常量入栈指令主要用于将各种类型的常量值推入操作数栈。操作数栈是JVM执行引擎的一个关键组件，属于 <a class="route-link" href="/java/syntax/senior/Jvm%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86.html#%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88">虚拟机栈</a> 中栈帧的一部分，它用于存放临时计算结果和操作数。</p><p>常量入栈指令允许JVM将预定义的或常量池中的常量直接加载到栈顶，以便后续的计算或方法调用使用。下面是一些常见的常量入栈指令及其功能：</p><ol><li><p><strong><code>aconst_null</code></strong></p><ul><li>功能：将<code>null</code>引用压入栈顶。</li><li>用途：初始化对象引用或传递<code>null</code>作为参数。</li></ul></li><li><p><strong><code>iconst_&lt;n&gt;</code></strong></p><ul><li>功能：将一个固定的整数常量<code>&lt;n&gt;</code>压入栈顶。</li><li>用途：<code>&lt;n&gt;</code>可以是<code>m1</code>（-1）、<code>0</code>、<code>1</code>、<code>2</code>、<code>3</code>、<code>4</code>或<code>5</code>。</li><li>示例：<code>iconst_0</code>将整数0压入栈顶。</li></ul></li><li><p><strong><code>bipush</code></strong></p><ul><li>功能：将一个字节范围内的整数（-128到127）压入栈顶。</li><li>用途：用于较小的整数常量。</li></ul></li><li><p><strong><code>sipush</code></strong></p><ul><li>功能：将一个短整数范围内的值（-32768到32767）压入栈顶。</li><li>用途：用于较大的整数常量但比<code>ldc</code>更快。</li></ul></li><li><p><strong><code>ldc</code> 和 <code>ldc_w</code></strong></p><ul><li>功能：将常量池中的常量（如<code>int</code>、<code>float</code>、<code>String</code>引用或类引用）压入栈顶。</li><li>用途：<code>ldc</code>用于索引小于等于255的情况，<code>ldc_w</code>用于更大的索引。</li><li>示例：<code>ldc #1</code>将常量池中索引为1的常量加载到栈顶。</li></ul></li><li><p><strong><code>ldc2_w</code></strong></p><ul><li>功能：将常量池中的长整型或双精度浮点型常量压入栈顶。</li><li>用途：用于<code>long</code>和<code>double</code>类型。</li></ul></li></ol><p>在JVM执行过程中，这些常量值会被加载到操作数栈中，然后可以通过其他指令（如算术指令、比较指令或方法调用指令）进一步处理。</p><h3 id="变量操作指令" tabindex="-1"><a class="header-anchor" href="#变量操作指令"><span>变量操作指令</span></a></h3><p>变量操作指令在Java字节码中用于处理<mark>局部变量和对象的字段</mark>。这些指令允许JVM在执行方法时加载、存储和操作变量的值。Java字节码中的变量操作指令可以分为几类，主要关注局部变量（栈帧中的局部变量表）和对象字段（对象头之后的数据区域）。</p><div class="hint-container info"><p class="hint-container-title">变量操作指令</p><h4 id="局部变量操作指令" tabindex="-1"><a class="header-anchor" href="#局部变量操作指令"><span>局部变量操作指令</span></a></h4><p>局部变量是指在方法体中声明的变量，它们存储在栈帧的局部变量表中。局部变量操作指令包括加载（Load）、存储（Store）和交换（Swap）指令。</p><ul><li><p><strong>Load指令</strong>：用于从局部变量表中加载一个变量的值到操作数栈顶。<br><code>iload</code>, <code>lload</code>, <code>fload</code>, <code>dload</code>, <code>aload</code>: 分别加载int、long、float、double和对象引用类型的局部变量。</p></li><li><p><strong>Store指令</strong>：用于将操作数栈顶的值存储到局部变量表中的某个位置。<br><code>istore</code>, <code>lstore</code>, <code>fstore</code>, <code>dstore</code>, <code>astore</code>: 分别存储int、long、float、double和对象引用类型的局部变量。</p></li><li><p><strong>Swap指令</strong>：<code>swap</code>用于交换操作数栈顶的两个值的位置。这在某些情况下可以避免使用临时变量。</p></li></ul><h4 id="对象字段操作指令" tabindex="-1"><a class="header-anchor" href="#对象字段操作指令"><span>对象字段操作指令</span></a></h4><p>对象字段操作指令用于访问和修改对象实例中的字段（成员变量）。这些指令包括：</p><ul><li><p><code>getfield</code>用于从对象中加载一个实例字段的值到操作数栈顶。</p></li><li><p><code>putfield</code>用于将操作数栈顶的值存储到对象的一个实例字段中。</p></li></ul><p>此外，还有专门用于静态字段的指令：</p><ul><li><p><code>getstatic</code>用于从类中加载一个静态字段的值到操作数栈顶。</p></li><li><p><code>putstatic</code>用于将操作数栈顶的值存储到类的一个静态字段中。</p></li></ul></div><p>其他与变量相关的指令还有 <code>dup</code> 和 <code>pop</code> 指令：</p><p><strong>Duplication指令</strong>：<code>dup</code>和<code>dup_x1</code>、<code>dup_x2</code>、<code>dup2</code>、<code>dup2_x1</code>、<code>dup2_x2</code>用于复制栈顶的值</p><div class="hint-container info"><p class="hint-container-title">Duplication指令</p><ul><li>不带_x 的<code>dup</code>指令说明: dup是复制栈顶数据并压入栈顶，一般包括两个指令：dup、dup2，系数代表要复制的slot个数 <ul><li><code>dup</code>指令用于复制1个Slot的数据。例：1个int 或者 1个reference</li><li><code>dup2</code>指令用于复制2个Slot的数据。例：1个long，或2个int，或1个int + 1个float</li></ul></li><li>带_x 的<code>dup</code>指令说明: <code>dup_x</code>是复制栈顶数据并插入栈顶<mark>两系数和</mark>以下的位置，共有四个指令：<code>dup_x1</code>，<code>dup2_x1</code>，<code>dup_x2</code>，<code>dup2_x2</code>，只要将指令的dup和x的系数相加，结果即为需要插入的位置。 <ul><li><code>dup_x1</code>插入位置:1+1=2，即栈顶2个Slot下面</li><li><code>dup_x2</code>插入位置:1+2=3，即栈顶3个Slot下面</li><li><code>dup2_x1</code>插入位置:2+1=3，即栈顶3个Slot下面</li><li><code>dup2_x2</code>插入位置:2+2=4，即栈顶4个slot下面</li></ul></li></ul></div><p><strong>pop指令与pop2指令</strong></p><ul><li><code>pop</code>: 将栈顶的1个s1ot数值出栈。例如1个short类型数值</li><li><code>pop2</code>: 将栈顶的2个Slot数值出栈。例如1个double类型数值，或者2个int类型数值</li></ul><h3 id="数字操作指令" tabindex="-1"><a class="header-anchor" href="#数字操作指令"><span>数字操作指令</span></a></h3><p>数字操作指令用于执行基本的算术和逻辑运算，这些指令涵盖了整数（<code>int</code>和<code>long</code>类型）和浮点数（<code>float</code>和<code>double</code>类型）的各种操作</p><div class="hint-container info"><p class="hint-container-title">不用数据类型所占用的slot</p><p>在Java虚拟机(JVM)的规范中，操作数栈中的每个槽(slot)可以保存一个基本数据类型值(<mark>JVM栈的槽是32位宽的</mark>)。但是，不同类型的数据所占用的栈槽数量是不同的：</p><ul><li><p><strong>整数类型 (<code>int</code>)</strong>：<code>int</code>类型占用一个栈槽。</p></li><li><p><strong>长整数类型 (<code>long</code>)</strong>：<code>long</code>类型占用两个栈槽。这是因为<code>long</code>类型的大小是64位，而JVM栈的槽是32位宽的。</p></li><li><p><strong>浮点数类型 (<code>float</code>)</strong>：<code>float</code>类型也占用一个栈槽，与<code>int</code>类型相同。</p></li><li><p><strong>双精度浮点数类型 (<code>double</code>)</strong>：<code>double</code>类型占用两个栈槽，与<code>long</code>类型类似。这是因为<code>double</code>类型的大小同样是64位，所以它需要两个32位宽的栈槽来存储。</p></li></ul></div><p>常用指令介绍：</p><div class="hint-container info"><p class="hint-container-title">常用数字操作指令</p><h4 id="加法" tabindex="-1"><a class="header-anchor" href="#加法"><span>加法</span></a></h4><ul><li><code>iadd</code>：将栈顶的两个<code>int</code>值相加，结果压回栈顶。</li><li><code>ladd</code>：将栈顶的两个<code>long</code>值相加，结果压回栈顶。</li><li><code>fadd</code>：将栈顶的两个<code>float</code>值相加，结果压回栈顶。</li><li><code>dadd</code>：将栈顶的两个<code>double</code>值相加，结果压回栈顶。</li></ul><h4 id="减法" tabindex="-1"><a class="header-anchor" href="#减法"><span>减法</span></a></h4><ul><li><code>isub</code>：从栈顶的第二个<code>int</code>值减去栈顶的<code>int</code>值，结果压回栈顶。</li><li><code>lsub</code>：从栈顶的第二个<code>long</code>值减去栈顶的<code>long</code>值，结果压回栈顶。</li><li><code>fsub</code>：从栈顶的第二个<code>float</code>值减去栈顶的<code>float</code>值，结果压回栈顶。</li><li><code>dsub</code>：从栈顶的第二个<code>double</code>值减去栈顶的<code>double</code>值，结果压回栈顶。</li></ul><h4 id="乘法" tabindex="-1"><a class="header-anchor" href="#乘法"><span>乘法</span></a></h4><ul><li><code>imul</code>：将栈顶的两个<code>int</code>值相乘，结果压回栈顶。</li><li><code>lmul</code>：将栈顶的两个<code>long</code>值相乘，结果压回栈顶。</li><li><code>fmul</code>：将栈顶的两个<code>float</code>值相乘，结果压回栈顶。</li><li><code>dmul</code>：将栈顶的两个<code>double</code>值相乘，结果压回栈顶。</li></ul><h4 id="除法" tabindex="-1"><a class="header-anchor" href="#除法"><span>除法</span></a></h4><ul><li><code>idiv</code>：栈顶的<code>int</code>值除以栈顶的第二个<code>int</code>值，结果压回栈顶。</li><li><code>ldiv</code>：栈顶的<code>long</code>值除以栈顶的第二个<code>long</code>值，结果压回栈顶。</li><li><code>fdiv</code>：栈顶的<code>float</code>值除以栈顶的第二个<code>float</code>值，结果压回栈顶。</li><li><code>ddiv</code>：栈顶的<code>double</code>值除以栈顶的第二个<code>double</code>值，结果压回栈顶。</li></ul><h4 id="取模" tabindex="-1"><a class="header-anchor" href="#取模"><span>取模</span></a></h4><ul><li><code>irem</code>：栈顶的<code>int</code>值对栈顶的第二个<code>int</code>值取模，结果压回栈顶。</li><li><code>lrem</code>：栈顶的<code>long</code>值对栈顶的第二个<code>long</code>值取模，结果压回栈顶。</li><li><code>frem</code>：栈顶的<code>float</code>值对栈顶的第二个<code>float</code>值取模，结果压回栈顶。</li><li><code>drem</code>：栈顶的<code>double</code>值对栈顶的第二个<code>double</code>值取模，结果压回栈顶。</li></ul><h4 id="移位" tabindex="-1"><a class="header-anchor" href="#移位"><span>移位</span></a></h4><ul><li><code>ishl</code>, <code>lshl</code>：左移操作。</li><li><code>ishr</code>, <code>lshr</code>：右移操作，空位填充0。</li><li><code>iushr</code>, <code>lushr</code>：无符号右移操作，空位填充0。</li></ul><h4 id="比较" tabindex="-1"><a class="header-anchor" href="#比较"><span>比较</span></a></h4><ul><li><p><code>if_icmpeq</code>, <code>if_icmpne</code>, <code>if_icmplt</code>, <code>if_icmpge</code>, <code>if_icmpgt</code>, <code>if_icmple</code>：整数比较分支指令。</p></li><li><p><code>if_acmpeq</code>, <code>if_acmpne</code>：对象引用比较分支指令。</p></li><li><p><code>if_fcmpeq</code>, <code>if_fcmpne</code>, <code>if_fcmplt</code>, <code>if_fcmpge</code>, <code>if_fcmpgt</code>, <code>if_fcmple</code>：浮点数比较分支指令。</p></li><li><p><code>if_dcmpeq</code>, <code>if_dcmpne</code>, <code>if_dcmplt</code>, <code>if_dcmpge</code>, <code>if_dcmpgt</code>, <code>if_dcmple</code>：双精度浮点数比较分支指令。</p></li></ul><h4 id="位运算" tabindex="-1"><a class="header-anchor" href="#位运算"><span>位运算</span></a></h4><ul><li><code>iand</code>, <code>land</code>：按位与操作。</li><li><code>ior</code>, <code>lor</code>：按位或操作。</li><li><code>ixor</code>, <code>lxor</code>：按位异或操作。</li><li><code>ineg</code>, <code>lneg</code>：按位取反操作。</li></ul></div><h3 id="数据转换指令" tabindex="-1"><a class="header-anchor" href="#数据转换指令"><span>数据转换指令</span></a></h3><p>数据转换指令用于在不同数据类型之间进行转换。这些指令在字节码层面实现自动类型提升（autoboxing）和强制类型转换（casting）等操作</p><div class="hint-container info"><p class="hint-container-title">常用数据类型转换指令</p><h4 id="整数类型之间的转换" tabindex="-1"><a class="header-anchor" href="#整数类型之间的转换"><span>整数类型之间的转换</span></a></h4><ul><li><strong><code>i2l</code></strong>：将<code>int</code>转换为<code>long</code>。</li><li><strong><code>i2f</code></strong>：将<code>int</code>转换为<code>float</code>。</li><li><strong><code>i2d</code></strong>：将<code>int</code>转换为<code>double</code>。</li><li><strong><code>l2i</code></strong>：将<code>long</code>转换为<code>int</code>，可能导致数据丢失。</li><li><strong><code>l2f</code></strong>：将<code>long</code>转换为<code>float</code>，可能导致数据精度损失。</li><li><strong><code>l2d</code></strong>：将<code>long</code>转换为<code>double</code>。</li></ul><h4 id="浮点数类型之间的转换" tabindex="-1"><a class="header-anchor" href="#浮点数类型之间的转换"><span>浮点数类型之间的转换</span></a></h4><ul><li><strong><code>f2i</code></strong>：将<code>float</code>转换为<code>int</code>，可能导致数据丢失。</li><li><strong><code>f2l</code></strong>：将<code>float</code>转换为<code>long</code>，可能导致数据精度损失。</li><li><strong><code>f2d</code></strong>：将<code>float</code>转换为<code>double</code>，增加数据精度。</li><li><strong><code>d2i</code></strong>：将<code>double</code>转换为<code>int</code>，可能导致数据丢失。</li><li><strong><code>d2l</code></strong>：将<code>double</code>转换为<code>long</code>，可能导致数据精度损失。</li><li><strong><code>d2f</code></strong>：将<code>double</code>转换为<code>float</code>，降低数据精度。</li></ul><p>在将浮点数转换为整数时，通常采用截断（truncation）的方式，即去除小数部分。</p><h4 id="自动类型提升" tabindex="-1"><a class="header-anchor" href="#自动类型提升"><span>自动类型提升</span></a></h4><p>JVM在执行涉及不同整数类型（如<code>byte</code>、<code>short</code>、<code>char</code>、<code>int</code>、<code>long</code>）的操作时，会自动进行类型提升，以确保所有参与运算的值具有足够的精度。例如，当一个<code>byte</code>与一个<code>int</code>进行运算时，<code>byte</code>值会被提升到<code>int</code>类型。</p><h4 id="强制类型转换" tabindex="-1"><a class="header-anchor" href="#强制类型转换"><span>强制类型转换</span></a></h4><p>在从大类型向小类型转换时，JVM使用显式的强制类型转换指令。例如，从<code>int</code>转换到<code>byte</code>需要使用<code>i2b</code>指令，这可能导致数据溢出或丢失。</p></div><p>虽然JVM字节码本身没有直接的指令来将字符串转换为数字，但在Java中，你可以使用<code>Integer.parseInt()</code>, <code>Double.parseDouble()</code>等方法来进行此类转换。这些方法在JVM中通常表现为调用方法的<code>invokevirtual</code>或<code>invokestatic</code>指令。</p><p>同样，直接的数字到字符串的转换通常通过调用<code>Integer.toString()</code>, <code>Double.toString()</code>等方法实现，这些方法在字节码中表现为方法调用指令。</p><h3 id="控制流指令" tabindex="-1"><a class="header-anchor" href="#控制流指令"><span>控制流指令</span></a></h3><p>控制流指令负责改变程序的执行流程，包括条件分支、无条件跳转、循环控制以及异常处理。这些指令使得JVM能够根据程序中的条件决定下一步要执行的字节码指令。</p><div class="hint-container info"><p class="hint-container-title">常见控制流指令</p><h4 id="条件分支指令" tabindex="-1"><a class="header-anchor" href="#条件分支指令"><span>条件分支指令</span></a></h4><p>条件分支指令根据栈顶的值来决定是否跳转到指定的目标地址。这些指令通常用于实现<code>if</code>语句的逻辑。</p><ul><li><strong><code>ifeq</code></strong>：如果栈顶的值等于零，则跳转到目标地址。</li><li><strong><code>ifne</code></strong>：如果栈顶的值不等于零，则跳转到目标地址。</li><li><strong><code>iflt</code></strong>：如果栈顶的值小于零，则跳转到目标地址。</li><li><strong><code>ifge</code></strong>：如果栈顶的值大于等于零，则跳转到目标地址。</li><li><strong><code>ifgt</code></strong>：如果栈顶的值大于零，则跳转到目标地址。</li><li><strong><code>ifle</code></strong>：如果栈顶的值小于等于零，则跳转到目标地址。</li></ul><p>对于<code>if</code>语句中的条件表达式，JVM使用这些指令通过计算条件表达式的布尔值（通常转换为整数0或非0）来实现跳转。</p><h4 id="比较和分支指令" tabindex="-1"><a class="header-anchor" href="#比较和分支指令"><span>比较和分支指令</span></a></h4><p>这些指令用于比较两个值并根据结果进行分支。</p><ul><li><strong><code>if_icmpeq</code></strong>, <strong><code>if_acmpeq</code></strong>: 如果两个整数或引用相等，则跳转。</li><li><strong><code>if_icmpne</code></strong>, <strong><code>if_acmpne</code></strong>: 如果两个整数或引用不相等，则跳转。</li><li><strong><code>if_icmplt</code></strong>, <strong><code>if_icmpge</code></strong>, <strong><code>if_icmpgt</code></strong>, <strong><code>if_icmple</code></strong>: 根据整数比较的结果跳转。</li></ul><h4 id="switch语句" tabindex="-1"><a class="header-anchor" href="#switch语句"><span>switch语句</span></a></h4><p><code>tableswitch</code>和<code>lookupswitch</code>指令用于实现高效的<code>switch</code>语句。这两种指令都用于基于某个整数表达式的值来进行条件分支，但它们的工作方式有所不同。</p><ul><li><strong>tableswitch指令</strong></li></ul><p><code>tableswitch</code>指令用于处理连续的<code>case</code>值。它的工作原理如下：</p><ol><li><strong>偏移量</strong>：首先读取一个默认的偏移量，用于在没有匹配的<code>case</code>时跳转的地址。</li><li><strong>最低和最高值</strong>：接着读取最低和最高<code>case</code>值，用于构建一个范围。</li><li><strong>跳转表</strong>：然后读取一系列的偏移量，每个偏移量对应于一个<code>case</code>值。这个跳转表的大小等于最高值减去最低值加一。</li></ol><p>当<code>switch</code>表达式的值落在定义的范围内时，<code>tableswitch</code>指令会从跳转表中选择相应的偏移量进行跳转。如果表达式的值不在范围内，则使用默认的偏移量进行跳转。</p><p>指令格式：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tableswitch</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  default:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> target</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  low:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> minimum_index</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  high:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> maximum_index</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  pad:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> padding_bytes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  cases:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> case_offset_pairs</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>lookupswitch指令</strong></li></ul><p>相比之下，<code>lookupswitch</code>指令用于处理非连续的<code>case</code>值。它的工作原理如下：</p><ol><li><strong>默认偏移量</strong>：读取一个默认的偏移量，用于在没有匹配的<code>case</code>时跳转的地址。</li><li><strong>匹配对</strong>：接着读取一系列的键值对，每个键代表一个<code>case</code>值，其后的值代表一个偏移量。</li></ol><p>当<code>switch</code>表达式的值与任何一个键匹配时，<code>lookupswitch</code>指令将使用相应的偏移量进行跳转。如果没有匹配的键，则使用默认的偏移量进行跳转。</p><p>指令格式：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">lookupswitch</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  default:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> default_target</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  npairs:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> number_of_pairs</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  pairs:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> match_offset_pairs</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>tableswitch</code>和<code>lookupswitch</code>的设计旨在提高<code>switch</code>语句的执行效率。由于<code>tableswitch</code>指令的跳转表是连续的，因此它可以通过简单的索引查找来快速定位目标偏移量，而不需要遍历整个列表。相反，<code>lookupswitch</code>则需要遍历匹配对来查找一个键，但这对于非连续的<code>case</code>值仍然是一个高效的选择。</p><h4 id="无条件跳转指令" tabindex="-1"><a class="header-anchor" href="#无条件跳转指令"><span>无条件跳转指令</span></a></h4><p>无条件跳转指令使程序流跳转到一个新的位置，而不考虑任何条件。</p><ul><li><strong><code>goto</code></strong>：无条件跳转到指定的字节码偏移量。</li><li><strong><code>jsr</code></strong>（<code>jump subroutine</code>）：子程序调用，跳转到指定位置，但首先在操作数栈中压入返回地址。</li></ul><h4 id="循环控制指令" tabindex="-1"><a class="header-anchor" href="#循环控制指令"><span>循环控制指令</span></a></h4><p>虽然JVM字节码没有专门的循环指令，但通过结合条件分支和无条件跳转指令，可以实现循环的逻辑。</p><ul><li><strong><code>loop</code></strong>：通常使用<code>ifeq</code>, <code>ifne</code>等指令与<code>goto</code>指令结合，形成循环结构。</li></ul><h4 id="方法结束指令" tabindex="-1"><a class="header-anchor" href="#方法结束指令"><span>方法结束指令</span></a></h4><p>控制流指令还包括方法的结束指令：</p><ul><li><strong><code>return</code></strong>, <strong><code>ireturn</code></strong>, <strong><code>lreturn</code></strong>, <strong><code>freturn</code></strong>, <strong><code>dreturn</code></strong>, <strong><code>areturn</code></strong>：根据方法的返回类型，将结果值从栈中弹出并返回调用者，或者直接返回（对于<code>void</code>类型的方法）。</li></ul></div><h3 id="对象创建和方法调用" tabindex="-1"><a class="header-anchor" href="#对象创建和方法调用"><span>对象创建和方法调用</span></a></h3><p>对象创建涉及到类实例的初始化、内存分配和布局设置等多个步骤：</p><ol><li><p><strong>类加载检查</strong>：JVM检查<code>new</code>指令的参数是否能够在常量池中定位到一个类的符号引用，并验证该类是否已经被加载、解析和初始化过。如果没有，JVM会先进行类的加载。</p></li><li><p><strong>内存分配</strong>：类加载检查通过后，JVM为新生的对象分配内存。对象所需的内存大小在类加载完成后就已经确定，包括对象头和实例数据的大小。</p></li><li><p><strong>初始化零值</strong>：内存分配完成后，JVM会将分配的内存空间初始化为零值（除了对象头）。这样可以保证对象的实例字段在Java代码中可以不赋初值就直接使用，因为在Java中，类的字段都会有默认值。</p></li><li><p><strong>设置对象头</strong>：接下来，JVM会在对象的头部设置必要的信息，包括对象的类信息元数据、哈希码、GC分代年龄等信息。对象头是JVM用来识别和管理对象的内部数据结构。</p></li><li><p><strong>执行初始化方法</strong>：对象创建的最后一步是从JVM的角度看，将对象引用入栈，但对Java程序而言，对象创建才刚刚开始。此时，对象的实例初始化方法<code>&lt;init&gt;</code>将被执行，按照程序员设定的初始化逻辑进行对象的真正初始化。</p></li></ol><div class="hint-container info"><p class="hint-container-title">对象创建和方法调用指令</p><h3 id="对象创建指令" tabindex="-1"><a class="header-anchor" href="#对象创建指令"><span>对象创建指令</span></a></h3><p><code>new</code> 指令用于创建一个类的新实例。<code>new</code>指令需要一个指向常量池中类符号引用的索引。JVM会检查这个类是否已经被加载、解析和初始化，如果没有，会先执行类加载过程。一旦类被确认，JVM将为新的对象分配内存。</p><p>假设有一个类 <code>MyClass</code>，在 Java 代码中创建它的实例：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">MyClass</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> obj </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> MyClass</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>对应的字节码可能是这样的：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">new</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #2                  // class MyClass</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dup</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">invokespecial</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #3        // Method &quot;&lt;init&gt;&quot;:()V</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里，<code>new</code> 指令后面跟着 <code>dup</code> 指令，用于复制新创建的对象引用到栈顶，然后 <code>invokespecial</code> 指令调用类的构造器 <code>&lt;init&gt;</code> 方法来初始化对象。</p><h3 id="方法调用指令" tabindex="-1"><a class="header-anchor" href="#方法调用指令"><span>方法调用指令</span></a></h3><p>方法调用在JVM中可以通过几种不同的指令来实现，每种指令适用于不同情况：</p><ul><li><p><code>invokevirtual</code><br> 这是最常见的方法调用形式，用于调用实例方法。JVM会在运行时查找实际的方法实现。</p></li><li><p><code>invokespecial</code><br> 用于调用实例初始化方法 <code>&lt;init&gt;</code>，私有方法，父类方法，以及 <code>super</code> 关键字调用的方法。</p></li><li><p><code>invokestatic</code><br> 用于调用静态方法，即类方法。这类方法不属于任何对象实例。</p></li><li><p><code>invokeinterface</code><br> 用于调用接口方法。JVM会在运行时查找具体实现该接口的类的方法。</p></li><li><p><code>invokedynamic</code><br> 这是一个更灵活的调用指令，允许在运行时动态解析方法引用。主要用于支持动态语言和一些框架（如 Java 8 中的 Lambda 表达式）。</p></li></ul></div><h3 id="数组操作指令" tabindex="-1"><a class="header-anchor" href="#数组操作指令"><span>数组操作指令</span></a></h3><p>数组操作指令用于处理数组的创建、访问、修改和销毁等操作。数组在JVM中是一种特殊类型的数据结构，它们被设计成可以直接支持固定长度的同类型元素集合。</p><div class="hint-container info"><p class="hint-container-title">数组的创建和常见操作指令</p><h4 id="数组创建指令" tabindex="-1"><a class="header-anchor" href="#数组创建指令"><span>数组创建指令</span></a></h4><ul><li><strong><code>newarray</code></strong>：创建一个单一维度的数组，其中<code>newarray</code>指令接受一个整数参数来指定数组的类型（如<code>T_BOOLEAN</code>, <code>T_CHAR</code>, <code>T_FLOAT</code>, <code>T_DOUBLE</code>, <code>T_BYTE</code>, <code>T_SHORT</code>, <code>T_INT</code>, <code>T_LONG</code>），并且还需要一个整数参数来指定数组的长度。</li><li><strong><code>anewarray</code></strong>：创建一个单一维度的对象数组，其中数组元素的类型由类的常量池索引确定。</li><li><strong><code>multianewarray</code></strong>：创建一个多维数组。此指令需要一个类常量池索引和一个表示数组维度的数量，以及随后的整数参数列表，每个参数表示相应维度的大小。</li></ul><h4 id="数组元素加载和存储指令" tabindex="-1"><a class="header-anchor" href="#数组元素加载和存储指令"><span>数组元素加载和存储指令</span></a></h4><p>这些指令用于从数组中加载元素或将元素存储到数组中。</p><ul><li><strong><code>baload</code>, <code>caload</code>, <code>saload</code>, <code>iaload</code>, <code>laload</code>, <code>faload</code>, <code>daload</code>, <code>aaload</code></strong>：分别用于加载<code>byte</code>, <code>char</code>, <code>short</code>, <code>int</code>, <code>long</code>, <code>float</code>, <code>double</code>, 和对象类型的数组元素到栈顶。</li><li><strong><code>bastore</code>, <code>castore</code>, <code>sastore</code>, <code>iastore</code>, <code>lastore</code>, <code>fastore</code>, <code>dastore</code>, <code>aastore</code></strong>：用于将栈顶的元素存储到相应类型的数组中指定的索引位置。</li></ul><h4 id="数组长度查询指令" tabindex="-1"><a class="header-anchor" href="#数组长度查询指令"><span>数组长度查询指令</span></a></h4><ul><li><strong><code>arraylength</code></strong>：此指令从栈顶弹出一个数组引用，并将该数组的长度压入栈顶。这通常用于获取数组的大小，而无需访问数组的任何元素。</li></ul></div><p>假设我们有如下Java代码片段，创建一个整数数组，并初始化其中的一个元素：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">[] array </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">array[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 42</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>对应的JVM字节码可能如下所示：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> newarray</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         10</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     //</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 创建一个包含10个int元素的数组</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">3:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> astore_1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         //</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 存储数组引用到局部变量表中的位置1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">4:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> iconst_5</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         //</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 将整数5推入栈顶，作为数组索引</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> aload_1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          //</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 将数组引用从局部变量表中加载到栈顶</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">6:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> iconst_42</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        //</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 将整数42推入栈顶</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">7:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> iastore</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          //</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 将栈顶的值42存储到数组的索引5处</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="异常处理指令" tabindex="-1"><a class="header-anchor" href="#异常处理指令"><span>异常处理指令</span></a></h3><div class="hint-container info"><p class="hint-container-title">异常处理指令</p><h4 id="异常抛出指令" tabindex="-1"><a class="header-anchor" href="#异常抛出指令"><span>异常抛出指令</span></a></h4><ul><li><strong><code>athrow</code></strong>：这个指令用于抛出一个异常。当JVM遇到这个指令时，它会从操作数栈中弹出一个<code>Throwable</code>对象的引用，并将其作为当前线程的未处理异常。<code>athrow</code>指令会导致当前方法的控制流立即转移到异常处理程序。</li></ul><h4 id="异常捕获和处理" tabindex="-1"><a class="header-anchor" href="#异常捕获和处理"><span>异常捕获和处理</span></a></h4><p>JVM使用异常表（exception table）来跟踪<code>try</code>块和相应的<code>catch</code>块。异常表是每个方法的一部分，它包含了以下信息：</p><ul><li><strong>起始PC</strong>：<code>try</code>块的起始字节码偏移量。</li><li><strong>结束PC</strong>：<code>try</code>块的结束字节码偏移量。</li><li><strong>处理程序PC</strong>：<code>catch</code>块的起始字节码偏移量。</li><li><strong>异常类型索引</strong>：在常量池中异常类的符号引用索引，或者<code>0</code>表示捕获所有异常。</li></ul><p>当一个异常被抛出时，JVM会从抛出点开始，回溯到最近的<code>try</code>块的开始，并检查这个<code>try</code>块的异常表，寻找一个匹配的<code>catch</code>块。如果找到一个匹配的<code>catch</code>块，JVM会将控制转移到这个<code>catch</code>块的起始点，并将异常对象压入操作数栈中。</p><ul><li><p><strong>异常处理指令</strong><br> 尽管没有直接对应于<code>try</code>, <code>catch</code>, 或<code>finally</code>的字节码指令，但JVM通过异常表和控制流指令（如<code>goto</code>和<code>jsr</code>）来实现这些语义。</p></li><li><p><strong>终止和清理指令</strong></p><ul><li><strong><code>finally</code></strong>：在Java源代码中，<code>finally</code>块用于确保某些代码无论是否发生异常都会执行。在JVM层面上，<code>finally</code>块通过在<code>try</code>块的异常表中添加一个额外的条目来实现，这个条目指向<code>finally</code>块的起始点，并且在<code>catch</code>和<code>return</code>指令之前调用它。</li></ul></li><li><p><strong>处理多个异常</strong><br> JVM允许在一个<code>try</code>块之后跟多个<code>catch</code>块，以处理不同类型的异常。在字节码级别，这表现为异常表中有多条记录，每条记录对应一个<code>catch</code>块。</p></li></ul></div><p>例：假设我们有以下Java代码：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ExceptionDemo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> /</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ArithmeticException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Caught an ArithmeticException&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Finally block executed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这段代码试图执行一个除以零的操作，这将引发一个<code>ArithmeticException</code>。由于这个异常被捕获在<code>catch</code>块中，所以它会被处理，同时<code>finally</code>块也会被执行。</p><p>使用<code>javap</code>命令，我们可以查看这段代码编译后的字节码。下面是<code>ExceptionDemo</code>类的<code>main</code>方法的部分字节码输出：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  public</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> static</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">java.lang.String[]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Code:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       0:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> getstatic</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     #2    // Field java/lang/System.out:Ljava/io/PrintStream;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       3:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldc</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">           #3    // String 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       5:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> invokevirtual</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #4    // Method java/lang/String.valueOf:(I)Ljava/lang/String;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       8:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> invokevirtual</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #5    // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      11:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> iconst_0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      12:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> iconst_0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      13:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> idiv</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      14:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> astore_1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      15:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> goto</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          27</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      18:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> astore_2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      19:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> getstatic</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     #2    // Field java/lang/System.out:Ljava/io/PrintStream;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      22:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldc</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">           #6    // String Caught an ArithmeticException</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      24:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> invokevirtual</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #5    // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      27:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> getstatic</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     #2    // Field java/lang/System.out:Ljava/io/PrintStream;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      30:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldc</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">           #7    // String Finally block executed</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      32:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> invokevirtual</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #5    // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      35:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> return</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Exception</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> table:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  target</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> type</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">           0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    15</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    18</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   Class</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> java/lang/ArithmeticException</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      Handler</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pc:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 19</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  target</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> type</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">           0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    35</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    36</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   any</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      Handler</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pc:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 37</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从字节码中，我们可以看到以下几点：</p><ul><li><code>getstatic</code> 和 <code>invokevirtual</code> 指令用于调用<code>System.out.println</code>来打印字符串。</li><li><code>idiv</code> 指令尝试执行整数除法，如果除数为零，它将抛出<code>ArithmeticException</code>。</li><li><code>astore_1</code> 是一个临时指令，用于存储<code>idiv</code>的结果（在正常情况下）。<code>goto</code> 指令用于跳过<code>catch</code>块并执行<code>finally</code>块，但如果发生了异常，<code>goto</code>将不会被执行。</li><li><code>astore_2</code> 指令用于捕获异常并存储到局部变量表中的位置2。</li><li><code>Exception table</code> 包含两行： <ul><li>第一行指示从位置0到位置15的代码是<code>try</code>块，如果在这个范围内抛出了<code>ArithmeticException</code>，则跳转到位置18，这是<code>catch</code>块的起始点。</li><li>第二行指示从位置0到位置35的代码是<code>try</code>块，如果在这个范围内抛出了任何异常，则跳转到位置36，这是<code>finally</code>块的起始点。</li></ul></li></ul><p><code>finally</code>块的处理稍有不同，它会生成一个额外的<code>any</code>类型（表示任何异常）的异常表条目，这是因为<code>finally</code>块必须在任何情况下都得到执行。因此，即使在<code>catch</code>块中再次抛出异常，<code>finally</code>块也应当被执行。</p><h3 id="方法返回指令" tabindex="-1"><a class="header-anchor" href="#方法返回指令"><span>方法返回指令</span></a></h3><p>方法返回指令是负责结束方法执行并将控制权返回给调用者的关键部分。JVM提供了几种不同的返回指令，具体取决于方法的返回类型。以下是JVM中用于方法返回的主要指令：</p><ol><li><p><strong><code>return</code></strong></p><ul><li>用于没有返回值的方法，即<code>void</code>类型的方法。当遇到此指令时，当前方法立即结束，控制流返回到调用该方法的代码处。</li></ul></li><li><p><strong><code>ireturn</code></strong></p><ul><li>当方法返回一个<code>int</code>类型的值时使用。此指令将栈顶的<code>int</code>值弹出并作为方法的返回值。</li></ul></li><li><p><strong><code>lreturn</code></strong></p><ul><li>用于返回<code>long</code>类型的值。与<code>ireturn</code>类似，但处理的是64位的<code>long</code>类型。</li></ul></li><li><p><strong><code>freturn</code></strong></p><ul><li>用于返回<code>float</code>类型的值。处理32位的<code>float</code>类型。</li></ul></li><li><p><strong><code>dreturn</code></strong></p><ul><li>用于返回<code>double</code>类型的值。处理64位的<code>double</code>类型。</li></ul></li><li><p><strong><code>areturn</code></strong></p><ul><li>用于返回对象引用或数组。将栈顶的对象引用作为返回值。</li></ul></li></ol><p>例：下面是一个简单的Java方法以及它的字节码表示：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> HelloWorld</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> printHello</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> addNumbers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> b</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> a </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> b;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用<code>javap -c</code>命令查看<code>printHello</code>和<code>addNumbers</code>方法的字节码：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Compiled</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;HelloWorld.java&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">public</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> class</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HelloWorld</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> extends</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> java.lang.Object{</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  public</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> static</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> void</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> printHello</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Code:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       0:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> getstatic</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     #2  // Field java/lang/System.out:Ljava/io/PrintStream;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       3:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldc</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">           #3  // String Hello, World!</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       5:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> invokevirtual</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #4  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       8:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  public</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> static</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> int</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> addNumbers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">int,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Code:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       0:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> iload_0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       1:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> iload_1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       2:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> iadd</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">       3:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ireturn</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对于<code>printHello</code>方法，字节码以<code>return</code>指令结束，因为这是一个<code>void</code>类型的方法。对于<code>addNumbers</code>方法，字节码以<code>ireturn</code>指令结束，因为它返回一个<code>int</code>类型的值。</p><h3 id="同步指令" tabindex="-1"><a class="header-anchor" href="#同步指令"><span>同步指令</span></a></h3><p>同步指令是用来实现线程安全的关键机制之一，主要通过管程（Monitor）的概念来实现。管程是一种抽象的数据类型，它可以控制对共享资源的访问，确保任何时刻只有一个线程可以访问被管程保护的代码段或对象。JVM提供了两种主要的同步指令来支持Java语言中的<code>synchronized</code>关键字：</p><ul><li><strong><code>monitorenter</code></strong>：当一个线程执行到此指令时，它试图获取对象的管程锁。如果该对象的锁未被任何其他线程持有，那么当前线程将获得锁并继续执行。如果锁已被其他线程持有，当前线程将被阻塞，直到锁可用为止。</li><li><strong><code>monitorexit</code></strong>：当一个线程离开<code>synchronized</code>代码块时，此指令会释放对象的管程锁，允许其他等待的线程有机会获取锁。</li></ul><div class="hint-container info"><p class="hint-container-title">同步指令实现细节</p><ul><li><strong>管程实现</strong>：JVM中的管程实现基于对象头中的锁标志位和锁记录。当一个线程试图获取锁时，JVM会检查对象头中的锁标志位，如果锁是轻量级的，线程可能会直接获得锁；如果是重量级的，线程将被加入到等待队列中。</li><li><strong>锁升级</strong>：为了提高性能，JVM使用锁升级机制，即从偏向锁升级到轻量级锁，再升级到重量级锁，根据竞争程度动态调整锁的级别。</li><li><strong>锁消除</strong>：JVM编译器可能会分析代码并消除那些在编译时就能确定不会被并发访问的锁，以减少同步开销。</li></ul></div><p>与<code>synchronized</code>不同，<code>Lock</code>接口并没有直接对应的JVM指令，而是通过更高层次的API和JVM内部的锁实现机制来工作的。当使用<code>Lock</code>接口的实现（如<code>ReentrantLock</code>）时，JVM并不会直接使用<code>monitorenter</code>和<code>monitorexit</code>指令，而是使用了更底层的锁实现，这通常涉及原子变量和CPU级别的原语。</p><ul><li><p><code>ReentrantLock</code>使用了<code>AbstractQueuedSynchronizer</code>（AQS）框架，这是一个抽象类，提供了实现自定义同步器的基础。AQS维护了一个共享的整数表示状态，以及一个FIFO线程等待队列。当一个线程请求锁时，AQS会检查当前的状态，如果锁可用，它会修改状态并允许线程继续。如果锁不可用，线程将被加入到等待队列中。</p></li><li><p><code>ReentrantLock</code>和其他基于AQS的同步器，如<code>Semaphore</code>和<code>CountDownLatch</code>，<mark>使用了<code>Unsafe</code>类中的本机方法来实现原子更新和线程阻塞</mark>。这意味着当一个线程尝试获取锁时，它实际上调用了<code>Unsafe</code>类中的<code>compareAndSwapInt</code>或<code>compareAndSwapObject</code>方法来更新AQS的状态，而当线程等待锁时，它将被挂起到一个操作系统级别的等待队列上。</p></li></ul><p>总的来说，<code>Lock</code>接口的实现更复杂，它们利用了JVM的底层机制和操作系统提供的原语，而不是像<code>synchronized</code>那样直接映射到特定的JVM指令。这种设计允许更高级别的并发控制，同时也带来了更高的灵活性和潜在的性能优势。</p><h3 id="访问常量池" tabindex="-1"><a class="header-anchor" href="#访问常量池"><span>访问常量池</span></a></h3><p>常量池是一个非常重要的数据结构，它包含了类或接口编译期间生成的各种字面量和符号引用。常量池可以被看作是Class文件的一个组成部分，它在类加载阶段被加载到方法区（在HotSpot虚拟机中称为Metaspace），并在运行时成为运行时常量池的一部分。</p><p>JVM提供了多种指令来访问常量池中的信息，这些指令用于在执行过程中获取各种常量和引用。下面是一些常见的访问常量池的JVM指令：</p><ol><li><p><strong><code>ldc</code></strong>（Load Constant）</p><ul><li>这个指令用于将常量池中的一个常量加载到操作数栈顶。<code>ldc</code>指令可以加载整数、浮点数、字符串或符号引用。</li></ul></li><li><p><strong><code>ldc_w</code></strong> 和 <strong><code>ldc2_w</code></strong></p><ul><li>这两个指令类似于<code>ldc</code>，但是它们使用宽索引，允许访问更大的常量池索引空间。<code>ldc_w</code>用于加载单个字节码宽度的常量，而<code>ldc2_w</code>用于加载双字节宽度的常量，如<code>long</code>和<code>double</code>。</li></ul></li><li><p><strong><code>getstatic</code></strong> 和 <strong><code>putstatic</code></strong></p><ul><li>这些指令用于访问类或接口中的静态字段。<code>getstatic</code>用于从常量池中获取静态字段的值，并将其压入操作数栈。<code>putstatic</code>用于将操作数栈顶的值存储到静态字段中。</li></ul></li><li><p><strong><code>invoke*</code></strong> 指令</p><ul><li>所有的方法调用指令（如<code>invokevirtual</code>、<code>invokespecial</code>、<code>invokestatic</code>和<code>invokeinterface</code>）都需要访问常量池以获取方法的符号引用。这些指令会根据常量池中的信息找到正确的方法并进行调用。</li></ul></li><li><p><strong><code>checkcast</code></strong> 和 <strong><code>instanceof</code></strong></p><ul><li>这些指令需要访问常量池中的类和接口的符号引用，以确定运行时对象的类型或进行类型转换。</li></ul></li><li><p><strong><code>new</code></strong></p><ul><li>当创建一个新的对象实例时，<code>new</code>指令需要从常量池中获取类的符号引用，以便创建正确的对象实例。</li></ul></li><li><p><strong><code>multianewarray</code></strong></p><ul><li>这个指令用于创建多维数组。它需要访问常量池中的数组类的符号引用。</li></ul></li></ol><h2 id="asm库及其应用" tabindex="-1"><a class="header-anchor" href="#asm库及其应用"><span>ASM库及其应用</span></a></h2><p>ASM库是一个专门用于操作Java字节码的开源框架。它由Fabien Fouquet开发，主要用于在运行时动态生成类或者修改已存在的类(增强已有类的功能)。ASM库能够直接创建或修改<code>.class</code>文件，这使得它在许多需要进行字节码级操作的场景下非常有用。</p><div class="hint-container info"><p class="hint-container-title">以下是ASM库的一些关键特点和用途：</p><ol><li><p><strong>字节码操作</strong>：ASM允许程序员在字节码级别上分析和修改Java类。这意味着你可以改变类的方法、字段、注解，甚至可以添加新的类或方法。</p></li><li><p><strong>高性能</strong>：ASM库的设计注重性能，它尽量减少内存消耗和CPU使用，这使得它非常适合在需要高速字节码操作的环境中使用，比如在编译器或动态代理系统中。</p></li><li><p><strong>API设计</strong>：ASM提供了一套简洁的API，这些API遵循事件驱动模型。当你使用ASM创建或修改类时，你会收到一系列事件，这些事件允许你在适当的位置插入代码。</p></li><li><p><strong>动态生成类</strong>：ASM可以用于在运行时动态生成Java类。这对于创建自定义的元编程解决方案、构建代码生成工具或测试框架等非常有帮助。</p></li><li><p><strong>字节码分析</strong>：除了修改字节码，ASM还可以用于分析字节码。这对于反编译、代码审查和安全审计等场景非常有用。</p></li><li><p><strong>兼容性</strong>：ASM库支持从Java 5到最新的Java版本的字节码格式，这意味着你可以使用它来处理不同版本的Java类文件。</p></li><li><p><strong>使用案例</strong>：ASM被广泛应用于各种场景，包括但不限于编译器、动态代理库（如CGLIB）、性能监控工具、代码优化工具、安全框架等。</p></li></ol></div><p>ASM是一个强大的工具，它为Java开发者提供了在字节码级别上操作和分析代码的能力。无论是动态生成代码、优化现有代码还是进行代码分析，ASM都是一个值得掌握的库。</p><h3 id="asm库的使用" tabindex="-1"><a class="header-anchor" href="#asm库的使用"><span>ASM库的使用</span></a></h3><p>ASM库使用基于访问者模式的API，这允许用户在字节码级别上创建和修改类。</p><p>首先，确保你的项目已经包含了ASM库的依赖。如果你使用Maven，可以在<code>pom.xml</code>文件中添加如下依赖：</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;org.ow2.asm&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;asm&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;9.3&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来开始使用ASM创建一个类：</p><ol><li><p><strong>创建ClassWriter实例</strong>：<br> ClassWriter是负责生成字节码的主要类。你需要告诉ClassWriter你想生成的类的版本号。</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ClassWriter</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cw </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ClassWriter</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ClassWriter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">COMPUTE_MAXS</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>定义类的访问标志、名称、超类、接口等</strong>：<br> 使用<code>visit</code>方法来定义类的基本信息，包括访问标志、类名、超类名和实现的接口列表。</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">cw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Opcodes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">V1_8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">         Opcodes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ACC_PUBLIC</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Opcodes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ACC_SUPER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         &quot;com/example/MyClass&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         &quot;java/lang/Object&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>添加字段</strong>：<br> 使用<code>visitField</code>方法来添加字段，并且不要忘记调用<code>visitEnd</code>结束字段的定义。</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">FieldVisitor</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> fv </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitField</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        Opcodes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ACC_PRIVATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;myField&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;Ljava/lang/String;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (fv </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    fv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitEnd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>添加方法</strong>：<br> 使用<code>visitMethod</code>方法来添加方法。对于构造函数和普通方法，你都需要调用<code>visitMethod</code>并提供相应的参数。</p><p>添加构造函数：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">MethodVisitor</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mv </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        Opcodes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ACC_PUBLIC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;&lt;init&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;()V&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (mv </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 编写构造函数的字节码</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitCode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitVarInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ALOAD, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMethodInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(INVOKESPECIAL, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;java/lang/Object&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&lt;init&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;()V&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(RETURN);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMaxs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitEnd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>添加一个普通方法：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">mv </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        Opcodes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ACC_PUBLIC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;hello&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;()V&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (mv </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 编写方法的字节码</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitCode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitLdcInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitVarInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ALOAD, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitFieldInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(PUTFIELD, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;com/example/MyClass&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;myField&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Ljava/lang/String;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(RETURN);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMaxs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitEnd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>MethodVisitor编写字节码指令的相关方法介绍</strong>：<br> 在上面的例子中，我们已经在添加方法的部分编写了字节码指令。<code>mv.visitCode()</code>之后和<code>mv.visitEnd()</code>之前的所有指令都构成了方法的字节码。</p><details class="hint-container details"><summary>MethodVisitor编写字节码指令的相关方法</summary><p><code>MethodVisitor</code>是用于访问和修改方法的访问者。当你使用<code>ClassWriter.visitMethod</code>或<code>ClassReader.accept</code>时，你会得到一个<code>MethodVisitor</code>实例，然后可以使用它来生成或修改方法的字节码。下面是一些常用的<code>MethodVisitor</code>方法，它们用于生成不同的字节码指令：</p><ul><li><p><strong>访问方法代码块</strong>:</p><ul><li><code>visitCode()</code>: 开始方法体的字节码。</li><li><code>visitMaxs(int maxStack, int maxLocals)</code>: 定义方法的最大操作数栈深度（maxStack）和局部变量的数量（maxLocals）。这些值通常需要计算，而<code>ClassWriter.COMPUTE_FRAMES</code>或<code>ClassWriter.COMPUTE_MAXS</code>可以帮助计算正确的值。</li><li><code>visitEnd()</code>: 结束方法体的字节码。</li></ul></li><li><p><strong>操作常量池</strong>:</p><ul><li><code>visitLdcInsn(Object cst)</code>: 将常量推入操作数栈。常量可以是整型、浮点型、字符串或类型对象。</li><li><code>visitIntInsn(int opcode, int operand)</code>: 执行只带有一个操作数的整型指令，例如<code>NEWARRAY</code>。</li></ul></li><li><p><strong>操作变量</strong>:</p><ul><li><code>.visitVarInsn(int opcode, int var)</code>: 操作局部变量。<code>opcode</code>可以是<code>ILOAD</code>、<code>ISTORE</code>、<code>ALOAD</code>等，<code>var</code>是局部变量的索引。</li><li><code>visitVarInsn(int opcode, int local, int extendedIndex)</code>: 与<code>.visitVarInsn</code>类似，但在某些情况下用于访问更宽范围的局部变量。</li></ul></li><li><p><strong>执行操作</strong>:</p><ul><li><code>visitInsn(int opcode)</code>: 执行不带操作数的指令，如<code>NOP</code>、<code>POP</code>、<code>DUP</code>等。</li><li><code>visitTypeInsn(int opcode, String type)</code>: 执行与类型相关的指令，如<code>NEW</code>、<code>CHECKCAST</code>、<code>INSTANCEOF</code>等。</li><li><code>visitFieldInsn(int opcode, String owner, String name, String desc)</code>: 访问字段，如<code>GETSTATIC</code>、<code>PUTFIELD</code>。</li><li><code>visitMethodInsn(int opcode, String owner, String name, String desc, boolean itf)</code>: 调用方法，如<code>INVOKEVIRTUAL</code>、<code>INVOKESTATIC</code>。</li><li><code>visitJumpInsn(int opcode, Label label)</code>: 执行跳转指令，如<code>IFEQ</code>、<code>GOTO</code>。</li><li><code>visitLocalVariable(String name, String desc, String signature, Label start, Label end, int index)</code>: 定义局部变量的符号信息。</li></ul></li><li><p><strong>异常处理</strong>:</p><ul><li><code>visitTryCatchBlock(Label start, Label end, Label handler, String type)</code>: 定义一个异常处理块。</li><li><code>visitLocalVariableTable()</code>: 访问局部变量表。</li></ul></li><li><p><strong>标记位置</strong>:</p><ul><li><code>visitLabel(Label label)</code>: 设置一个标签，用于跳转指令的目标或异常处理块的边界。</li></ul></li><li><p><strong>属性和注解</strong>:</p><ul><li><code>visitAttribute(Attribute attr)</code>: 添加方法属性。</li><li><code>visitAnnotation(String desc, boolean visible)</code>: 添加方法注解。</li><li><code>visitTypeAnnotation(int typeRef, TypePath typePath, String desc, boolean visible)</code>: 添加类型注解。</li></ul></li></ul></details></li><li><p><strong>调用ClassWriter的toByteArray()方法获取字节码</strong>：<br> 最后，使用<code>toByteArray</code>方法将所有定义的类信息转换成字节码数组。</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">byte</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">[] b </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toByteArray</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><p>最终，你可以将得到的字节码数组写入到<code>.class</code>文件中，或者将其加载到JVM中动态创建类。</p><h3 id="常见asm应用" tabindex="-1"><a class="header-anchor" href="#常见asm应用"><span>常见ASM应用</span></a></h3><p>ASM是一个强大的Java字节码操作和分析框架，允许你动态地生成类或者修改现有的类。以下是使用ASM进行这些操作的一些示例：</p><p><strong>动态生成类</strong>：</p><ol><li>创建一个<code>ClassWriter</code>实例，指定版本号和输出模式。</li><li>使用<code>ClassWriter.visitMethod</code>方法定义类的字段和方法。</li><li>使用<code>MethodVisitor</code>来生成方法的字节码。</li><li>使用<code>ClassWriter.toByteArray</code>获取生成的字节码。</li></ol><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ClassWriter</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cw </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ClassWriter</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ClassWriter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">COMPUTE_FRAMES</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">cw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(V1_8, ACC_PUBLIC </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ACC_SUPER, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;com/example/TestClass&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;java/lang/Object&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">{</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    MethodVisitor</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mv </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ACC_PUBLIC, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&lt;init&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;()V&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitCode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitVarInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ALOAD, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMethodInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(INVOKESPECIAL, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;java/lang/Object&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&lt;init&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;()V&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(RETURN);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMaxs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitEnd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">byte</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">[] b </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toByteArray</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><p><strong>修改方法体，添加或删除字节码指令</strong>：</p><p>使用ASM修改方法体涉及创建一个<code>ClassReader</code>来读取现有的类文件，然后使用<code>ClassAdapter</code>和<code>MethodAdapter</code>来修改方法。</p><ol><li>使用<code>ClassReader</code>读取类文件。</li><li>使用<code>ClassAdapter</code>来捕获并修改类结构。</li><li>在<code>ClassAdapter</code>中使用<code>MethodAdapter</code>来修改具体方法的字节码。</li><li>使用<code>ClassWriter</code>将修改后的类写入。</li></ol><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ClassReader</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cr </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ClassReader</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;com/example/TestClass&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ClassWriter</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cw </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ClassWriter</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(cr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> ClassWriter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">COMPUTE_FRAMES</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ClassAdapter</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ca </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ClassAdapter</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(cw) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MethodVisitor</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> visitMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> access</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> desc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> signature</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">exceptions</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        MethodVisitor</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mv</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> super</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(access, name, desc, signature, exceptions);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> MethodAdapter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(mv) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> visitMethodInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> opcode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> owner</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> desc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">boolean</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> itf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">owner</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">equals</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;java/lang/System&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&amp;&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">equals</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;out&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                    super</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMethodInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(INVOKESTATIC, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;java/lang/System&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;err&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Ljava/io/PrintStream;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                super</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMethodInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(opcode, owner, name, desc, itf);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        };</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">cr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">accept</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ca, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">byte</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">[] b </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toByteArray</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><p><strong>实现类的动态代理或AOP</strong>：</p><p>在Java中，动态代理通常通过<code>java.lang.reflect.Proxy</code>实现，但是使用ASM可以更加灵活和高效地实现动态代理和AOP（面向切面编程）。</p><ol><li>使用<code>ClassWriter</code>创建代理类。</li><li>定义代理类的方法，使其调用接口方法并通过<code>INVOKEINTERFACE</code>调用代理逻辑。</li><li>使用反射或直接加载生成的类。</li></ol><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ClassWriter</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cw </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ClassWriter</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">cw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(V1_8, ACC_PUBLIC </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ACC_SUPER, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;com/example/ProxyClass&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;java/lang/Object&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[]{</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;com/example/MyInterface&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">{</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    MethodVisitor</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mv </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ACC_PUBLIC, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&lt;init&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;()V&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitCode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitVarInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ALOAD, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMethodInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(INVOKESPECIAL, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;java/lang/Object&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&lt;init&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;()V&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(RETURN);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMaxs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitEnd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">{</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    MethodVisitor</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mv </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ACC_PUBLIC, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;myMethod&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;()V&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitCode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitVarInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ALOAD, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMethodInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(INVOKEINTERFACE, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;com/example/MyInterface&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;myMethod&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;()V&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(RETURN);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMaxs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitEnd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">byte</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">[] b </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toByteArray</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Class</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> proxyClass </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Loader</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">defineClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;com/example/ProxyClass&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, b);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> proxyInstance </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> proxyClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getConstructor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">newInstance</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">((MyInterface) proxyInstance)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">myMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上示例展示了如何使用ASM动态生成一个实现了<code>MyInterface</code>接口的代理类，并在<code>myMethod</code>方法中调用了接口方法。这只是一个基本的示例，实际的AOP逻辑可能包括额外的逻辑，如拦截器链、性能监控等。</p><h3 id="asm与性能优化" tabindex="-1"><a class="header-anchor" href="#asm与性能优化"><span>ASM与性能优化</span></a></h3><p>ASM框架在Java性能优化方面扮演着重要角色，因为它允许开发者在运行时动态地修改和生成字节码。这种能力对于性能优化尤其有价值，因为可以直接针对特定场景定制和优化字节码，而无需重新编译整个应用程序。以下是一些常见的使用ASM进行性能优化的策略：</p><div class="hint-container info"><p class="hint-container-title">常见的ASM性能优化策略</p><h4 id="_1-字节码增强" tabindex="-1"><a class="header-anchor" href="#_1-字节码增强"><span>1. <strong>字节码增强</strong></span></a></h4><ul><li><strong>方法内联</strong>：ASM可以用来识别小的、频繁调用的方法，并将其内联到调用者中，从而减少方法调用开销。</li><li><strong>循环展开</strong>：对于计算密集型的循环，可以通过ASM将循环体复制多次，减少循环控制结构的开销。</li><li><strong>类型检查消除</strong>：在多态调用中，如果类型检查在运行时总是返回相同的结果，ASM可以去除这些检查，直接调用正确的方法。</li></ul><h4 id="_2-代码生成" tabindex="-1"><a class="header-anchor" href="#_2-代码生成"><span>2. <strong>代码生成</strong></span></a></h4><ul><li><strong>动态代理</strong>：使用ASM生成动态代理类，避免了传统的代理模式带来的性能损失。</li><li><strong>元数据处理</strong>：ASM可以用于生成用于元数据处理的类，比如构建ORM映射或事件处理器，这可以减少运行时的反射开销。</li></ul><h4 id="_3-静态字段初始化优化" tabindex="-1"><a class="header-anchor" href="#_3-静态字段初始化优化"><span>3. <strong>静态字段初始化优化</strong></span></a></h4><ul><li>对于包含大量静态字段的类，可以使用ASM将这些字段的初始化逻辑延迟到真正需要使用时再执行，避免了不必要的初始化成本。</li></ul><h4 id="_4-aop-面向切面编程" tabindex="-1"><a class="header-anchor" href="#_4-aop-面向切面编程"><span>4. <strong>AOP（面向切面编程）</strong></span></a></h4><ul><li>使用ASM可以在运行时动态地向现有类添加切面，例如添加日志记录、安全检查或性能监控代码，而不会显著影响应用程序的性能。</li></ul><h4 id="_5-性能监控和分析" tabindex="-1"><a class="header-anchor" href="#_5-性能监控和分析"><span>5. <strong>性能监控和分析</strong></span></a></h4><ul><li>通过ASM，可以在方法的入口和出口点插入监控代码，收集性能数据，这对于理解程序的运行时行为和瓶颈至关重要。</li></ul><h4 id="_6-内存优化" tabindex="-1"><a class="header-anchor" href="#_6-内存优化"><span>6. <strong>内存优化</strong></span></a></h4><ul><li>通过对字节码的分析和修改，ASM可以帮助减少对象的创建和销毁，例如通过复用对象或使用更有效的数据结构。</li></ul><h4 id="_7-jit编译优化" tabindex="-1"><a class="header-anchor" href="#_7-jit编译优化"><span>7. <strong>JIT编译优化</strong></span></a></h4><ul><li>虽然JIT编译器已经相当智能，但在某些情况下，使用ASM手动调整字节码可以使JIT编译器的工作更加高效，从而产生更快的机器代码。</li></ul><h4 id="_8-网络和i-o优化" tabindex="-1"><a class="header-anchor" href="#_8-网络和i-o优化"><span>8. <strong>网络和I/O优化</strong></span></a></h4><ul><li>在网络和I/O密集型应用中，使用ASM优化网络包的序列化和反序列化过程，或者减少不必要的I/O操作，可以显著提高性能。</li></ul><h4 id="_9-垃圾回收优化" tabindex="-1"><a class="header-anchor" href="#_9-垃圾回收优化"><span>9. <strong>垃圾回收优化</strong></span></a></h4><ul><li>通过减少对象的分配和引用计数的操作，ASM可以帮助减少垃圾回收的频率和持续时间。</li></ul></div><p>例：使用ASM进行性能优化</p><p>假设我们有一个方法，它频繁地调用另一个小方法来获取某个值：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getValue</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> smallMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> smallMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 一些简单的计算</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 42</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们可以使用ASM将<code>smallMethod()</code>内联到<code>getValue()</code>中，以减少方法调用的开销：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 使用ASM生成新的getValue方法</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">MethodVisitor</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mv </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ACC_PUBLIC, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;getValue&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;()I&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitCode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 直接在这里复制smallMethod的内容，而不是调用它</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ICONST_42);</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // 假设smallMethod的返回值是常数42</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitInsn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(IRETURN);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitMaxs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visitEnd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样，每次调用<code>getValue()</code>时，不再有方法调用的开销，提高了性能。</p><p>总之，ASM提供了一种强大的工具，使开发者能够深入到Java应用程序的内部，对字节码进行精细的控制和优化，从而达到性能提升的目的。然而，使用ASM也需要谨慎，因为它可能会引入复杂性和潜在的错误，而且并非所有的性能问题都可以通过字节码级别的优化解决。</p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/ventixy/notebook/edit/main/src/java/syntax/senior/bytecode.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">Last update: </span><!----></div><div class="contributors"><span class="vp-meta-label">Contributors: </span><!--[--><!--[--><span class="vp-meta-info" title="email: msdrizzle@outlook.com">drizzle</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/java/syntax/senior/pt.html" aria-label="JVM性能调优"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->JVM性能调优</div></a><!----></nav><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">Default footer</div><div class="vp-copyright">Copyright © 2025 ventixy </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BPJY8eZI.js" defer></script>
  </body>
</html>
