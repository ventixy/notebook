<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.15" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://x.app/posts/db/postgres.html"><meta property="og:site_name" content="doc"><meta property="og:title" content="PostgreSQLæ•°æ®åº“"><meta property="og:description" content="PostgreSQL æ˜¯ä¸€ä¸ªå¼€æºçš„å¯¹è±¡å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆORDBMSï¼‰ã€‚å®ƒæœ€åˆäº1986å¹´åœ¨åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡ä½œä¸º POSTGRES é¡¹ç›®å¯åŠ¨ï¼Œå¹¶äº1996å¹´æ›´åä¸º PostgreSQLï¼Œä»¥åæ˜ å…¶å¯¹ SQL æ ‡å‡†çš„æ”¯æŒã€‚ æ ¸å¿ƒç‰¹æ€§ï¼šå®Œå…¨ç¬¦åˆSQLæ ‡å‡†ï¼Œæ’ä»¶ä¸°å¯Œã€‚ä¸”æœ‰ Neon å’Œ supadata ä¸¤å®¶å…è´¹çš„æ•°æ®åº“äº‘æœåŠ¡ å›¾å½¢åŒ–ç®¡ç†å·¥å…· - pgA..."><meta property="og:type" content="article"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2025-05-22T13:36:02.000Z"><meta property="article:author" content="ventixy"><meta property="article:tag" content="Database"><meta property="article:tag" content="PostgreSQL"><meta property="article:tag" content="PGVector"><meta property="article:published_time" content="2025-05-21T00:00:00.000Z"><meta property="article:modified_time" content="2025-05-22T13:36:02.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"PostgreSQLæ•°æ®åº“","image":[""],"datePublished":"2025-05-21T00:00:00.000Z","dateModified":"2025-05-22T13:36:02.000Z","author":[{"@type":"Person","name":"ventixy","url":"https://www.ventix.top"}]}</script><link rel="icon" href="/jav.ico"><title>PostgreSQLæ•°æ®åº“ | doc</title><meta name="description" content="PostgreSQL æ˜¯ä¸€ä¸ªå¼€æºçš„å¯¹è±¡å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆORDBMSï¼‰ã€‚å®ƒæœ€åˆäº1986å¹´åœ¨åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡ä½œä¸º POSTGRES é¡¹ç›®å¯åŠ¨ï¼Œå¹¶äº1996å¹´æ›´åä¸º PostgreSQLï¼Œä»¥åæ˜ å…¶å¯¹ SQL æ ‡å‡†çš„æ”¯æŒã€‚ æ ¸å¿ƒç‰¹æ€§ï¼šå®Œå…¨ç¬¦åˆSQLæ ‡å‡†ï¼Œæ’ä»¶ä¸°å¯Œã€‚ä¸”æœ‰ Neon å’Œ supadata ä¸¤å®¶å…è´¹çš„æ•°æ®åº“äº‘æœåŠ¡ å›¾å½¢åŒ–ç®¡ç†å·¥å…· - pgA...">
    <link rel="preload" href="/assets/style-B_XoRuKw.css" as="style"><link rel="stylesheet" href="/assets/style-B_XoRuKw.css">
    <link rel="modulepreload" href="/assets/app-BptLyOzL.js"><link rel="modulepreload" href="/assets/postgres.html-CZobSFmg.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-CYhovCRG.js" as="script"><link rel="prefetch" href="/assets/blog.html-BGm_Cf-u.js" as="script"><link rel="prefetch" href="/assets/intro.html-D37a6vnQ.js" as="script"><link rel="prefetch" href="/assets/index.html-Dl03YUTa.js" as="script"><link rel="prefetch" href="/assets/dev.html-BL-28wvN.js" as="script"><link rel="prefetch" href="/assets/lang.html-CxdcETOx.js" as="script"><link rel="prefetch" href="/assets/mcp.html-C_U3sHta.js" as="script"><link rel="prefetch" href="/assets/program.html-C43UoucH.js" as="script"><link rel="prefetch" href="/assets/prompt.html-BQOpJTRF.js" as="script"><link rel="prefetch" href="/assets/rag.html-C_HISP3D.js" as="script"><link rel="prefetch" href="/assets/springai.html-DXgRIuXM.js" as="script"><link rel="prefetch" href="/assets/index.html-BrEs9Eca.js" as="script"><link rel="prefetch" href="/assets/index.html-BtuY4y6r.js" as="script"><link rel="prefetch" href="/assets/index.html-B3G2BpRD.js" as="script"><link rel="prefetch" href="/assets/index.html-CvPs1bcp.js" as="script"><link rel="prefetch" href="/assets/Gradle.html-DgMgO6Hg.js" as="script"><link rel="prefetch" href="/assets/index.html-Dmz1VBHo.js" as="script"><link rel="prefetch" href="/assets/maven.html-bz749gbd.js" as="script"><link rel="prefetch" href="/assets/theme.html-B5egaB7Y.js" as="script"><link rel="prefetch" href="/assets/index.html-BsVmV3cv.js" as="script"><link rel="prefetch" href="/assets/index.html-CwVq_K1t.js" as="script"><link rel="prefetch" href="/assets/index.html-I3fWixw-.js" as="script"><link rel="prefetch" href="/assets/c.html-D60F1rfs.js" as="script"><link rel="prefetch" href="/assets/c2.html-CLExJYbb.js" as="script"><link rel="prefetch" href="/assets/core.html-dzRibdBQ.js" as="script"><link rel="prefetch" href="/assets/index.html-CmcHGBTI.js" as="script"><link rel="prefetch" href="/assets/Annotation.html-CPur1L_M.js" as="script"><link rel="prefetch" href="/assets/Enum.html-o-9cikLb.js" as="script"><link rel="prefetch" href="/assets/HashMap.html-Bx-YboLU.js" as="script"><link rel="prefetch" href="/assets/JavaåŸºç¡€.html-j8BwZal2.js" as="script"><link rel="prefetch" href="/assets/Javaå¸¸ç”¨ç±»åº“.html-Bycl8K2P.js" as="script"><link rel="prefetch" href="/assets/Javaé¢å‘å¯¹è±¡.html-BfXLyzg8.js" as="script"><link rel="prefetch" href="/assets/Lambda.html-C7WbmFkn.js" as="script"><link rel="prefetch" href="/assets/index.html-DoD2UXBv.js" as="script"><link rel="prefetch" href="/assets/Reflection.html-DNtwQtpc.js" as="script"><link rel="prefetch" href="/assets/Stream.html-DOIwgG9N.js" as="script"><link rel="prefetch" href="/assets/collection.html-Ce1KAZ-Y.js" as="script"><link rel="prefetch" href="/assets/generics.html-CQ8gymom.js" as="script"><link rel="prefetch" href="/assets/javaIO.html-LiNypL54.js" as="script"><link rel="prefetch" href="/assets/setå’Œmap.html-B1hNdSuG.js" as="script"><link rel="prefetch" href="/assets/æ•°ç»„å’Œå­—ç¬¦ä¸².html-DnzIrpea.js" as="script"><link rel="prefetch" href="/assets/index.html-BBRSP2b2.js" as="script"><link rel="prefetch" href="/assets/index.html-aA9HsxVj.js" as="script"><link rel="prefetch" href="/assets/index.html-Dyo-bWTj.js" as="script"><link rel="prefetch" href="/assets/index.html-DJtpYhGU.js" as="script"><link rel="prefetch" href="/assets/index.html-2AtzE2jL.js" as="script"><link rel="prefetch" href="/assets/index.html-Blm18XpS.js" as="script"><link rel="prefetch" href="/assets/idea.html-CZXbQFsB.js" as="script"><link rel="prefetch" href="/assets/mac.html-C_bnbcWT.js" as="script"><link rel="prefetch" href="/assets/nuc8.html-DTR5Ugd3.js" as="script"><link rel="prefetch" href="/assets/picgo.html-CZ9mHx7o.js" as="script"><link rel="prefetch" href="/assets/usual.html-N_1Axlyn.js" as="script"><link rel="prefetch" href="/assets/vps.html-CtE6vSGx.js" as="script"><link rel="prefetch" href="/assets/website.html-CYr01-3c.js" as="script"><link rel="prefetch" href="/assets/windows.html-BWcwbcbs.js" as="script"><link rel="prefetch" href="/assets/index.html-DiMYs_yT.js" as="script"><link rel="prefetch" href="/assets/encoding.html-2OWm-AAW.js" as="script"><link rel="prefetch" href="/assets/harddisk.html-BlQyHWEm.js" as="script"><link rel="prefetch" href="/assets/index.html-BQRALuKd.js" as="script"><link rel="prefetch" href="/assets/mysql-binlog.html-ER2IF86J.js" as="script"><link rel="prefetch" href="/assets/mysql-lock.html-f42jhmzK.js" as="script"><link rel="prefetch" href="/assets/mysql.html-0e3GfwO4.js" as="script"><link rel="prefetch" href="/assets/ulimit.html-DBkFxyGY.js" as="script"><link rel="prefetch" href="/assets/index.html-DtCZhRUS.js" as="script"><link rel="prefetch" href="/assets/env.html-BtqJ2-50.js" as="script"><link rel="prefetch" href="/assets/history.html-BUAyH6yy.js" as="script"><link rel="prefetch" href="/assets/jar.html-uNynLQWj.js" as="script"><link rel="prefetch" href="/assets/kryo.html-lArhxLOR.js" as="script"><link rel="prefetch" href="/assets/index.html-DX6LbtHi.js" as="script"><link rel="prefetch" href="/assets/k8s.html-N01MBQQh.js" as="script"><link rel="prefetch" href="/assets/ks-install.html-FtkWPaGY.js" as="script"><link rel="prefetch" href="/assets/vm.html-Diqb_vs7.js" as="script"><link rel="prefetch" href="/assets/index.html-B2gkquHq.js" as="script"><link rel="prefetch" href="/assets/crossDomain.html-JZhRxnfj.js" as="script"><link rel="prefetch" href="/assets/excel.html-C6M9H90w.js" as="script"><link rel="prefetch" href="/assets/springboot.html-xikvK-6j.js" as="script"><link rel="prefetch" href="/assets/index.html-DIRLKtE4.js" as="script"><link rel="prefetch" href="/assets/index.html-CRdou-mg.js" as="script"><link rel="prefetch" href="/assets/PICO.html-NcsaaWcd.js" as="script"><link rel="prefetch" href="/assets/index.html-QPR6nvdM.js" as="script"><link rel="prefetch" href="/assets/ch9329.html-y47E29Wu.js" as="script"><link rel="prefetch" href="/assets/damb.html-BhylcEtq.js" as="script"><link rel="prefetch" href="/assets/hid.html-D4QoXKmj.js" as="script"><link rel="prefetch" href="/assets/index.html-u0rZ3eSo.js" as="script"><link rel="prefetch" href="/assets/base.html-CC3abuyf.js" as="script"><link rel="prefetch" href="/assets/data.html-CI1Uf0-U.js" as="script"><link rel="prefetch" href="/assets/file.html-Cy4zcqJ8.js" as="script"><link rel="prefetch" href="/assets/function.html-ByuDiuKu.js" as="script"><link rel="prefetch" href="/assets/oop.html-CKIBmJhg.js" as="script"><link rel="prefetch" href="/assets/index.html--9_skUNv.js" as="script"><link rel="prefetch" href="/assets/pywin32.html-BeAeN62O.js" as="script"><link rel="prefetch" href="/assets/yolo.html-CFNLChOD.js" as="script"><link rel="prefetch" href="/assets/index.html-B1-BnFWI.js" as="script"><link rel="prefetch" href="/assets/base.html-CxR3EQXt.js" as="script"><link rel="prefetch" href="/assets/numpy.html-Chto9hB4.js" as="script"><link rel="prefetch" href="/assets/opencv.html-Dgr3xYTn.js" as="script"><link rel="prefetch" href="/assets/pillow.html-BnFZMJDk.js" as="script"><link rel="prefetch" href="/assets/python.html-CU4m_pG0.js" as="script"><link rel="prefetch" href="/assets/sd.html-DOMyGuY0.js" as="script"><link rel="prefetch" href="/assets/index.html-Ci3I7pG7.js" as="script"><link rel="prefetch" href="/assets/application.html-DncefQFC.js" as="script"><link rel="prefetch" href="/assets/call.html-BbzYFHwS.js" as="script"><link rel="prefetch" href="/assets/http.html-BicWtecO.js" as="script"><link rel="prefetch" href="/assets/interface.html-B64A5qW7.js" as="script"><link rel="prefetch" href="/assets/io.html-C7BEDxqe.js" as="script"><link rel="prefetch" href="/assets/memory.html-CGxV1wJA.js" as="script"><link rel="prefetch" href="/assets/network.html-CDdyZLAb.js" as="script"><link rel="prefetch" href="/assets/os.html-DRA7Ln3V.js" as="script"><link rel="prefetch" href="/assets/process.html-D3XE3IUs.js" as="script"><link rel="prefetch" href="/assets/transport.html-Cp9myM1S.js" as="script"><link rel="prefetch" href="/assets/index.html-CnEsG6-S.js" as="script"><link rel="prefetch" href="/assets/index.html-C2gCu8GE.js" as="script"><link rel="prefetch" href="/assets/Linux.html-D3IjOmsy.js" as="script"><link rel="prefetch" href="/assets/index.html-DipIWq3W.js" as="script"><link rel="prefetch" href="/assets/file.html-6J_H2EJH.js" as="script"><link rel="prefetch" href="/assets/setting.html-B--6c0OW.js" as="script"><link rel="prefetch" href="/assets/shell.html-CWtoUZew.js" as="script"><link rel="prefetch" href="/assets/Docker.html-CRKLgGyD.js" as="script"><link rel="prefetch" href="/assets/index.html-DyK9pkAe.js" as="script"><link rel="prefetch" href="/assets/install.html-CfzJGM2D.js" as="script"><link rel="prefetch" href="/assets/k8s.html-BDEyVG56.js" as="script"><link rel="prefetch" href="/assets/index.html-D3Su6Gy4.js" as="script"><link rel="prefetch" href="/assets/git.html-xh8iOQ1p.js" as="script"><link rel="prefetch" href="/assets/git1.html-C82_SomB.js" as="script"><link rel="prefetch" href="/assets/jenkins.html-BQU__iDJ.js" as="script"><link rel="prefetch" href="/assets/index.html-H3njTOiC.js" as="script"><link rel="prefetch" href="/assets/index.html-qSHxthjk.js" as="script"><link rel="prefetch" href="/assets/index.html-6ZzI-CJc.js" as="script"><link rel="prefetch" href="/assets/index.html-YprXWmVK.js" as="script"><link rel="prefetch" href="/assets/index.html-CR46KpQL.js" as="script"><link rel="prefetch" href="/assets/netty.html-DP0CosFa.js" as="script"><link rel="prefetch" href="/assets/nio.html-Dn5DD-7t.js" as="script"><link rel="prefetch" href="/assets/socket.html-B3TAG7dS.js" as="script"><link rel="prefetch" href="/assets/theory.html-CT40D8Zh.js" as="script"><link rel="prefetch" href="/assets/Jvmå†…å­˜ç®¡ç†.html-Cu0zz9p0.js" as="script"><link rel="prefetch" href="/assets/Jvmç±»åŠ è½½.html-BkfpZo1R.js" as="script"><link rel="prefetch" href="/assets/index.html-BVwk0MhY.js" as="script"><link rel="prefetch" href="/assets/bytecode.html-C90OrE5U.js" as="script"><link rel="prefetch" href="/assets/pt.html-BwWO1NCO.js" as="script"><link rel="prefetch" href="/assets/index.html-BeNFxpQH.js" as="script"><link rel="prefetch" href="/assets/lock.html-Dq2JFp2G.js" as="script"><link rel="prefetch" href="/assets/pool.html-Y0jS5hSj.js" as="script"><link rel="prefetch" href="/assets/thread.html-Dz_NWOT-.js" as="script"><link rel="prefetch" href="/assets/tool.html-DR32fn_6.js" as="script"><link rel="prefetch" href="/assets/Architecture.html-C_HHEFEo.js" as="script"><link rel="prefetch" href="/assets/index.html-DKTQA0QX.js" as="script"><link rel="prefetch" href="/assets/Transaction.html-Cbgv-ECE.js" as="script"><link rel="prefetch" href="/assets/mysql-index.html-BuV3x4tx.js" as="script"><link rel="prefetch" href="/assets/redis-java.html-CbARUJMG.js" as="script"><link rel="prefetch" href="/assets/redis.html-DGaocQ72.js" as="script"><link rel="prefetch" href="/assets/sql.html-CENVksM7.js" as="script"><link rel="prefetch" href="/assets/Hibernate.html-uZ9NTYm-.js" as="script"><link rel="prefetch" href="/assets/index.html-CG1IXxB_.js" as="script"><link rel="prefetch" href="/assets/generator.html-C2LY9mNj.js" as="script"><link rel="prefetch" href="/assets/mybatis-resource.html-CxzKxe_z.js" as="script"><link rel="prefetch" href="/assets/mybatis.html-BfA5lwSO.js" as="script"><link rel="prefetch" href="/assets/tk-mybatis.html-C9lm3k5P.js" as="script"><link rel="prefetch" href="/assets/index.html-DIbpX67W.js" as="script"><link rel="prefetch" href="/assets/Servlet.html-CWMY-7kT.js" as="script"><link rel="prefetch" href="/assets/jsp.html-Oqf6QBgC.js" as="script"><link rel="prefetch" href="/assets/mvc.html--whd39mQ.js" as="script"><link rel="prefetch" href="/assets/nginx.html-CfytK9-M.js" as="script"><link rel="prefetch" href="/assets/tomcat.html-ChCwW1s3.js" as="script"><link rel="prefetch" href="/assets/index.html-BLGHVROW.js" as="script"><link rel="prefetch" href="/assets/log.html-BQN2N-OZ.js" as="script"><link rel="prefetch" href="/assets/shiro.html-CcTVY_KS.js" as="script"><link rel="prefetch" href="/assets/index.html-9wbhT66F.js" as="script"><link rel="prefetch" href="/assets/design.html-BgWINR8F.js" as="script"><link rel="prefetch" href="/assets/life.html-D6qCxTyw.js" as="script"><link rel="prefetch" href="/assets/mvc-core.html-BurJ0rdq.js" as="script"><link rel="prefetch" href="/assets/sb-core.html-Du93QwAg.js" as="script"><link rel="prefetch" href="/assets/sec.html-CsK0RNwN.js" as="script"><link rel="prefetch" href="/assets/spring.html-IP3wcT5m.js" as="script"><link rel="prefetch" href="/assets/springboot.html-B5GU2RfQ.js" as="script"><link rel="prefetch" href="/assets/springmvc.html-Bw_M0gjB.js" as="script"><link rel="prefetch" href="/assets/transaction.html-CaTJtMBP.js" as="script"><link rel="prefetch" href="/assets/index.html-CqpgfVjw.js" as="script"><link rel="prefetch" href="/assets/mybatis.html-D_1etFXQ.js" as="script"><link rel="prefetch" href="/assets/mysql.html-CFvMgKYI.js" as="script"><link rel="prefetch" href="/assets/redis.html-DwFvDT4v.js" as="script"><link rel="prefetch" href="/assets/security.html-C8-gNe0L.js" as="script"><link rel="prefetch" href="/assets/spring.html-DnAbdH06.js" as="script"><link rel="prefetch" href="/assets/springboot.html-Cc0PcXLb.js" as="script"><link rel="prefetch" href="/assets/index.html-xANdnU6y.js" as="script"><link rel="prefetch" href="/assets/base.html-BiviO8kO.js" as="script"><link rel="prefetch" href="/assets/collect.html-DSEY6diN.js" as="script"><link rel="prefetch" href="/assets/concurrency.html-Bslber5i.js" as="script"><link rel="prefetch" href="/assets/jvm.html-f3BLY6Bx.js" as="script"><link rel="prefetch" href="/assets/index.html-CrOD0Dpg.js" as="script"><link rel="prefetch" href="/assets/es.html-CWGSFktP.js" as="script"><link rel="prefetch" href="/assets/rocketmq.html-fw5fBQcp.js" as="script"><link rel="prefetch" href="/assets/sys.html-BtOfE1PY.js" as="script"><link rel="prefetch" href="/assets/index.html-C7v9OEah.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ.html-DslbEM2u.js" as="script"><link rel="prefetch" href="/assets/RockMQ.html-nCN2jnjR.js" as="script"><link rel="prefetch" href="/assets/Sentinel.html-DMZxoJBw.js" as="script"><link rel="prefetch" href="/assets/dubbo.html-cdopMdUN.js" as="script"><link rel="prefetch" href="/assets/es.html-_8S5Pe3A.js" as="script"><link rel="prefetch" href="/assets/eureka.html-Bx4RAjcf.js" as="script"><link rel="prefetch" href="/assets/gateway.html-D2WUTSrP.js" as="script"><link rel="prefetch" href="/assets/hystrix.html-CKP_6Y4Y.js" as="script"><link rel="prefetch" href="/assets/kafka.html-DGwu7Zkx.js" as="script"><link rel="prefetch" href="/assets/nacos.html-NY-Vf6Ir.js" as="script"><link rel="prefetch" href="/assets/zookeeper.html-JsObczCL.js" as="script"><link rel="prefetch" href="/assets/index.html-DXbLfdSj.js" as="script"><link rel="prefetch" href="/assets/cron.html-saY2mVA1.js" as="script"><link rel="prefetch" href="/assets/db.html-CkOhdDNb.js" as="script"><link rel="prefetch" href="/assets/dup.html-BFDdL09o.js" as="script"><link rel="prefetch" href="/assets/lock.html-YEDKAIXe.js" as="script"><link rel="prefetch" href="/assets/redis.html-BKoQqYQ4.js" as="script"><link rel="prefetch" href="/assets/transac.html-DorbUm8d.js" as="script"><link rel="prefetch" href="/assets/walk.html-CtZHzMt5.js" as="script"><link rel="prefetch" href="/assets/index.html-BQA9c-tv.js" as="script"><link rel="prefetch" href="/assets/numpy.html-DjIbA_1p.js" as="script"><link rel="prefetch" href="/assets/pandas.html-BjKUAg--.js" as="script"><link rel="prefetch" href="/assets/index.html-BM0SE25C.js" as="script"><link rel="prefetch" href="/assets/css.html-n6olhz_n.js" as="script"><link rel="prefetch" href="/assets/css2.html-C_9TdBpm.js" as="script"><link rel="prefetch" href="/assets/css3.html-flHrg-aU.js" as="script"><link rel="prefetch" href="/assets/css4.html-B41tJGyr.js" as="script"><link rel="prefetch" href="/assets/html.html-DPIPy9JD.js" as="script"><link rel="prefetch" href="/assets/html5.html-BfRO6d8x.js" as="script"><link rel="prefetch" href="/assets/index.html-Dd5S-pA1.js" as="script"><link rel="prefetch" href="/assets/dom.html-CNt5wdal.js" as="script"><link rel="prefetch" href="/assets/es6.html-CHWKXNfo.js" as="script"><link rel="prefetch" href="/assets/js.html-At_sUmWv.js" as="script"><link rel="prefetch" href="/assets/js2.html-C6GZZ2Ru.js" as="script"><link rel="prefetch" href="/assets/index.html-Cbz-CfNx.js" as="script"><link rel="prefetch" href="/assets/ts.html-Bj7MTpY2.js" as="script"><link rel="prefetch" href="/assets/ts2.html-DsVNAErl.js" as="script"><link rel="prefetch" href="/assets/index.html-D2TxgPZY.js" as="script"><link rel="prefetch" href="/assets/react.html-BwDDWY4p.js" as="script"><link rel="prefetch" href="/assets/ui.html-B6C9ykHT.js" as="script"><link rel="prefetch" href="/assets/vue.html-rBonj-mj.js" as="script"><link rel="prefetch" href="/assets/index.html-D-CWn69J.js" as="script"><link rel="prefetch" href="/assets/backend.html-DcxSYHBT.js" as="script"><link rel="prefetch" href="/assets/nestjs.html-Z5Adpkdf.js" as="script"><link rel="prefetch" href="/assets/index.html-ZRPcbroE.js" as="script"><link rel="prefetch" href="/assets/build.html-6_Jk-gNp.js" as="script"><link rel="prefetch" href="/assets/format.html-Ce00F9nS.js" as="script"><link rel="prefetch" href="/assets/node.html-BvLJzJH-.js" as="script"><link rel="prefetch" href="/assets/index.html-CGirVy6X.js" as="script"><link rel="prefetch" href="/assets/index.html-Ca36FvjL.js" as="script"><link rel="prefetch" href="/assets/index.html-BE9P1KZG.js" as="script"><link rel="prefetch" href="/assets/baz.html-aZS3ECrA.js" as="script"><link rel="prefetch" href="/assets/index.html-9RoImoGE.js" as="script"><link rel="prefetch" href="/assets/ray.html-ZAmb-jek.js" as="script"><link rel="prefetch" href="/assets/404.html-CB5CC4Fn.js" as="script"><link rel="prefetch" href="/assets/index.html-FIgDB2EC.js" as="script"><link rel="prefetch" href="/assets/index.html-C6ICn9MW.js" as="script"><link rel="prefetch" href="/assets/index.html-MijPw67J.js" as="script"><link rel="prefetch" href="/assets/index.html-C1fKM-Wn.js" as="script"><link rel="prefetch" href="/assets/index.html-B9WjIOsO.js" as="script"><link rel="prefetch" href="/assets/index.html-CcM3ZJT9.js" as="script"><link rel="prefetch" href="/assets/index.html-BMF-adTM.js" as="script"><link rel="prefetch" href="/assets/index.html-Dan0kwYE.js" as="script"><link rel="prefetch" href="/assets/index.html-DXcX4A0r.js" as="script"><link rel="prefetch" href="/assets/index.html-CK9kbgHr.js" as="script"><link rel="prefetch" href="/assets/index.html-BviBb1la.js" as="script"><link rel="prefetch" href="/assets/index.html-DOTmf_S7.js" as="script"><link rel="prefetch" href="/assets/index.html-B97NLU_Q.js" as="script"><link rel="prefetch" href="/assets/index.html-BdkCCk1-.js" as="script"><link rel="prefetch" href="/assets/index.html-HxHNmPjj.js" as="script"><link rel="prefetch" href="/assets/index.html-C1nFClmW.js" as="script"><link rel="prefetch" href="/assets/index.html-BwW4kEzx.js" as="script"><link rel="prefetch" href="/assets/index.html-B0pLeZt3.js" as="script"><link rel="prefetch" href="/assets/index.html-BtOCkZBa.js" as="script"><link rel="prefetch" href="/assets/index.html-BOfhhfsx.js" as="script"><link rel="prefetch" href="/assets/index.html-ZaiK6TtK.js" as="script"><link rel="prefetch" href="/assets/index.html-mhcNPr-l.js" as="script"><link rel="prefetch" href="/assets/index.html-ANTbjmDH.js" as="script"><link rel="prefetch" href="/assets/index.html-Bo1xUkNM.js" as="script"><link rel="prefetch" href="/assets/index.html-DB7mHfzj.js" as="script"><link rel="prefetch" href="/assets/index.html-Dx8pqS9z.js" as="script"><link rel="prefetch" href="/assets/index.html-C5Z5SEYq.js" as="script"><link rel="prefetch" href="/assets/index.html-ZzCJ2b93.js" as="script"><link rel="prefetch" href="/assets/index.html-BLvfB1VK.js" as="script"><link rel="prefetch" href="/assets/index.html-Q5vfDEaU.js" as="script"><link rel="prefetch" href="/assets/index.html-IDrf9nB_.js" as="script"><link rel="prefetch" href="/assets/index.html-gH_pTwkl.js" as="script"><link rel="prefetch" href="/assets/index.html-B5zesB1A.js" as="script"><link rel="prefetch" href="/assets/index.html-832lDNmi.js" as="script"><link rel="prefetch" href="/assets/index.html-ZeOogJdM.js" as="script"><link rel="prefetch" href="/assets/index.html-BFgywlVU.js" as="script"><link rel="prefetch" href="/assets/index.html-Ds6hQTXK.js" as="script"><link rel="prefetch" href="/assets/index.html-BXMkKnaG.js" as="script"><link rel="prefetch" href="/assets/index.html-BfIzP6v3.js" as="script"><link rel="prefetch" href="/assets/index.html-D6FGwOE_.js" as="script"><link rel="prefetch" href="/assets/index.html-B0GMLX4S.js" as="script"><link rel="prefetch" href="/assets/index.html-COMjGbl_.js" as="script"><link rel="prefetch" href="/assets/index.html-CcP_bmZC.js" as="script"><link rel="prefetch" href="/assets/index.html-T4FqYPID.js" as="script"><link rel="prefetch" href="/assets/index.html-CIbYZUdR.js" as="script"><link rel="prefetch" href="/assets/index.html-Bp7YyFd_.js" as="script"><link rel="prefetch" href="/assets/index.html-zyu3pJkv.js" as="script"><link rel="prefetch" href="/assets/index.html-ovxdOxV-.js" as="script"><link rel="prefetch" href="/assets/index.html-DvkI1HU3.js" as="script"><link rel="prefetch" href="/assets/index.html-Dy9JTEgs.js" as="script"><link rel="prefetch" href="/assets/index.html-Bzegp75E.js" as="script"><link rel="prefetch" href="/assets/index.html-DqZSuI03.js" as="script"><link rel="prefetch" href="/assets/index.html-XiIDxVTc.js" as="script"><link rel="prefetch" href="/assets/index.html-WbyjkpUK.js" as="script"><link rel="prefetch" href="/assets/index.html-C6q4ct8V.js" as="script"><link rel="prefetch" href="/assets/index.html-B5A8no0U.js" as="script"><link rel="prefetch" href="/assets/index.html-CGoX2s_W.js" as="script"><link rel="prefetch" href="/assets/index.html-B4JeDEt_.js" as="script"><link rel="prefetch" href="/assets/index.html-UOUEKbFv.js" as="script"><link rel="prefetch" href="/assets/index.html-BpFjYsI5.js" as="script"><link rel="prefetch" href="/assets/index.html-CBaICxws.js" as="script"><link rel="prefetch" href="/assets/index.html-B3YKWNQA.js" as="script"><link rel="prefetch" href="/assets/index.html-FXYRgP_K.js" as="script"><link rel="prefetch" href="/assets/index.html-oCgnNfxy.js" as="script"><link rel="prefetch" href="/assets/index.html-B9sJyJb6.js" as="script"><link rel="prefetch" href="/assets/index.html-a_wehtB6.js" as="script"><link rel="prefetch" href="/assets/index.html-qjTJ1jR1.js" as="script"><link rel="prefetch" href="/assets/index.html-B844ME46.js" as="script"><link rel="prefetch" href="/assets/index.html-mQQadKYn.js" as="script"><link rel="prefetch" href="/assets/index.html-C6ZV2y0f.js" as="script"><link rel="prefetch" href="/assets/index.html--bJKqBps.js" as="script"><link rel="prefetch" href="/assets/index.html-C9wtzwEy.js" as="script"><link rel="prefetch" href="/assets/index.html-CNmleW9Y.js" as="script"><link rel="prefetch" href="/assets/index.html-CeGjwYmc.js" as="script"><link rel="prefetch" href="/assets/index.html-Db0RLF69.js" as="script"><link rel="prefetch" href="/assets/index.html-pP6fh2IZ.js" as="script"><link rel="prefetch" href="/assets/index.html-CXf9zcYV.js" as="script"><link rel="prefetch" href="/assets/index.html-CaEDh3Uj.js" as="script"><link rel="prefetch" href="/assets/index.html-BxbZPh2y.js" as="script"><link rel="prefetch" href="/assets/index.html-B52w-SBg.js" as="script"><link rel="prefetch" href="/assets/index.html-BS3gzQhN.js" as="script"><link rel="prefetch" href="/assets/index.html-4KRXEmym.js" as="script"><link rel="prefetch" href="/assets/index.html-Jp-3dVn6.js" as="script"><link rel="prefetch" href="/assets/index.html-B_X1DzHu.js" as="script"><link rel="prefetch" href="/assets/flowchart-CTwbLKUk.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-BdEA-XoN.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-DXWKOczD.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">doc</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/AI/" aria-label="  AI  "><!--[--><span class="font-icon icon iconfont icon-ai-robot" style=""></span><!--]-->  AI  <!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Java"><!--[--><span class="font-icon icon iconfont icon-java" style=""></span>Java<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">Javaå¼€å‘çŸ¥è¯†ä½“ç³»</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/java/base/" aria-label="JavaåŸºç¡€è¯­æ³•å…¥é—¨"><!---->JavaåŸºç¡€è¯­æ³•å…¥é—¨<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/java/core/" aria-label="Javaè¿›é˜¶åŠæ ¸å¿ƒç‰¹æ€§"><!---->Javaè¿›é˜¶åŠæ ¸å¿ƒç‰¹æ€§<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/java/frame/" aria-label="JavaWebåŠå¸¸ç”¨æ¡†æ¶"><!---->JavaWebåŠå¸¸ç”¨æ¡†æ¶<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/java/database/" aria-label="æ•°æ®åº“ä¸ORMæ¡†æ¶"><!---->æ•°æ®åº“ä¸ORMæ¡†æ¶<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/java/service/" aria-label="åˆ†å¸ƒå¼ä¸å¾®æœåŠ¡æ¶æ„"><!---->åˆ†å¸ƒå¼ä¸å¾®æœåŠ¡æ¶æ„<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">Javaé¡¹ç›®åŠè§£å†³æ–¹æ¡ˆ</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/project/base/" aria-label="å¸¸è§å·¥å…·å’Œç¯å¢ƒ"><!---->å¸¸è§å·¥å…·å’Œç¯å¢ƒ<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/project/mall/" aria-label="ç”µå•†é¡¹ç›®ç»¼åˆå®è·µ"><!---->ç”µå•†é¡¹ç›®ç»¼åˆå®è·µ<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/project/solution/" aria-label="é¡¹ç›®åœºæ™¯è§£å†³æ–¹æ¡ˆ"><!---->é¡¹ç›®åœºæ™¯è§£å†³æ–¹æ¡ˆ<!----></a></li></ul></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/java/interview/" aria-label="Javaå¸¸è§é¢è¯•é¢˜åˆ†æ"><!--[--><span class="font-icon icon iconfont icon-microservice" style=""></span><!--]-->Javaå¸¸è§é¢è¯•é¢˜åˆ†æ<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Web"><!--[--><span class="font-icon icon iconfont icon-net" style=""></span>Web<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/web/base/" aria-label="å‰ç«¯åŸºç¡€çŸ¥è¯†"><!--[--><span class="font-icon icon iconfont icon-net" style=""></span><!--]-->å‰ç«¯åŸºç¡€çŸ¥è¯†<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/web/core/" aria-label="å¼€å‘æ¡†æ¶å’Œå·¥å…·"><!--[--><span class="font-icon icon iconfont icon-cloud" style=""></span><!--]-->å¼€å‘æ¡†æ¶å’Œå·¥å…·<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/web/security/" aria-label="æ€§èƒ½ä¼˜åŒ–ä¸Webå®‰å…¨"><!--[--><span class="font-icon icon iconfont icon-project" style=""></span><!--]-->æ€§èƒ½ä¼˜åŒ–ä¸Webå®‰å…¨<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Python"><!--[--><span class="font-icon icon iconfont icon-python" style=""></span>Python<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/python/base/" aria-label="å¼€å‘ç¯å¢ƒå’ŒåŸºç¡€è¯­æ³•"><!--[--><span class="font-icon icon iconfont icon-python" style=""></span><!--]-->å¼€å‘ç¯å¢ƒå’ŒåŸºç¡€è¯­æ³•<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/python/frame/" aria-label="å¸¸ç”¨åº“å’Œæ¡†æ¶"><!--[--><span class="font-icon icon iconfont icon-app" style=""></span><!--]-->å¸¸ç”¨åº“å’Œæ¡†æ¶<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/python/image/" aria-label="Pythonå›¾åƒå¤„ç†"><!--[--><span class="font-icon icon iconfont icon-img" style=""></span><!--]-->Pythonå›¾åƒå¤„ç†<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/python/Project/" aria-label="ç›¸å…³é¡¹ç›®åŠåº”ç”¨"><!--[--><span class="font-icon icon iconfont icon-project" style=""></span><!--]-->ç›¸å…³é¡¹ç›®åŠåº”ç”¨<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="C++"><!--[--><span class="font-icon icon iconfont icon-cpp" style=""></span>C++<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/cpp/base/" aria-label="C/C++åŸºç¡€è¯­æ³•å…¥é—¨"><!---->C/C++åŸºç¡€è¯­æ³•å…¥é—¨<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/cpp/ed/" aria-label="å•ç‰‡æœºå’ŒåµŒå…¥å¼å¼€å‘"><!---->å•ç‰‡æœºå’ŒåµŒå…¥å¼å¼€å‘<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Blog"><!--[--><span class="font-icon icon iconfont icon-blog" style=""></span>Blog<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/blog.html" aria-label="Blog HomePage"><!--[--><span class="font-icon icon iconfont icon-home" style=""></span><!--]-->Blog HomePage<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/blog/" aria-label="å¯¼èˆª/æ—¥å¸¸åšå®¢è®°å½•"><!---->å¯¼èˆª/æ—¥å¸¸åšå®¢è®°å½•<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/cs/" aria-label="è®¡ç®—æœºç†è®ºåŸºç¡€"><!---->è®¡ç®—æœºç†è®ºåŸºç¡€<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/java/" aria-label="Java/AIå¼€å‘ç›¸å…³è®°å½•"><!---->Java/AIå¼€å‘ç›¸å…³è®°å½•<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/db/" aria-label="æ•°æ®åº“ç›¸å…³åšå®¢"><!---->æ•°æ®åº“ç›¸å…³åšå®¢<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/om/" aria-label="è¿ç»´åŸºç¡€åŠç¯å¢ƒæ­å»º"><!---->è¿ç»´åŸºç¡€åŠç¯å¢ƒæ­å»º<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/ventixy/notebook" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable active"><span class="font-icon icon iconfont icon-es6" style=""></span><a class="route-link route-link-active auto-link vp-sidebar-title no-external-link-icon" href="/posts/db/" aria-label="Blog-æ•°æ®åº“ç›¸å…³åšå®¢"><!---->Blog-æ•°æ®åº“ç›¸å…³åšå®¢<!----></a><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/posts/db/mysql.html" aria-label="MySQLæ•°æ®åº“"><!---->MySQLæ•°æ®åº“<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/db/mysql-binlog.html" aria-label="Binlog"><!---->Binlog<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/db/mysql-lock.html" aria-label="MySQLäº‹åŠ¡å’Œé”ç›‘æ§"><!---->MySQLäº‹åŠ¡å’Œé”ç›‘æ§<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/db/ulimit.html" aria-label="MySQL5.7å†…å­˜å¼‚å¸¸"><!---->MySQL5.7å†…å­˜å¼‚å¸¸<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/posts/db/postgres.html" aria-label="PostgreSQL"><!---->PostgreSQL<!----></a></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->PostgreSQLæ•°æ®åº“</h1><div class="page-info"><span class="page-author-info" aria-label="AuthorğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://www.ventix.top" target="_blank" rel="noopener noreferrer">ventixy</a></span><span property="author" content="ventixy"></span></span><!----><span class="page-date-info" aria-label="Writing DateğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2025-05-21T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading TimeâŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 70 min</span><meta property="timeRequired" content="PT70M"></span><span class="page-category-info" aria-label="CategoryğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color1 clickable" role="navigation">Database</span><span class="page-category-item color4 clickable" role="navigation">PostgreSQL</span><!--]--><meta property="articleSection" content="Database,PostgreSQL"></span><span class="page-tag-info" aria-label="TagğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color1 clickable" role="navigation">Database</span><span class="page-tag-item color4 clickable" role="navigation">PostgreSQL</span><span class="page-tag-item color2 clickable" role="navigation">PGVector</span><!--]--><meta property="keywords" content="Database,PostgreSQL,PGVector"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">On This Page<button type="button" class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#postgresqlåŸºç¡€">PostgreSQLåŸºç¡€</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#psqlå‘½ä»¤è¡Œå·¥å…·">psqlå‘½ä»¤è¡Œå·¥å…·</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç”¨æˆ·ä¸æƒé™ç®¡ç†">ç”¨æˆ·ä¸æƒé™ç®¡ç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ•°æ®åº“æ“ä½œ">æ•°æ®åº“æ“ä½œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#schema">schema</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#è¡¨ä¸æ•°æ®æ“ä½œ">è¡¨ä¸æ•°æ®æ“ä½œ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¸¸ç”¨è¡¨æ“ä½œ">å¸¸ç”¨è¡¨æ“ä½œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¢åˆ æ”¹æŸ¥-crud">å¢åˆ æ”¹æŸ¥ï¼ˆCRUDï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç´¢å¼•ä¸ä¼˜åŒ–">ç´¢å¼•ä¸ä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äº‹åŠ¡ç®¡ç†">äº‹åŠ¡ç®¡ç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#json-æ”¯æŒ">JSON æ”¯æŒ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ‰©å±•-extensions">æ‰©å±• (Extensions)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#pgvector">PGVector</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#postgis">PostGIS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#timescaledb">TimescaleDB</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#citus">Citus</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ•°æ®å¤‡ä»½ä¸æ¢å¤">æ•°æ®å¤‡ä»½ä¸æ¢å¤</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><p>PostgreSQL æ˜¯ä¸€ä¸ªå¼€æºçš„å¯¹è±¡å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆORDBMSï¼‰ã€‚å®ƒæœ€åˆäº1986å¹´åœ¨åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡ä½œä¸º POSTGRES é¡¹ç›®å¯åŠ¨ï¼Œå¹¶äº1996å¹´æ›´åä¸º PostgreSQLï¼Œä»¥åæ˜ å…¶å¯¹ SQL æ ‡å‡†çš„æ”¯æŒã€‚</p><ul><li>æ ¸å¿ƒç‰¹æ€§ï¼šå®Œå…¨ç¬¦åˆSQLæ ‡å‡†ï¼Œæ’ä»¶ä¸°å¯Œã€‚ä¸”æœ‰ <a href="https://neon.tech/" target="_blank" rel="noopener noreferrer">Neon</a> å’Œ <a href="https://supabase.com" target="_blank" rel="noopener noreferrer">supadata</a> ä¸¤å®¶å…è´¹çš„æ•°æ®åº“äº‘æœåŠ¡</li><li>å›¾å½¢åŒ–ç®¡ç†å·¥å…· - pgAdminï¼šå®˜æ–¹çš„ PostgreSQL å›¾å½¢åŒ–ç®¡ç†å·¥å…·ï¼ŒåŠŸèƒ½å…¨é¢ï¼Œæ”¯æŒå¤æ‚æŸ¥è¯¢ã€ç›‘æ§ã€è°ƒè¯•ã€ERD å·¥å…·ç­‰ã€‚</li><li>èµ„æºå’Œæ–‡æ¡£ï¼š<a href="https://www.postgresql.org/docs/" target="_blank" rel="noopener noreferrer">PostgreSQL Documentation</a>, <a href="https://pgexercises.com/" target="_blank" rel="noopener noreferrer">PostgreSQL Exercises</a>, <a href="https://neon.tech/postgresql/tutorial" target="_blank" rel="noopener noreferrer">PostgreSQL Tutorial (by Neon)</a></li></ul><h2 id="postgresqlåŸºç¡€" tabindex="-1"><a class="header-anchor" href="#postgresqlåŸºç¡€"><span>PostgreSQLåŸºç¡€</span></a></h2><h3 id="psqlå‘½ä»¤è¡Œå·¥å…·" tabindex="-1"><a class="header-anchor" href="#psqlå‘½ä»¤è¡Œå·¥å…·"><span>psqlå‘½ä»¤è¡Œå·¥å…·</span></a></h3><p><code>psql</code> æ˜¯ PostgreSQL çš„å®˜æ–¹å‘½ä»¤è¡Œäº¤äº’å¼å®¢æˆ·ç«¯å·¥å…·ã€‚ æä¾›äº†è®¸å¤šå…ƒå‘½ä»¤å’Œå„ç§ç±»ä¼¼ shell çš„åŠŸèƒ½ï¼Œä»¥æ–¹ä¾¿ç¼–å†™è„šæœ¬å’Œè‡ªåŠ¨åŒ–å„ç§ä»»åŠ¡ã€‚</p><p><code>psql</code> é€šå¸¸ä½œä¸º PostgreSQL æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯è½¯ä»¶åŒ…çš„ä¸€éƒ¨åˆ†è¿›è¡Œå®‰è£…ã€‚</p><ul><li><strong>Debian/Ubuntu</strong>: <code>sudo apt install postgresql-client</code></li><li><strong>RHEL/CentOS</strong>: <code>sudo dnf install postgresql</code></li><li><strong>macOS (Homebrew)</strong>: <code>brew install libpq</code> (ç„¶åå¯èƒ½éœ€è¦é“¾æ¥ <code>psql</code>) æˆ– <code>brew install postgresql</code></li><li><strong>Windows</strong>: é€šè¿‡å®˜æ–¹çš„ EnterpriseDB å®‰è£…ç¨‹åºå®‰è£…ã€‚</li></ul><p><strong>åŸºæœ¬ç”¨æ³•ï¼š</strong></p><ol><li><p><strong>è¿æ¥åˆ°æ•°æ®åº“ï¼š</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">psql</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hostname</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> username</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> databasename</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœä½¿ç”¨é»˜è®¤è®¾ç½®ï¼ˆæœ¬åœ°ä¸»æœºï¼Œç«¯å£5432ï¼Œå½“å‰æ“ä½œç³»ç»Ÿç”¨æˆ·ï¼Œä¸ç”¨æˆ·ååŒåçš„æ•°æ®åº“ï¼‰ï¼Œå¯ä»¥ç®€åŒ–ä¸ºï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">psql</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mydatabase</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿æ¥åï¼Œä¼šçœ‹åˆ°ç±»ä¼¼ <code>mydatabase=#</code> çš„æç¤ºç¬¦ã€‚</p></li><li><p><strong>æ‰§è¡ŒSQLå‘½ä»¤ï¼š</strong><br> ç›´æ¥è¾“å…¥SQLå‘½ä»¤ï¼Œä»¥åˆ†å· <code>;</code> ç»“å°¾ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> users</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SERIAL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> PRIMARY KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">name</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å¸¸ç”¨å…ƒå‘½ä»¤ (Meta-commands)ï¼š</strong><br> å…ƒå‘½ä»¤ä»¥åæ–œæ  <code>\</code> å¼€å¤´ï¼Œä¸ä»¥åˆ†å·ç»“å°¾ã€‚</p><ul><li><code>\l</code> æˆ– <code>\list</code>ï¼šåˆ—å‡ºæ‰€æœ‰æ•°æ®åº“ã€‚</li><li><code>\c databasename [username]</code>ï¼šè¿æ¥åˆ°æŒ‡å®šçš„æ•°æ®åº“ï¼ˆå¯é€‰æ‹©æŒ‡å®šç”¨æˆ·ï¼‰ã€‚</li><li><code>\conninfo</code>ï¼šæ˜¾ç¤ºå½“å‰è¿æ¥ä¿¡æ¯ã€‚</li><li><code>\dt [schema_pattern.]table_pattern</code>ï¼šåˆ—å‡ºåŒ¹é…æ¨¡å¼çš„è¡¨ï¼ˆåœ¨å½“å‰æ•°æ®åº“ä¸­ï¼‰ã€‚</li><li><code>\d object_name</code>ï¼šæè¿°æŒ‡å®šçš„æ•°æ®åº“å¯¹è±¡ï¼ˆè¡¨ã€è§†å›¾ã€ç´¢å¼•ã€åºåˆ—ç­‰ï¼‰ã€‚ä¾‹å¦‚ <code>\d users</code>ã€‚</li><li><code>\dn [schema_pattern]</code>ï¼šåˆ—å‡ºæ‰€æœ‰ï¼ˆæˆ–åŒ¹é…æ¨¡å¼çš„ï¼‰æ¨¡å¼ (schemas)ã€‚</li><li><code>\df [schema_pattern.]function_pattern</code>ï¼šåˆ—å‡ºå‡½æ•°ã€‚</li><li><code>\dv [schema_pattern.]view_pattern</code>ï¼šåˆ—å‡ºè§†å›¾ã€‚</li><li><code>\du [role_pattern]</code>ï¼šåˆ—å‡ºæ‰€æœ‰ï¼ˆæˆ–åŒ¹é…æ¨¡å¼çš„ï¼‰è§’è‰² (ç”¨æˆ·å’Œç»„)ã€‚</li><li><code>\dp [pattern]</code> æˆ– <code>\z [pattern]</code>ï¼šåˆ—å‡ºè¡¨ã€è§†å›¾å’Œåºåˆ—çš„è®¿é—®æƒé™ã€‚</li><li><code>\timing [on|off]</code>ï¼šåˆ‡æ¢æ˜¾ç¤ºæ¯ä¸ªSQLè¯­å¥æ‰§è¡Œæ—¶é—´çš„å¼€å…³ã€‚</li><li><code>\h [command]</code>ï¼šæ˜¾ç¤ºæŒ‡å®šSQLå‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼Œå¦‚ <code>\h CREATE TABLE</code>ã€‚</li><li><code>\?</code>ï¼šæ˜¾ç¤ºpsqlå…ƒå‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ã€‚</li><li><code>\q</code>ï¼šé€€å‡º <code>psql</code>ã€‚</li><li><code>\i filename</code>ï¼šä»æ–‡ä»¶æ‰§è¡Œå‘½ä»¤ã€‚</li><li><code>\e</code>ï¼šä½¿ç”¨å¤–éƒ¨ç¼–è¾‘å™¨ç¼–è¾‘å½“å‰æŸ¥è¯¢ç¼“å†²åŒºã€‚</li><li><code>\set [name [value]]</code>ï¼šè®¾ç½®psqlå˜é‡ã€‚</li><li><code>\unset name</code>ï¼šå–æ¶ˆè®¾ç½®psqlå˜é‡ã€‚</li></ul></li><li><p><strong>ä»æ–‡ä»¶æ‰§è¡ŒSQLï¼š</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">psql</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mydatabase</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myuser</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /path/to/script.sql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>ç¯å¢ƒå˜é‡ï¼š</strong><br><code>psql</code> çš„è¡Œä¸ºå¯ä»¥é€šè¿‡ä¸€äº›ç¯å¢ƒå˜é‡æ¥æ§åˆ¶ï¼Œä¾‹å¦‚ <code>PGHOST</code>, <code>PGPORT</code>, <code>PGUSER</code>, <code>PGDATABASE</code>, <code>PGPASSWORD</code>ã€‚</p></li></ol><p><code>psql</code> æ˜¯ç®¡ç†å’Œä½¿ç”¨ PostgreSQL æ•°æ®åº“çš„å¼ºå¤§ä¸”çµæ´»çš„å·¥å…·ã€‚</p><h3 id="ç”¨æˆ·ä¸æƒé™ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#ç”¨æˆ·ä¸æƒé™ç®¡ç†"><span>ç”¨æˆ·ä¸æƒé™ç®¡ç†</span></a></h3><p>åœ¨ PostgreSQL ä¸­ï¼Œç”¨æˆ·å’Œæƒé™ç®¡ç†æ˜¯é€šè¿‡â€œè§’è‰² (Roles)â€çš„æ¦‚å¿µæ¥å®ç°çš„ã€‚è§’è‰²å¯ä»¥è¢«çœ‹ä½œæ˜¯ç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥è¢«çœ‹ä½œæ˜¯ç”¨æˆ·ç»„ï¼Œæˆ–è€…ä¸¤è€…å…¼è€Œæœ‰ä¹‹ã€‚</p><p><strong>1. åˆ›å»ºè§’è‰² (ç”¨æˆ·)ï¼š</strong></p><p>ä½¿ç”¨ <code>CREATE ROLE</code> SQL å‘½ä»¤æˆ– <code>createuser</code> å‘½ä»¤è¡Œå·¥å…·ã€‚</p><ul><li><p><strong>SQL å‘½ä»¤ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ROLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> role_name </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[WITH option [...]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¸¸ç”¨é€‰é¡¹ <code>option</code> åŒ…æ‹¬ï¼š</p><ul><li><code>LOGIN</code> / <code>NOLOGIN</code>: è§’è‰²æ˜¯å¦å¯ä»¥ç™»å½•ã€‚å…·æœ‰ <code>LOGIN</code> æƒé™çš„è§’è‰²é€šå¸¸è¢«ç§°ä¸ºâ€œç”¨æˆ·â€ã€‚é»˜è®¤ä¸º <code>NOLOGIN</code> (é™¤éä½¿ç”¨ <code>CREATE USER</code> è¯­æ³•ï¼Œå®ƒéšå« <code>LOGIN</code>)ã€‚</li><li><code>SUPERUSER</code> / <code>NOSUPERUSER</code>: è§’è‰²æ˜¯å¦ä¸ºè¶…çº§ç”¨æˆ·ã€‚è¶…çº§ç”¨æˆ·ç»•è¿‡æ‰€æœ‰æƒé™æ£€æŸ¥ã€‚</li><li><code>CREATEDB</code> / <code>NOCREATEDB</code>: è§’è‰²æ˜¯å¦å¯ä»¥åˆ›å»ºæ•°æ®åº“ã€‚</li><li><code>CREATEROLE</code> / <code>NOCREATEROLE</code>: è§’è‰²æ˜¯å¦å¯ä»¥åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤å…¶ä»–è§’è‰²ã€‚</li><li><code>INHERIT</code> / <code>NOINHERIT</code>: è§’è‰²æ˜¯å¦ç»§æ‰¿å…¶æ‰€å±è§’è‰²çš„æƒé™ã€‚é»˜è®¤ä¸º <code>INHERIT</code>ã€‚</li><li><code>PASSWORD &#39;password&#39;</code> æˆ– <code>ENCRYPTED PASSWORD &#39;password&#39;</code>: è®¾ç½®è§’è‰²å¯†ç ã€‚å¯†ç æ€»æ˜¯è¢«åŠ å¯†å­˜å‚¨ã€‚</li><li><code>VALID UNTIL &#39;timestamp&#39;</code>: è®¾ç½®å¯†ç çš„æœ‰æ•ˆæœŸã€‚</li><li><code>CONNECTION LIMIT connlimit</code>: é™åˆ¶è§’è‰²å¯ä»¥å»ºç«‹çš„å¹¶å‘è¿æ¥æ•°ã€‚</li></ul><p><strong>ç¤ºä¾‹ï¼š</strong><br> åˆ›å»ºä¸€ä¸ªå¯ä»¥ç™»å½•å¹¶è®¾ç½®å¯†ç çš„ç”¨æˆ·ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ROLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> myuser </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WITH</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> LOGIN</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> PASSWORD</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;securepassword&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åˆ›å»ºä¸€ä¸ªå…·æœ‰åˆ›å»ºæ•°æ®åº“æƒé™çš„è§’è‰²ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ROLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> db_creator </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WITH</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> CREATEDB </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">LOGIN</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> PASSWORD</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;creatorpass&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>CREATE USER</code> æ˜¯ <code>CREATE ROLE name WITH LOGIN;</code> çš„åˆ«åã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> USER</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> another_user</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> PASSWORD</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;anotherpass&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong><code>createuser</code> å‘½ä»¤è¡Œå·¥å…·ï¼š</strong><br> è¿™æ˜¯ä¸€ä¸ª <code>CREATE ROLE</code> å‘½ä»¤çš„åŒ…è£…å™¨ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">createuser</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --interactive</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --pwprompt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mynewuser</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å®ƒä¼šæç¤ºè¾“å…¥æ–°ç”¨æˆ·çš„å±æ€§ã€‚</p></li></ul><p><strong>2. ä¿®æ”¹è§’è‰²ï¼š</strong></p><p>ä½¿ç”¨ <code>ALTER ROLE</code> SQL å‘½ä»¤ã€‚</p><ul><li><strong>SQL å‘½ä»¤ï¼š</strong><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ROLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> role_name </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[WITH option [...]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ROLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> role_name RENAME </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> new_name</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ROLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> role_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> configuration_parameter {</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">} {</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><strong>ç¤ºä¾‹ï¼š</strong><br> ä¿®æ”¹å¯†ç ï¼š<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ROLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> myuser </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WITH</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> PASSWORD</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;newsecurepassword&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>èµ‹äºˆåˆ›å»ºæ•°æ®åº“æƒé™ï¼š<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ROLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> myuser CREATEDB;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>é‡å‘½åè§’è‰²ï¼š<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ROLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> myuser RENAME </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> my_renamed_user;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><p><strong>3. åˆ é™¤è§’è‰²ï¼š</strong></p><p>ä½¿ç”¨ <code>DROP ROLE</code> SQL å‘½ä»¤æˆ– <code>dropuser</code> å‘½ä»¤è¡Œå·¥å…·ã€‚</p><ul><li><p><strong>SQL å‘½ä»¤ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ROLE</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [IF EXISTS]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> role_name </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[, ...]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœè§’è‰²æ‹¥æœ‰ä»»ä½•æ•°æ®åº“å¯¹è±¡ï¼ˆå¦‚è¡¨ã€æ•°æ®åº“ï¼‰æˆ–å·²è¢«æˆäºˆå…¶ä»–å¯¹è±¡çš„æƒé™ï¼Œåˆ™æ— æ³•ç›´æ¥åˆ é™¤ã€‚å¿…é¡»å…ˆåˆ é™¤æˆ–é‡æ–°åˆ†é…è¿™äº›å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œå¹¶æ’¤é”€å…¶æƒé™ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">REASSIGN OWNED </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> old_role </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> new_role; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- é‡æ–°åˆ†é…å¯¹è±¡æ‰€æœ‰æƒ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> OWNED </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> old_role; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- åˆ é™¤è§’è‰²æ‹¥æœ‰çš„æ‰€æœ‰å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ROLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> old_role;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>dropuser</code> å‘½ä»¤è¡Œå·¥å…·ï¼š</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dropuser</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myolduser</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><p><strong>4. æˆäºˆæƒé™ (Privileges)ï¼š</strong></p><p>ä½¿ç”¨ <code>GRANT</code> SQL å‘½ä»¤ã€‚æƒé™å¯ä»¥æˆäºˆæ•°æ®åº“å¯¹è±¡ï¼ˆè¡¨ã€åºåˆ—ã€æ•°æ®åº“ã€å‡½æ•°ã€æ¨¡å¼ç­‰ï¼‰æˆ–æˆäºˆè§’è‰²æˆå‘˜èµ„æ ¼ã€‚</p><ul><li><p><strong>æˆäºˆå¯¹è±¡æƒé™ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">GRANT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> privilege </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[, ...]</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> object_type object_name </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[, ...]</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> role_specification </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[, ...]</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [WITH GRANT OPTION]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>role_specification</code> å¯ä»¥æ˜¯è§’è‰²åï¼Œ<code>PUBLIC</code> (æ‰€æœ‰è§’è‰²)ï¼Œæˆ– <code>CURRENT_USER</code>, <code>SESSION_USER</code>ã€‚<br><code>privilege</code> å¯ä»¥æ˜¯ <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>TRUNCATE</code>, <code>REFERENCES</code>, <code>TRIGGER</code>, <code>CREATE</code>, <code>CONNECT</code>, <code>TEMPORARY</code>, <code>EXECUTE</code>, <code>USAGE</code> ç­‰ï¼Œå…·ä½“å–å†³äºå¯¹è±¡ç±»å‹ã€‚<br><code>WITH GRANT OPTION</code> å…è®¸è¢«æˆæƒè€…å°†è¿™äº›æƒé™å†æˆäºˆå…¶ä»–è§’è‰²ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong><br> æˆäºˆ <code>myuser</code> å¯¹è¡¨ <code>employees</code> çš„ <code>SELECT</code> å’Œ <code>INSERT</code> æƒé™ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">GRANT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> myuser;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æˆäºˆæ‰€æœ‰ç”¨æˆ·å¯¹æ¨¡å¼ <code>public</code> çš„ <code>USAGE</code> æƒé™ï¼ˆé€šå¸¸é»˜è®¤å·²æˆäºˆï¼‰ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">GRANT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> USAGE </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ON</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SCHEMA</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> public </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> PUBLIC;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æˆäºˆ <code>analyst_role</code> å¯¹è¡¨ <code>sales_data</code> çš„ <code>SELECT</code> æƒé™ï¼Œå¹¶å…è®¸å…¶å°†æ­¤æƒé™æˆäºˆä»–äººï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">GRANT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SELECT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> sales_data </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> analyst_role </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WITH</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> GRANT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> OPTION</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>æˆäºˆè§’è‰²æˆå‘˜èµ„æ ¼ (å°†ä¸€ä¸ªè§’è‰²æ·»åŠ åˆ°å¦ä¸€ä¸ªè§’è‰²ï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ª&quot;ç»„&quot;çš„æˆå‘˜)ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">GRANT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> group_role </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[, ...]</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> member_role </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[, ...]</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [WITH ADMIN OPTION]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>WITH ADMIN OPTION</code> å…è®¸ <code>member_role</code> å°† <code>group_role</code> çš„æˆå‘˜èµ„æ ¼æˆäºˆæˆ–æ’¤é”€ç»™å…¶ä»–è§’è‰²ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong><br> å°† <code>myuser</code> æ·»åŠ åˆ° <code>data_readers</code> è§’è‰²ç»„ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">GRANT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> data_readers </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> myuser;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><p><strong>5. æ’¤é”€æƒé™ï¼š</strong></p><p>ä½¿ç”¨ <code>REVOKE</code> SQL å‘½ä»¤ã€‚</p><ul><li><p><strong>æ’¤é”€å¯¹è±¡æƒé™ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">REVOKE</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [GRANT OPTION FOR]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> privilege </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[, ...]</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> object_type object_name </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[, ...]</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> role_specification </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[, ...]</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [CASCADE | RESTRICT]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>GRANT OPTION FOR</code> åªæ’¤é”€æˆæƒé€‰é¡¹ï¼Œè€Œä¸æ’¤é”€æƒé™æœ¬èº«ã€‚<br><code>CASCADE</code> ä¼šçº§è”æ’¤é”€ä¾èµ–äºæ­¤æƒé™çš„æƒé™ã€‚<code>RESTRICT</code> (é»˜è®¤) å¦‚æœå­˜åœ¨ä¾èµ–æƒé™åˆ™æ‹’ç»æ’¤é”€ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong><br> ä» <code>myuser</code> æ’¤é”€å¯¹è¡¨ <code>employees</code> çš„ <code>INSERT</code> æƒé™ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">REVOKE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INSERT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> myuser;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>æ’¤é”€è§’è‰²æˆå‘˜èµ„æ ¼ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">REVOKE</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [ADMIN OPTION FOR]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> group_role </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[, ...]</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> member_role </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[, ...]</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [CASCADE | RESTRICT]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>ç¤ºä¾‹ï¼š</strong><br> ä» <code>data_readers</code> è§’è‰²ç»„ä¸­ç§»é™¤ <code>myuser</code>ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">REVOKE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> data_readers </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> myuser;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><p><strong>åˆ—å‡ºè§’è‰²å’Œæƒé™ï¼š</strong></p><ul><li><p>åœ¨ <code>psql</code> ä¸­ï¼š</p><ul><li><code>\du</code>: åˆ—å‡ºæ‰€æœ‰è§’è‰²åŠå…¶å±æ€§ã€‚</li><li><code>\dp table_name</code> æˆ– <code>\z table_name</code>: åˆ—å‡ºæŒ‡å®šè¡¨çš„æƒé™ã€‚</li></ul></li><li><p>æŸ¥è¯¢ç³»ç»Ÿç›®å½•ï¼š</p><ul><li><code>SELECT rolname FROM pg_roles;</code> (åˆ—å‡ºè§’è‰²)</li><li><code>information_schema.table_privileges</code>, <code>information_schema.role_table_grants</code> ç­‰è§†å›¾ã€‚</li></ul></li></ul><p>PostgreSQL çš„è§’è‰²å’Œæƒé™ç³»ç»Ÿéå¸¸çµæ´»ä¸”å¼ºå¤§ï¼Œèƒ½å¤Ÿæ»¡è¶³å„ç§å¤æ‚çš„å®‰å…¨éœ€æ±‚ã€‚</p><h3 id="æ•°æ®åº“æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åº“æ“ä½œ"><span>æ•°æ®åº“æ“ä½œ</span></a></h3><p>åœ¨ PostgreSQL ä¸­ï¼Œæ•°æ®åº“æ“ä½œä¸»è¦åŒ…æ‹¬åˆ›å»ºæ–°æ•°æ®åº“ã€åˆ é™¤ç°æœ‰æ•°æ®åº“ä»¥åŠåˆ—å‡ºé›†ç¾¤ä¸­çš„æ•°æ®åº“ã€‚</p><p><strong>1. åˆ›å»ºæ•°æ®åº“ (CREATE DATABASE)ï¼š</strong></p><p>ä½¿ç”¨ <code>CREATE DATABASE</code> SQL å‘½ä»¤æˆ– <code>createdb</code> å‘½ä»¤è¡Œå·¥å…·ã€‚</p><ul><li><p><strong>SQL å‘½ä»¤ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> DATABASE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> database_name</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    [WITH [OWNER [=]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> user_name]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">          [TEMPLATE [=]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> template]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">          [ENCODING [=]</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> encoding</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">          [LOCALE [=]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> locale | LC_COLLATE </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[=]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> lc_collate] </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[LC_CTYPE [=]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> lc_ctype]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">          [TABLESPACE [=]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> tablespace_name]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">          [ALLOW_CONNECTIONS [=]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> allowconn]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">          [CONNECTION LIMIT [=]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> connlimit]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">          [IS_TEMPLATE [=]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> istemplate]];</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å¸¸ç”¨é€‰é¡¹ï¼š</strong></p><ul><li><code>database_name</code>: è¦åˆ›å»ºçš„æ•°æ®åº“çš„åç§°ã€‚</li><li><code>OWNER user_name</code>: æŒ‡å®šæ•°æ®åº“çš„æ‰€æœ‰è€…ã€‚é»˜è®¤ä¸ºæ‰§è¡Œå‘½ä»¤çš„ç”¨æˆ·ã€‚</li><li><code>TEMPLATE template_name</code>: æŒ‡å®šç”¨äºåˆ›å»ºæ–°æ•°æ®åº“çš„æ¨¡æ¿æ•°æ®åº“ã€‚é»˜è®¤æ˜¯ <code>template1</code>ã€‚å¯ä»¥ä½¿ç”¨ <code>template0</code> åˆ›å»ºä¸€ä¸ªâ€œçº¯å‡€â€çš„æ•°æ®åº“ï¼Œä¸åŒ…å« <code>template1</code> ä¸­å¯èƒ½å­˜åœ¨çš„æœ¬åœ°ä¿®æ”¹ã€‚</li><li><code>ENCODING encoding</code>: æŒ‡å®šæ•°æ®åº“çš„å­—ç¬¦é›†ç¼–ç ï¼Œå¦‚ <code>&#39;UTF8&#39;</code>, <code>&#39;SQL_ASCII&#39;</code>ã€‚</li><li><code>LOCALE locale</code> æˆ– <code>LC_COLLATE lc_collate</code> å’Œ <code>LC_CTYPE lc_ctype</code>: æŒ‡å®šæ•°æ®åº“çš„åŒºåŸŸè®¾ç½®ï¼Œå½±å“æ’åºè§„åˆ™å’Œå­—ç¬¦åˆ†ç±»ã€‚</li><li><code>TABLESPACE tablespace_name</code>: æŒ‡å®šæ•°æ®åº“çš„é»˜è®¤è¡¨ç©ºé—´ã€‚</li><li><code>CONNECTION LIMIT connlimit</code>: é™åˆ¶å¯ä»¥è¿æ¥åˆ°æ­¤æ•°æ®åº“çš„å¹¶å‘è¿æ¥æ•° (-1 ä¸ºæ— é™åˆ¶)ã€‚</li></ul><p><strong>ç¤ºä¾‹ï¼š</strong><br> åˆ›å»ºä¸€ä¸ªåä¸º <code>mydatabase</code> çš„æ–°æ•°æ®åº“ï¼Œæ‰€æœ‰è€…ä¸º <code>myuser</code>ï¼Œä½¿ç”¨ UTF-8 ç¼–ç ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> DATABASE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> mydatabase</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    OWNER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> myuser</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    ENCODING</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;UTF8&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    LOCALE </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;en_US.UTF-8&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- åŒºåŸŸè®¾ç½®ç¤ºä¾‹ï¼Œå…·ä½“å€¼å–å†³äºæ“ä½œç³»ç»Ÿ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ³¨æ„</strong>ï¼š<code>CREATE DATABASE</code> ä¸èƒ½åœ¨äº‹åŠ¡å—å†…éƒ¨æ‰§è¡Œã€‚æ‰§è¡Œæ­¤å‘½ä»¤çš„ç”¨æˆ·é€šå¸¸éœ€è¦ <code>SUPERUSER</code> æˆ– <code>CREATEDB</code> æƒé™ã€‚</p></li><li><p><strong><code>createdb</code> å‘½ä»¤è¡Œå·¥å…·ï¼š</strong><br> è¿™æ˜¯ä¸€ä¸ª <code>CREATE DATABASE</code> SQL å‘½ä»¤çš„åŒ…è£…å™¨ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">createdb</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> username</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -O</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> owner_username</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> UTF8</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -l</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> en_US.UTF-8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> new_database_name</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¾‹å¦‚ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">createdb</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postgres</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -O</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> app_user</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> UTF8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> my_app_db</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><p><strong>2. åˆ é™¤æ•°æ®åº“ (DROP DATABASE)ï¼š</strong></p><p>ä½¿ç”¨ <code>DROP DATABASE</code> SQL å‘½ä»¤æˆ– <code>dropdb</code> å‘½ä»¤è¡Œå·¥å…·ã€‚</p><ul><li><p><strong>SQL å‘½ä»¤ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> DATABASE</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [IF EXISTS]</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> database_name</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [WITH (FORCE)]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>é€‰é¡¹ï¼š</strong></p><ul><li><code>IF EXISTS</code>: å¦‚æœæ•°æ®åº“ä¸å­˜åœ¨ï¼Œåˆ™ä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯å‘å‡ºä¸€ä¸ªé€šçŸ¥ã€‚</li><li><code>FORCE</code> (PostgreSQL 13+): å°è¯•ç»ˆæ­¢ä¸ç›®æ ‡æ•°æ®åº“çš„æ‰€æœ‰ç°æœ‰è¿æ¥ï¼Œä»¥ä¾¿å¯ä»¥åˆ é™¤æ•°æ®åº“ã€‚å¦‚æœå­˜åœ¨é¢„å¤‡äº‹åŠ¡ã€æ´»åŠ¨çš„é€»è¾‘å¤åˆ¶æ§½æˆ–è®¢é˜…ï¼Œåˆ™æ­¤é€‰é¡¹ä¸ä¼šç»ˆæ­¢è¿æ¥ã€‚</li></ul><p><strong>ç¤ºä¾‹ï¼š</strong><br> åˆ é™¤åä¸º <code>mydatabase</code> çš„æ•°æ®åº“ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> DATABASE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> mydatabase;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœæ•°æ®åº“å¯èƒ½ä¸å­˜åœ¨ï¼Œåˆ™å®‰å…¨åœ°åˆ é™¤ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> DATABASE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> IF</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> mydatabase;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li><code>DROP DATABASE</code> ä¼šæ°¸ä¹…åˆ é™¤æ•°æ®åº“åŠå…¶æ‰€æœ‰å†…å®¹ï¼Œæ­¤æ“ä½œä¸å¯é€†ã€‚</li><li>æ‰§è¡Œæ­¤å‘½ä»¤çš„ç”¨æˆ·å¿…é¡»æ˜¯æ•°æ®åº“æ‰€æœ‰è€…æˆ–è¶…çº§ç”¨æˆ·ã€‚</li><li>ä¸èƒ½åœ¨è¿æ¥åˆ°ç›®æ ‡æ•°æ®åº“æ—¶æ‰§è¡Œ <code>DROP DATABASE</code>ã€‚æ‚¨éœ€è¦è¿æ¥åˆ°å¦ä¸€ä¸ªæ•°æ®åº“ï¼ˆå¦‚ <code>postgres</code> æˆ– <code>template1</code>ï¼‰æ¥æ‰§è¡Œæ­¤æ“ä½œã€‚</li><li><code>DROP DATABASE</code> ä¸èƒ½åœ¨äº‹åŠ¡å—å†…éƒ¨æ‰§è¡Œã€‚</li></ul></li><li><p><strong><code>dropdb</code> å‘½ä»¤è¡Œå·¥å…·ï¼š</strong><br> è¿™æ˜¯ä¸€ä¸ª <code>DROP DATABASE</code> SQL å‘½ä»¤çš„åŒ…è£…å™¨ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dropdb</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> username</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> database_name</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¾‹å¦‚ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dropdb</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postgres</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> my_app_db</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><p><strong>3. åˆ—å‡ºæ•°æ®åº“ï¼š</strong></p><ul><li><p><strong><code>psql</code> å…ƒå‘½ä»¤ï¼š</strong><br> åœ¨ <code>psql</code> å‘½ä»¤è¡Œå·¥å…·ä¸­ï¼Œä½¿ç”¨ <code>\l</code> æˆ– <code>\list</code> å‘½ä»¤ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\l</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å°†æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“çš„åˆ—è¡¨ï¼ŒåŒ…æ‹¬å…¶åç§°ã€æ‰€æœ‰è€…ã€ç¼–ç ã€æ’åºè§„åˆ™ã€å­—ç¬¦ç±»å‹å’Œè®¿é—®æƒé™ã€‚</p></li><li><p><strong>SQL æŸ¥è¯¢ç³»ç»Ÿç›®å½•ï¼š</strong><br> å¯ä»¥æŸ¥è¯¢ <code>pg_database</code> ç³»ç»Ÿç›®å½•ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> datname, pg_get_userbyid(datdba) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> owner</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, pg_encoding_to_char(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">encoding</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> encoding</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, datcollate, datctype</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> pg_database;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>åªåˆ—å‡ºéæ¨¡æ¿æ•°æ®åº“çš„åç§°ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> datname </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> pg_database </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> datistemplate </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> false;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><p>è¿™äº›æ˜¯ PostgreSQL ä¸­ç®¡ç†æ•°æ®åº“çš„åŸºæœ¬æ“ä½œã€‚åœ¨è¿›è¡Œåˆ é™¤æ“ä½œæ—¶åŠ¡å¿…å°å¿ƒï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</p><h3 id="schema" tabindex="-1"><a class="header-anchor" href="#schema"><span>schema</span></a></h3><p>åœ¨ PostgreSQL ä¸­ï¼Œ<strong>Schema</strong>ï¼ˆæ¨¡å¼ï¼‰æ˜¯ä¸€ä¸ªå‘½åç©ºé—´ï¼Œå®ƒåŒ…å«ä¸€ç»„å‘½åçš„æ•°æ®åº“å¯¹è±¡ï¼Œå¦‚è¡¨ã€è§†å›¾ã€ç´¢å¼•ã€æ•°æ®ç±»å‹ã€å‡½æ•°ã€æ“ä½œç¬¦ç­‰ã€‚Schema å…è®¸å°†æ•°æ®åº“å¯¹è±¡ç»„ç»‡æˆé€»è¾‘ç»„ï¼Œä»¥ä¾¿äºç®¡ç†å’Œé¿å…å‘½åå†²çªã€‚</p><p><strong>Schema çš„ä¸»è¦ä½œç”¨å’Œç‰¹ç‚¹ï¼š</strong></p><ol><li><strong>ç»„ç»‡æ€§</strong>ï¼šå¯ä»¥å°†ç›¸å…³çš„å¯¹è±¡ç»„ç»‡åœ¨åŒä¸€ä¸ª Schema ä¸‹ï¼Œä½¿å¾—æ•°æ®åº“ç»“æ„æ›´æ¸…æ™°ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†æ‰€æœ‰ä¸é”€å”®ç›¸å…³çš„è¡¨å’Œè§†å›¾æ”¾åœ¨ <code>sales</code> Schema ä¸‹ï¼Œä¸äººåŠ›èµ„æºç›¸å…³çš„æ”¾åœ¨ <code>hr</code> Schema ä¸‹ã€‚</li><li><strong>å‘½åç©ºé—´</strong>ï¼šä¸åŒçš„ Schema å¯ä»¥åŒ…å«åŒåçš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œ<code>sales.customers</code> å’Œ <code>marketing.customers</code> å¯ä»¥æ˜¯ä¸¤ä¸ªä¸åŒçš„è¡¨ã€‚è®¿é—®ç‰¹å®š Schema ä¸­çš„å¯¹è±¡æ—¶ï¼Œéœ€è¦ä½¿ç”¨ <code>schema_name.object_name</code> çš„å½¢å¼è¿›è¡Œé™å®šã€‚</li><li><strong>æƒé™ç®¡ç†</strong>ï¼šå¯ä»¥ä¸º Schema è®¾ç½®æƒé™ï¼Œä»è€Œæ§åˆ¶ç”¨æˆ·å¯¹ Schema å†…å¯¹è±¡çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æˆäºˆæŸä¸ªç”¨æˆ·å¯¹ <code>sales</code> Schema çš„ <code>USAGE</code> (è®¿é—®) æƒé™å’Œ <code>CREATE</code> (åˆ›å»ºå¯¹è±¡) æƒé™ã€‚</li><li><strong>å¤šç”¨æˆ·ç¯å¢ƒ</strong>ï¼šåœ¨å¤šç”¨æˆ·å…±äº«åŒä¸€ä¸ªæ•°æ®åº“çš„ç¯å¢ƒä¸­ï¼Œæ¯ä¸ªç”¨æˆ·æˆ–ç”¨æˆ·ç»„å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„ Schemaï¼Œä»è€Œé¿å…ç›¸äº’å¹²æ‰°ã€‚</li><li><strong>ç¬¬ä¸‰æ–¹åº”ç”¨</strong>ï¼šè®¸å¤šç¬¬ä¸‰æ–¹åº”ç”¨æˆ–æ‰©å±•åœ¨å®‰è£…æ—¶ä¼šåˆ›å»ºè‡ªå·±çš„ Schemaï¼Œä»¥å°†å…¶å¯¹è±¡ä¸æ•°æ®åº“ä¸­çš„å…¶ä»–å¯¹è±¡éš”ç¦»å¼€ã€‚</li></ol><p><strong>é»˜è®¤ Schema (<code>public</code>)</strong></p><ul><li>æ¯ä¸ªæ–°åˆ›å»ºçš„æ•°æ®åº“éƒ½ä¼šè‡ªåŠ¨åŒ…å«ä¸€ä¸ªåä¸º <code>public</code> çš„ Schemaã€‚</li><li>å¦‚æœåœ¨åˆ›å»ºå¯¹è±¡ï¼ˆå¦‚è¡¨ï¼‰æ—¶æ²¡æœ‰æ˜¾å¼æŒ‡å®š Schemaï¼Œå¹¶ä¸”å½“å‰ç”¨æˆ·å¯¹ <code>public</code> Schema æœ‰ <code>CREATE</code> æƒé™ï¼Œåˆ™è¯¥å¯¹è±¡é»˜è®¤ä¼šåˆ›å»ºåœ¨ <code>public</code> Schema ä¸­ã€‚</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½å¯¹ <code>public</code> Schema å…·æœ‰ <code>USAGE</code> å’Œ <code>CREATE</code> æƒé™ï¼Œä½†è¿™é€šå¸¸ä¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œè°ƒæ•´ä»¥å¢å¼ºå®‰å…¨æ€§ã€‚</li></ul><p><strong>æœç´¢è·¯å¾„ (<code>search_path</code>)</strong></p><ul><li>å½“å¼•ç”¨ä¸€ä¸ªå¯¹è±¡è€Œæ²¡æœ‰æŒ‡å®š Schema æ—¶ï¼ˆä¾‹å¦‚ï¼Œ<code>SELECT * FROM my_table;</code> è€Œä¸æ˜¯ <code>SELECT * FROM my_schema.my_table;</code>ï¼‰ï¼ŒPostgreSQL ä¼šæ ¹æ® <code>search_path</code> é…ç½®å‚æ•°æ¥æŸ¥æ‰¾è¯¥å¯¹è±¡ã€‚</li><li><code>search_path</code> æ˜¯ä¸€ä¸ªæŒ‰é¡ºåºæ’åˆ—çš„ Schema åç§°åˆ—è¡¨ã€‚PostgreSQL ä¼šä¾æ¬¡åœ¨è¿™äº› Schema ä¸­æŸ¥æ‰¾å¯¹è±¡ï¼Œç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„å¯¹è±¡ã€‚</li><li>é»˜è®¤çš„ <code>search_path</code> é€šå¸¸æ˜¯ <code>&quot;$user&quot;, public</code>ã€‚è¿™æ„å‘³ç€ PostgreSQL ä¼šé¦–å…ˆåœ¨ä¸å½“å‰ç”¨æˆ·ååŒåçš„ Schema ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™åœ¨ <code>public</code> Schema ä¸­æŸ¥æ‰¾ã€‚</li><li>æŸ¥çœ‹å½“å‰çš„æœç´¢è·¯å¾„ï¼š<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">SHOW search_path;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li>ä¿®æ”¹å½“å‰ä¼šè¯çš„æœç´¢è·¯å¾„ï¼š<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> search_path </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> schema1, schema2, public;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li>ä¸ºç‰¹å®šç”¨æˆ·æˆ–æ•°æ®åº“æ°¸ä¹…è®¾ç½®æœç´¢è·¯å¾„ï¼š<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ROLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> username </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> search_path </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> schema1, public;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> DATABASE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> dbname </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> search_path </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> schema1, public;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p><strong>Schema æ“ä½œï¼š</strong></p><ol><li><p><strong>åˆ›å»º Schemaï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SCHEMA</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> schema_name</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [AUTHORIZATION user_name]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœä¸æŒ‡å®š <code>AUTHORIZATION</code>ï¼Œåˆ™ Schema çš„æ‰€æœ‰è€…æ˜¯æ‰§è¡Œè¯¥å‘½ä»¤çš„ç”¨æˆ·ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SCHEMA</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IF</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> myschema;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SCHEMA</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> myschema</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> AUTHORIZATION myuser;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ä¿®æ”¹ Schemaï¼š</strong><br> ä¸»è¦æ˜¯é‡å‘½åæˆ–æ›´æ”¹æ‰€æœ‰è€…ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SCHEMA</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> old_schema_name RENAME </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> new_schema_name;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SCHEMA</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> schema_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">OWNER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> new_owner_name;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>åˆ é™¤ Schemaï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SCHEMA</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [IF EXISTS]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> schema_name </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[CASCADE | RESTRICT]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>CASCADE</code>ï¼šåŒæ—¶åˆ é™¤ Schema ä¸­åŒ…å«çš„æ‰€æœ‰å¯¹è±¡ã€‚</li><li><code>RESTRICT</code> (é»˜è®¤)ï¼šå¦‚æœ Schema ä¸­åŒ…å«ä»»ä½•å¯¹è±¡ï¼Œåˆ™æ‹’ç»åˆ é™¤ã€‚</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SCHEMA</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> myschema CASCADE;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><p><strong>åº”ç”¨åœºæ™¯ç¤ºä¾‹ï¼š</strong></p><ul><li><strong>å¤šç§Ÿæˆ·åº”ç”¨</strong>ï¼šä¸ºæ¯ä¸ªç§Ÿæˆ·åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ Schemaï¼Œä»¥éš”ç¦»å…¶æ•°æ®ã€‚</li><li><strong>æ¨¡å—åŒ–å¼€å‘</strong>ï¼šå°†åº”ç”¨çš„ä¸åŒæ¨¡å—ï¼ˆå¦‚ç”¨æˆ·ç®¡ç†ã€äº§å“ç®¡ç†ã€è®¢å•ç®¡ç†ï¼‰åˆ†åˆ«æ”¾åœ¨ä¸åŒçš„ Schema ä¸­ã€‚</li><li><strong>ç‰ˆæœ¬æ§åˆ¶</strong>ï¼šåœ¨æµ‹è¯•ä¸åŒç‰ˆæœ¬çš„æ•°æ®åº“ç»“æ„æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„ Schemaã€‚ä¾‹å¦‚ <code>v1_tables</code>, <code>v2_tables</code>ã€‚</li><li><strong>å¤–éƒ¨æ•°æ®é›†æˆ</strong>ï¼šå½“ä½¿ç”¨å¤–éƒ¨æ•°æ®åŒ…è£…å™¨ (FDW) è¿æ¥åˆ°å¤–éƒ¨æ•°æ®æºæ—¶ï¼Œé€šå¸¸ä¼šä¸ºå¤–éƒ¨è¡¨åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„ Schemaã€‚</li></ul><p>é€šè¿‡æœ‰æ•ˆåœ°ä½¿ç”¨ Schemaï¼Œå¯ä»¥æ˜¾è‘—æé«˜ PostgreSQL æ•°æ®åº“çš„å¯ç®¡ç†æ€§ã€å®‰å…¨æ€§å’Œç»„ç»‡æ€§ã€‚</p><hr><h2 id="è¡¨ä¸æ•°æ®æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#è¡¨ä¸æ•°æ®æ“ä½œ"><span>è¡¨ä¸æ•°æ®æ“ä½œ</span></a></h2><h3 id="å¸¸ç”¨è¡¨æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨è¡¨æ“ä½œ"><span>å¸¸ç”¨è¡¨æ“ä½œ</span></a></h3><p>è¡¨æ˜¯ PostgreSQL (ä»¥åŠä»»ä½•å…³ç³»æ•°æ®åº“) ä¸­å­˜å‚¨æ•°æ®çš„åŸºæœ¬ç»“æ„ã€‚ä»¥ä¸‹æ˜¯å¸¸ç”¨çš„è¡¨æ“ä½œå‘½ä»¤ï¼š</p><p><strong>1. åˆ›å»ºè¡¨ (CREATE TABLE)ï¼š</strong></p><p><code>CREATE TABLE</code> å‘½ä»¤ç”¨äºå®šä¹‰ä¸€ä¸ªæ–°è¡¨ã€‚ä½ éœ€è¦æŒ‡å®šè¡¨åã€åˆ—åã€æ¯åˆ—çš„æ•°æ®ç±»å‹ä»¥åŠå¯é€‰çš„çº¦æŸã€‚</p><ul><li><p><strong>åŸºæœ¬è¯­æ³•ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [IF NOT EXISTS]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    column1_name data_type </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[column_constraint [ ... ]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">],</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    column2_name data_type </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[column_constraint [ ... ]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">],</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    [table_constraint [ ... ]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[WITH (storage_parameter = value, ...)]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å¸¸ç”¨æ•°æ®ç±»å‹ï¼š</strong></p><ul><li><code>INTEGER</code> (æˆ– <code>INT</code>): æ•´æ•°ã€‚</li><li><code>SMALLINT</code>: å°èŒƒå›´æ•´æ•°ã€‚</li><li><code>BIGINT</code>: å¤§èŒƒå›´æ•´æ•°ã€‚</li><li><code>SERIAL</code>, <code>BIGSERIAL</code>: è‡ªå¢æ•´æ•°ï¼ˆé€šå¸¸ç”¨ä½œä¸»é”®ï¼‰ã€‚</li><li><code>NUMERIC(precision, scale)</code> æˆ– <code>DECIMAL(precision, scale)</code>: ç²¾ç¡®çš„åè¿›åˆ¶æ•°ã€‚</li><li><code>REAL</code> æˆ– <code>FLOAT4</code>: å•ç²¾åº¦æµ®ç‚¹æ•°ã€‚</li><li><code>DOUBLE PRECISION</code> æˆ– <code>FLOAT8</code>: åŒç²¾åº¦æµ®ç‚¹æ•°ã€‚</li><li><code>VARCHAR(n)</code>: å¯å˜é•¿åº¦å­—ç¬¦ä¸²ï¼Œæœ€å¤§é•¿åº¦ä¸º nã€‚</li><li><code>CHAR(n)</code>: å›ºå®šé•¿åº¦å­—ç¬¦ä¸²ã€‚</li><li><code>TEXT</code>: æ— é•¿åº¦é™åˆ¶çš„å¯å˜é•¿åº¦å­—ç¬¦ä¸²ã€‚</li><li><code>BOOLEAN</code>: å¸ƒå°”å€¼ (<code>TRUE</code>, <code>FALSE</code>, <code>NULL</code>)ã€‚</li><li><code>DATE</code>: æ—¥æœŸ (å¹´ã€æœˆã€æ—¥)ã€‚</li><li><code>TIME [WITH TIME ZONE]</code>: æ—¶é—´ (æ—¶ã€åˆ†ã€ç§’)ã€‚</li><li><code>TIMESTAMP [WITH TIME ZONE]</code>: æ—¥æœŸå’Œæ—¶é—´ã€‚</li><li><code>INTERVAL</code>: æ—¶é—´é—´éš”ã€‚</li><li><code>BYTEA</code>: äºŒè¿›åˆ¶æ•°æ®ã€‚</li><li><code>UUID</code>: é€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</li><li><code>JSON</code>, <code>JSONB</code>: JSON æ•°æ®ã€‚</li><li><code>ARRAY</code> ç±»å‹ (ä¾‹å¦‚ <code>INTEGER[]</code>, <code>TEXT[]</code>)ã€‚</li></ul></li><li><p><strong>å¸¸ç”¨çº¦æŸ (Constraints)ï¼š</strong></p><ul><li><code>NOT NULL</code>: åˆ—å€¼ä¸èƒ½ä¸ºç©ºã€‚</li><li><code>UNIQUE</code>: åˆ—ï¼ˆæˆ–åˆ—ç»„ï¼‰ä¸­çš„å€¼å¿…é¡»å”¯ä¸€ã€‚</li><li><code>PRIMARY KEY</code>: å”¯ä¸€æ ‡è¯†è¡¨ä¸­çš„æ¯ä¸€è¡Œï¼Œéšå« <code>NOT NULL</code> å’Œ <code>UNIQUE</code>ã€‚ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ã€‚</li><li><code>FOREIGN KEY (column_name [, ...]) REFERENCES referenced_table (referenced_column [, ...]) [ON DELETE action] [ON UPDATE action]</code>: ç¡®ä¿åˆ—ä¸­çš„å€¼å­˜åœ¨äºå¦ä¸€ä¸ªè¡¨çš„æŒ‡å®šåˆ—ä¸­ï¼Œç”¨äºç»´æŠ¤å¼•ç”¨å®Œæ•´æ€§ã€‚ <ul><li><code>ON DELETE action</code>: <code>NO ACTION</code> (é»˜è®¤), <code>RESTRICT</code>, <code>CASCADE</code>, <code>SET NULL</code>, <code>SET DEFAULT</code>.</li><li><code>ON UPDATE action</code>: ç±»ä¼¼é€‰é¡¹ã€‚</li></ul></li><li><code>CHECK (condition)</code>: ç¡®ä¿åˆ—ä¸­çš„å€¼æ»¡è¶³ç‰¹å®šæ¡ä»¶ã€‚</li><li><code>DEFAULT default_expr</code>: ä¸ºåˆ—æŒ‡å®šé»˜è®¤å€¼ã€‚</li><li><code>GENERATED { ALWAYS | BY DEFAULT } AS IDENTITY [( sequence_options )]</code>: SQL æ ‡å‡†çš„è‡ªå¢åˆ— (PostgreSQL 10+)ã€‚</li></ul></li><li><p><strong>ç¤ºä¾‹ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> employees</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SERIAL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> PRIMARY KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    first_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">50</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    last_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">50</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    email </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">UNIQUE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    hire_date </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> CURRENT_DATE,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    department_id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INTEGER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    salary </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NUMERIC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CHECK</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (salary </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    CONSTRAINT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> fk_department</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        FOREIGN KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (department_id)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        REFERENCES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> departments (id)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        ON DELETE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SET</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NULL</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> departments</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SERIAL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> PRIMARY KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    name</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> UNIQUE</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p><strong>2. ä¿®æ”¹è¡¨ (ALTER TABLE)ï¼š</strong></p><p><code>ALTER TABLE</code> å‘½ä»¤ç”¨äºä¿®æ”¹ç°æœ‰è¡¨çš„ç»“æ„ã€‚</p><ul><li><p><strong>åŸºæœ¬è¯­æ³•ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">action</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>å¸¸ç”¨ <code>action</code>ï¼š</strong></p><ul><li><strong>æ·»åŠ åˆ—ï¼š</strong><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ADD</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> COLUMN column_name data_type </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[column_constraint]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä¾‹: ALTER TABLE employees ADD COLUMN phone_number VARCHAR(20);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>åˆ é™¤åˆ—ï¼š</strong><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> COLUMN </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[IF EXISTS]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> column_name </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[CASCADE | RESTRICT]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä¾‹: ALTER TABLE employees DROP COLUMN phone_number;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>ä¿®æ”¹åˆ—çš„æ•°æ®ç±»å‹ï¼š</strong><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> COLUMN column_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TYPE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> new_data_type </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[USING expression]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä¾‹: ALTER TABLE employees ALTER COLUMN salary TYPE NUMERIC(12, 2);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¦‚æœç±»å‹è½¬æ¢ä¸ç›´æ¥å…¼å®¹ï¼Œå¯èƒ½éœ€è¦ USING å­å¥</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ALTER TABLE my_table ALTER COLUMN old_col TYPE INTEGER USING old_col::integer;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>æ·»åŠ /åˆ é™¤åˆ—çš„é»˜è®¤å€¼ï¼š</strong><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> COLUMN column_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> COLUMN column_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä¾‹: ALTER TABLE employees ALTER COLUMN hire_date SET DEFAULT &#39;2020-01-01&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>æ·»åŠ /åˆ é™¤ <code>NOT NULL</code> çº¦æŸï¼š</strong><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> COLUMN column_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> COLUMN column_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>æ·»åŠ çº¦æŸ (UNIQUE, PRIMARY KEY, FOREIGN KEY, CHECK)ï¼š</strong><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ADD</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> CONSTRAINT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> constraint_name constraint_definition;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä¾‹: ALTER TABLE employees ADD CONSTRAINT uq_employee_email UNIQUE (email);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä¾‹: ALTER TABLE employees ADD CONSTRAINT fk_manager FOREIGN KEY (manager_id) REFERENCES employees(id);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>åˆ é™¤çº¦æŸï¼š</strong><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> CONSTRAINT</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [IF EXISTS]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> constraint_name </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[CASCADE | RESTRICT]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä¾‹: ALTER TABLE employees DROP CONSTRAINT uq_employee_email;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>é‡å‘½ååˆ—ï¼š</strong><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name RENAME COLUMN old_column_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> new_column_name;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä¾‹: ALTER TABLE employees RENAME COLUMN hire_date TO employment_start_date;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>é‡å‘½åè¡¨ï¼š</strong><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> old_table_name RENAME </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> new_table_name;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä¾‹: ALTER TABLE employees RENAME TO staff_members;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>ä¿®æ”¹è¡¨æ‰€æœ‰è€…ï¼š</strong><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">OWNER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> new_owner;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><strong>ä¿®æ”¹è¡¨æ‰€å±æ¨¡å¼ï¼š</strong><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SCHEMA</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> new_schema_name;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></li></ul><p><strong>3. åˆ é™¤è¡¨ (DROP TABLE)ï¼š</strong></p><p><code>DROP TABLE</code> å‘½ä»¤ç”¨äºä»æ•°æ®åº“ä¸­æ°¸ä¹…åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨åŠå…¶æ‰€æœ‰æ•°æ®å’Œç´¢å¼•ã€‚</p><ul><li><p><strong>åŸºæœ¬è¯­æ³•ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [IF EXISTS]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[, ...]</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [CASCADE | RESTRICT]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>é€‰é¡¹ï¼š</strong></p><ul><li><code>IF EXISTS</code>: å¦‚æœè¡¨ä¸å­˜åœ¨ï¼Œåˆ™ä¸ä¼šæŠ¥é”™ã€‚</li><li><code>CASCADE</code>: è‡ªåŠ¨åˆ é™¤ä¾èµ–äºè¯¥è¡¨çš„å¯¹è±¡ï¼ˆå¦‚è§†å›¾ã€å¤–é”®çº¦æŸï¼‰ã€‚</li><li><code>RESTRICT</code> (é»˜è®¤): å¦‚æœæœ‰ä»»ä½•å¯¹è±¡ä¾èµ–äºè¯¥è¡¨ï¼Œåˆ™æ‹’ç»åˆ é™¤ã€‚</li></ul></li><li><p><strong>ç¤ºä¾‹ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> IF</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> old_table1, old_table2 CASCADE;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è­¦å‘Š</strong>ï¼š<code>DROP TABLE</code> æ˜¯ä¸€ä¸ªç ´åæ€§æ“ä½œï¼Œä¸€æ—¦æ‰§è¡Œï¼Œè¡¨ä¸­çš„æ•°æ®å°†æ— æ³•æ¢å¤ï¼ˆé™¤éæœ‰å¤‡ä»½ï¼‰ã€‚è¯·è°¨æ…ä½¿ç”¨ã€‚</p></li></ul><p><strong>4. æˆªæ–­è¡¨ (TRUNCATE TABLE)ï¼š</strong></p><p><code>TRUNCATE TABLE</code> å‘½ä»¤ç”¨äºå¿«é€Ÿåˆ é™¤è¡¨ä¸­çš„æ‰€æœ‰è¡Œï¼Œä½†ä¿ç•™è¡¨ç»“æ„ï¼ˆåˆ—ã€çº¦æŸã€ç´¢å¼•ç­‰ï¼‰ã€‚å®ƒé€šå¸¸æ¯” <code>DELETE FROM table_name;</code> æ›´å¿«ï¼Œå› ä¸ºå®ƒä¸æ‰«æè¡¨ï¼Œä¹Ÿä¸è®°å½•å•ç‹¬çš„è¡Œåˆ é™¤ã€‚</p><ul><li><p><strong>åŸºæœ¬è¯­æ³•ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TRUNCATE</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [TABLE]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[, ...]</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [RESTART IDENTITY | CONTINUE IDENTITY]</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [CASCADE | RESTRICT]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>é€‰é¡¹ï¼š</strong></p><ul><li><code>RESTART IDENTITY</code>: è‡ªåŠ¨é‡ç½®ç”±è¡¨çš„æ ‡è¯†åˆ—ï¼ˆå¦‚ <code>SERIAL</code> æˆ– <code>IDENTITY</code> åˆ—ï¼‰ç”Ÿæˆçš„åºåˆ—ã€‚</li><li><code>CONTINUE IDENTITY</code> (é»˜è®¤): ä¸æ”¹å˜åºåˆ—çš„å½“å‰å€¼ã€‚</li><li><code>CASCADE</code>: è‡ªåŠ¨æˆªæ–­æ‰€æœ‰é€šè¿‡å¤–é”®å¼•ç”¨äº†æŒ‡å®šè¡¨çš„è¡¨ã€‚</li><li><code>RESTRICT</code> (é»˜è®¤): å¦‚æœæœ‰å…¶ä»–è¡¨é€šè¿‡å¤–é”®å¼•ç”¨äº†è¯¥è¡¨ï¼Œåˆ™æ‹’ç»æˆªæ–­ (é™¤éè¿™äº›è¡¨ä¹Ÿåœ¨åŒä¸€ä¸ª <code>TRUNCATE</code> å‘½ä»¤ä¸­è¢«æŒ‡å®š)ã€‚</li></ul></li><li><p><strong>ç¤ºä¾‹ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TRUNCATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> logs </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">RESTART</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> IDENTITY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- åˆ é™¤æ‰€æœ‰æ—¥å¿—å¹¶é‡ç½®IDåºåˆ—</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TRUNCATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> staging_area1, staging_area2;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ³¨æ„</strong>ï¼š<code>TRUNCATE</code> ä¹Ÿæ˜¯ä¸€ä¸ªç ´åæ€§æ“ä½œï¼Œä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ã€‚å®ƒä¸èƒ½åœ¨äº‹åŠ¡ä¸­è½»æ˜“å›æ»šï¼ˆé™¤éäº‹åŠ¡æœ¬èº«è¢«å›æ»šï¼‰ã€‚å®ƒéœ€è¦å¯¹è¡¨æœ‰ <code>TRUNCATE</code> æƒé™ã€‚</p></li></ul><p>è¿™äº›æ˜¯ PostgreSQL ä¸­å¯¹è¡¨è¿›è¡Œæ“ä½œçš„æ ¸å¿ƒå‘½ä»¤ã€‚ç†è§£å®ƒä»¬çš„ç”¨æ³•å’Œå½±å“å¯¹äºæ•°æ®åº“ç®¡ç†å’Œå¼€å‘è‡³å…³é‡è¦ã€‚</p><h3 id="å¢åˆ æ”¹æŸ¥-crud" tabindex="-1"><a class="header-anchor" href="#å¢åˆ æ”¹æŸ¥-crud"><span>å¢åˆ æ”¹æŸ¥ï¼ˆCRUDï¼‰</span></a></h3><p>CRUD æ˜¯æŒ‡æ•°æ®åº“æ“ä½œä¸­çš„å››ä¸ªåŸºæœ¬åŠŸèƒ½ï¼šåˆ›å»º (Create)ã€è¯»å– (Read)ã€æ›´æ–° (Update) å’Œåˆ é™¤ (Delete)ã€‚åœ¨ SQL ä¸­ï¼Œè¿™äº›æ“ä½œåˆ†åˆ«å¯¹åº” <code>INSERT</code>, <code>SELECT</code>, <code>UPDATE</code>, <code>DELETE</code> å‘½ä»¤ã€‚</p><p><strong>1. åˆ›å»º (Create) - æ’å…¥æ•°æ® (INSERT)ï¼š</strong></p><p><code>INSERT INTO</code> å‘½ä»¤ç”¨äºå‘è¡¨ä¸­æ·»åŠ æ–°è¡Œã€‚</p><ul><li><p><strong>åŸºæœ¬è¯­æ³•ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name (column1, column2, ...)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (value1, value2, ...);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä¸ºæ‰€æœ‰åˆ—æŒ‰å…¶åœ¨è¡¨å®šä¹‰ä¸­çš„é¡ºåºæä¾›å€¼ï¼Œåˆ™å¯ä»¥çœç•¥åˆ—åˆ—è¡¨ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (value_for_col1, value_for_col2, ...);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>æ’å…¥å¤šè¡Œï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name (column1, column2, ...)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    (row1_value1, row1_value2, ...),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    (row2_value1, row2_value2, ...),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ...;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ä½¿ç”¨é»˜è®¤å€¼ï¼š</strong><br> å¯ä»¥ä½¿ç”¨ <code>DEFAULT</code> å…³é”®å­—æ¥æ’å…¥åˆ—çš„é»˜è®¤å€¼ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees (first_name, last_name, hire_date)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;John&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Doe&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å‡è®¾ hire_date æœ‰é»˜è®¤å€¼</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ–è€…å®Œå…¨ä¸æŒ‡å®šè¯¥åˆ—ï¼Œå¦‚æœå®ƒæœ‰é»˜è®¤å€¼æˆ–å…è®¸ <code>NULL</code>ã€‚</p></li><li><p><strong>ä»æŸ¥è¯¢ç»“æœæ’å…¥æ•°æ®ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name (column1, column2, ...)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> query_column1, query_column2, ...</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> another_table</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> condition;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è¿”å›æ’å…¥çš„è¡Œ (<code>RETURNING</code>)ï¼š</strong><br> å¯ä»¥åœ¨ <code>INSERT</code> è¯­å¥åé™„åŠ  <code>RETURNING</code> å­å¥ï¼Œä»¥è¿”å›æ’å…¥çš„è¡Œçš„æŸäº›æˆ–æ‰€æœ‰åˆ—çš„å€¼ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees (first_name, last_name)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Jane&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Smith&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">RETURNING id, email; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å‡è®¾ id æ˜¯ SERIALï¼Œemail å¯èƒ½ç”±è§¦å‘å™¨ç”Ÿæˆ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å¤„ç†å†²çª (UPSERT - INSERT ... ON CONFLICT)ï¼š</strong><br> PostgreSQL 9.5+ æ”¯æŒ &quot;UPSERT&quot; æ“ä½œï¼Œå³å¦‚æœæ’å…¥ä¼šå¯¼è‡´å”¯ä¸€çº¦æŸæˆ–æ’é™¤çº¦æŸå†²çªï¼Œåˆ™æ‰§è¡Œæ›¿ä»£æ“ä½œï¼ˆå¦‚æ›´æ–°æˆ–ä»€ä¹ˆéƒ½ä¸åšï¼‰ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> distributors (did, dname)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Gizmo Transglobal&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Associated Computing, Inc&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> CONFLICT (did) DO </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">UPDATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> dname </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> EXCLUDED</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">dname</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> distributors (did, dname)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Redundant Devices&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> CONFLICT (did) DO NOTHING;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>EXCLUDED</code> ä¼ªè¡¨åŒ…å«äº†è¯•å›¾æ’å…¥ä½†å¯¼è‡´å†²çªçš„è¡Œçš„å€¼ã€‚</p></li></ul><p><strong>2. è¯»å– (Read) - æŸ¥è¯¢æ•°æ® (SELECT)ï¼š</strong></p><p><code>SELECT</code> å‘½ä»¤ç”¨äºä»ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ä¸­æ£€ç´¢æ•°æ®ã€‚</p><ul><li><p><strong>åŸºæœ¬è¯­æ³•ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> column1, column2, ...</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[WHERE condition]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[GROUP BY column_list]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[HAVING condition]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[ORDER BY column_list [ASC | DESC]</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [NULLS FIRST | NULLS LAST]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[LIMIT count]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[OFFSET start_row]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>é€‰æ‹©æ‰€æœ‰åˆ—ï¼š</strong><br> ä½¿ç”¨æ˜Ÿå· <code>*</code>ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>æ¡ä»¶æŸ¥è¯¢ (<code>WHERE</code>)ï¼š</strong><br> ä½¿ç”¨ <code>WHERE</code> å­å¥è¿‡æ»¤è¡Œã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> first_name, last_name, salary</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> salary </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 50000</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AND</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> department_id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¸¸ç”¨çš„æ¯”è¾ƒè¿ç®—ç¬¦ï¼š <code>=</code>, <code>!=</code> (æˆ– <code>&lt;&gt;</code>), <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>ã€‚<br> é€»è¾‘è¿ç®—ç¬¦ï¼š <code>AND</code>, <code>OR</code>, <code>NOT</code>ã€‚<br> å…¶ä»–ï¼š <code>BETWEEN</code>, <code>IN</code>, <code>LIKE</code> (ç”¨äºæ¨¡å¼åŒ¹é…ï¼Œ<code>%</code> åŒ¹é…ä»»æ„å­—ç¬¦åºåˆ—ï¼Œ<code>_</code> åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦), <code>ILIKE</code> (ä¸åŒºåˆ†å¤§å°å†™çš„ <code>LIKE</code>), <code>IS NULL</code>, <code>IS NOT NULL</code>ã€‚</p></li><li><p><strong>æ’åºç»“æœ (<code>ORDER BY</code>)ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> first_name, last_name, hire_date</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ORDER BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> hire_date </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DESC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, last_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ASC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æŒ‰å…¥èŒæ—¥æœŸé™åºï¼ŒåŒæ—¥æœŸçš„æŒ‰å§“æ°å‡åº</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>é™åˆ¶ç»“æœæ•°é‡ (<code>LIMIT</code> å’Œ <code>OFFSET</code>)ï¼š</strong><br><code>LIMIT</code> æŒ‡å®šè¿”å›çš„æœ€å¤§è¡Œæ•°ï¼Œ<code>OFFSET</code> æŒ‡å®šå¼€å§‹è¿”å›è¡Œä¹‹å‰è·³è¿‡çš„è¡Œæ•°ï¼ˆç”¨äºåˆ†é¡µï¼‰ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> product_name, price</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ORDER BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> price </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DESC</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">LIMIT</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> OFFSET </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è¿”å›ä»·æ ¼æœ€é«˜çš„ç¬¬ 21 åˆ° 30 ä¸ªäº§å“</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Workspace FIRST n ROWS ONLY</code> æ˜¯ <code>LIMIT n</code> çš„ SQL æ ‡å‡†ç­‰æ•ˆã€‚</p></li><li><p><strong>èšåˆå‡½æ•°å’Œåˆ†ç»„ (<code>GROUP BY</code>, <code>HAVING</code>)ï¼š</strong><br> å¸¸ç”¨çš„èšåˆå‡½æ•°ï¼š<code>COUNT()</code>, <code>SUM()</code>, <code>AVG()</code>, <code>MAX()</code>, <code>MIN()</code>.<br><code>GROUP BY</code> å­å¥ç”¨äºå°†å…·æœ‰ç›¸åŒå€¼çš„è¡Œç»„åˆæˆæ‘˜è¦è¡Œã€‚<br><code>HAVING</code> å­å¥ç”¨äºåœ¨åˆ†ç»„åè¿‡æ»¤ç»“æœã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> department_id, </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">COUNT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(*) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> num_employees, </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">AVG</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(salary) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> avg_salary</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">GROUP BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> department_id</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">HAVING</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> COUNT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(*) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ORDER BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> avg_salary </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DESC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è¿æ¥è¡¨ (JOINs)ï¼š</strong><br> ç”¨äºæ ¹æ®ç›¸å…³åˆ—ä¹‹é—´çš„å…³ç³»ç»„åˆæ¥è‡ªä¸¤ä¸ªæˆ–å¤šä¸ªè¡¨çš„è¡Œã€‚</p><ul><li><code>INNER JOIN</code> (æˆ– <code>JOIN</code>): è¿”å›ä¸¤ä¸ªè¡¨ä¸­åŒ¹é…çš„è¡Œã€‚</li><li><code>LEFT JOIN</code> (æˆ– <code>LEFT OUTER JOIN</code>): è¿”å›å·¦è¡¨çš„æ‰€æœ‰è¡Œï¼Œä»¥åŠå³è¡¨ä¸­åŒ¹é…çš„è¡Œï¼ˆä¸åŒ¹é…åˆ™ä¸º NULLï¼‰ã€‚</li><li><code>RIGHT JOIN</code> (æˆ– <code>RIGHT OUTER JOIN</code>): è¿”å›å³è¡¨çš„æ‰€æœ‰è¡Œï¼Œä»¥åŠå·¦è¡¨ä¸­åŒ¹é…çš„è¡Œã€‚</li><li><code>FULL JOIN</code> (æˆ– <code>FULL OUTER JOIN</code>): è¿”å›å·¦è¡¨æˆ–å³è¡¨ä¸­å­˜åœ¨çš„æ‰€æœ‰è¡Œã€‚</li><li><code>CROSS JOIN</code>: è¿”å›ä¸¤ä¸ªè¡¨çš„ç¬›å¡å°”ç§¯ã€‚</li><li><code>NATURAL JOIN</code>: è‡ªåŠ¨åŸºäºåŒååˆ—è¿›è¡Œè¿æ¥ã€‚</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">first_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">last_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">name</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> department_name</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees e</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">JOIN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> departments d </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ON</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">department_id</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å­æŸ¥è¯¢ (Subqueries)ï¼š</strong><br> åµŒå¥—åœ¨å…¶ä»– SQL æŸ¥è¯¢ä¸­çš„æŸ¥è¯¢ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> first_name, last_name</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> salary </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> AVG</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(salary) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p><strong>3. æ›´æ–° (Update) - ä¿®æ”¹æ•°æ® (UPDATE)ï¼š</strong></p><p><code>UPDATE</code> å‘½ä»¤ç”¨äºä¿®æ”¹è¡¨ä¸­å·²å­˜åœ¨çš„è¡Œã€‚</p><ul><li><p><strong>åŸºæœ¬è¯­æ³•ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">UPDATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> column1 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> value1,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    column2 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> value2,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[FROM from_list]</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> condition</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[RETURNING expression [AS output_name]</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [, ...]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç¤ºä¾‹ï¼š</strong><br> ç»™ <code>employee_id</code> ä¸º 101 çš„å‘˜å·¥åŠ è–ª 10%ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">UPDATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> salary </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> salary * </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 101</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ ¹æ®å¦ä¸€ä¸ªè¡¨çš„å€¼æ›´æ–°ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">UPDATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> department_name </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> departments</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">name</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> departments</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> employees</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">department_id</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> departments</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">id</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AND</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> employees</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">department_name</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> IS</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ›´æ–°æ‰€æœ‰è¡Œï¼ˆ<strong>å°å¿ƒï¼</strong>ï¼‰ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">UPDATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> stock_level </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¦‚æœæ²¡æœ‰ WHERE å­å¥ï¼Œä¼šæ›´æ–°æ‰€æœ‰è¡Œ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è¿”å›æ›´æ–°çš„è¡Œ (<code>RETURNING</code>)ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">UPDATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> salary </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> salary + </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5000</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> department_id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">RETURNING id, first_name, salary </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> new_salary;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p><strong>4. åˆ é™¤ (Delete) - ç§»é™¤æ•°æ® (DELETE)ï¼š</strong></p><p><code>DELETE FROM</code> å‘½ä»¤ç”¨äºä»è¡¨ä¸­åˆ é™¤è¡Œã€‚</p><ul><li><p><strong>åŸºæœ¬è¯­æ³•ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DELETE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[USING using_list]</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> condition</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[RETURNING expression [AS output_name]</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [, ...]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç¤ºä¾‹ï¼š</strong><br> åˆ é™¤è–ªæ°´ä½äº 30000 çš„å‘˜å·¥ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DELETE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> salary </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ ¹æ®å¦ä¸€ä¸ªè¡¨çš„å€¼åˆ é™¤ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DELETE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> inactive_departments</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> employees</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">department_id</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> inactive_departments</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ é™¤è¡¨ä¸­çš„æ‰€æœ‰è¡Œï¼ˆ<strong>å°å¿ƒï¼</strong>ï¼‰ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DELETE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> logs; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¦‚æœæ²¡æœ‰ WHERE å­å¥ï¼Œä¼šåˆ é™¤æ‰€æœ‰è¡Œï¼Œä½†æ¯” TRUNCATE æ…¢</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>TRUNCATE TABLE table_name;</code> é€šå¸¸æ˜¯åˆ é™¤æ‰€æœ‰è¡Œæ›´å¿«çš„é€‰æ‹©ã€‚</p></li><li><p><strong>è¿”å›åˆ é™¤çš„è¡Œ (<code>RETURNING</code>)ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DELETE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> orders</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> order_date </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;2020-01-01&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">RETURNING *; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è¿”å›æ‰€æœ‰è¢«åˆ é™¤çš„è®¢å•</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>æŒæ¡è¿™äº› CRUD æ“ä½œæ˜¯è¿›è¡Œä»»ä½•æ•°æ®åº“å·¥ä½œçš„åŸºæœ¬å‰æã€‚å§‹ç»ˆæ³¨æ„ <code>UPDATE</code> å’Œ <code>DELETE</code> å‘½ä»¤ä¸­çš„ <code>WHERE</code> å­å¥ï¼Œä»¥é¿å…æ„å¤–ä¿®æ”¹æˆ–åˆ é™¤æ•°æ®ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ‰§è¡Œè¿™äº›æ“ä½œå‰ï¼Œæœ€å¥½å…ˆåœ¨äº‹åŠ¡ä¸­æµ‹è¯•æˆ–å¤‡ä»½æ•°æ®ã€‚</p><h3 id="ç´¢å¼•ä¸ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•ä¸ä¼˜åŒ–"><span>ç´¢å¼•ä¸ä¼˜åŒ–</span></a></h3><p>ç´¢å¼•æ˜¯ PostgreSQL (ä»¥åŠå…¶ä»–å…³ç³»æ•°æ®åº“) ä¸­ç”¨äºæé«˜æ•°æ®æ£€ç´¢é€Ÿåº¦çš„å…³é”®ç‰¹æ€§ã€‚å®ƒä»¬é€šè¿‡æä¾›æŒ‡å‘è¡¨ä¸­æ•°æ®è¡Œçš„å¿«é€Ÿè®¿é—®è·¯å¾„æ¥å·¥ä½œï¼Œç±»ä¼¼äºä¹¦çš„ç´¢å¼•ã€‚æŸ¥è¯¢ä¼˜åŒ–åˆ™æ˜¯ä¸€ä¸ªæ›´å¹¿æ³›çš„ä¸»é¢˜ï¼Œæ¶‰åŠç¼–å†™é«˜æ•ˆçš„ SQL æŸ¥è¯¢ã€åˆç†è®¾è®¡æ•°æ®åº“ç»“æ„ä»¥åŠè°ƒæ•´æ•°æ®åº“æœåŠ¡å™¨é…ç½®ã€‚</p><p><strong>ç´¢å¼• (Indexes)</strong></p><p><strong>1. ç´¢å¼•å¦‚ä½•å·¥ä½œï¼š</strong></p><ul><li>å½“å¯¹è¡¨ä¸­çš„åˆ—åˆ›å»ºç´¢å¼•æ—¶ï¼ŒPostgreSQL ä¼šåˆ›å»ºä¸€ä¸ªæ•°æ®ç»“æ„ï¼ˆä¾‹å¦‚ B-æ ‘ï¼‰ï¼Œå…¶ä¸­åŒ…å«ç´¢å¼•åˆ—çš„å€¼ä»¥åŠæŒ‡å‘è¡¨ä¸­å®é™…æ•°æ®è¡Œçš„æŒ‡é’ˆã€‚</li><li>å½“æŸ¥è¯¢çš„ <code>WHERE</code> å­å¥æˆ– <code>JOIN</code> æ¡ä»¶æ¶‰åŠåˆ°ç´¢å¼•åˆ—æ—¶ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨å¯ä»¥å†³å®šä½¿ç”¨ç´¢å¼•æ¥å¿«é€Ÿå®šä½åŒ¹é…çš„è¡Œï¼Œè€Œä¸æ˜¯æ‰«ææ•´ä¸ªè¡¨ï¼ˆå…¨è¡¨æ‰«æï¼‰ã€‚</li><li>ç´¢å¼•å¯ä»¥æ˜¾è‘—åŠ å¿« <code>SELECT</code> æŸ¥è¯¢çš„é€Ÿåº¦ï¼Œå¹¶ä¸”å¯¹äº <code>UPDATE</code> å’Œ <code>DELETE</code> æ“ä½œä¸­å¿«é€Ÿå®šä½è¦ä¿®æ”¹æˆ–åˆ é™¤çš„è¡Œä¹Ÿå¾ˆæœ‰ç”¨ã€‚</li><li>ç„¶è€Œï¼Œç´¢å¼•ä¹Ÿä¼šå¸¦æ¥å¼€é”€ï¼šå®ƒä»¬ä¼šå ç”¨ç£ç›˜ç©ºé—´ï¼Œå¹¶ä¸”åœ¨æ’å…¥ã€æ›´æ–°æˆ–åˆ é™¤æ•°æ®æ—¶éœ€è¦ç»´æŠ¤ï¼Œè¿™å¯èƒ½ä¼šç¨å¾®é™ä½å†™æ“ä½œçš„æ€§èƒ½ã€‚å› æ­¤ï¼Œéœ€è¦æƒè¡¡åˆ©å¼Šï¼Œåªåœ¨å¿…è¦æ—¶åˆ›å»ºç´¢å¼•ã€‚</li></ul><p><strong>2. å¸¸è§çš„ç´¢å¼•ç±»å‹ï¼š</strong></p><p>PostgreSQL æ”¯æŒå¤šç§ç´¢å¼•ç±»å‹ï¼Œä»¥é€‚åº”ä¸åŒçš„æŸ¥è¯¢æ¨¡å¼ï¼š</p><ul><li><p><strong>B-Tree (é»˜è®¤ç±»å‹)</strong>ï¼š</p><ul><li>ç”¨é€”ï¼šæœ€å¸¸ç”¨çš„ç´¢å¼•ç±»å‹ï¼Œé€‚ç”¨äºå¤„ç†ç­‰äº (<code>=</code>)ã€èŒƒå›´ (<code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>)ã€<code>BETWEEN</code>ã€<code>IN</code>ã€<code>IS NULL</code>ã€<code>IS NOT NULL</code> ä»¥åŠ <code>LIKE</code>ï¼ˆéå‰ç¼€é€šé…ç¬¦ï¼‰ç­‰æ¯”è¾ƒæ“ä½œã€‚</li><li>æ’åºï¼šB-æ ‘ç´¢å¼•ä¸­çš„æ•°æ®æ˜¯æœ‰åºå­˜å‚¨çš„ï¼Œè¿™ä½¿å¾—å®ƒä»¬å¯¹äº <code>ORDER BY</code> å­å¥å’Œ <code>MIN()</code>/<code>MAX()</code> èšåˆå‡½æ•°ä¹Ÿå¾ˆæœ‰ç”¨ã€‚</li><li>åˆ›å»ºï¼š<code>CREATE INDEX idx_name ON table_name (column_name);</code> (é»˜è®¤ä½¿ç”¨ B-Tree)</li></ul></li><li><p><strong>Hash</strong>ï¼š</p><ul><li>ç”¨é€”ï¼šä»…æ”¯æŒç®€å•çš„ç­‰å€¼æ¯”è¾ƒ (<code>=</code>)ã€‚</li><li>ç‰¹ç‚¹ï¼šå¯¹äºå¤§æ•°æ®é›†ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼ŒHash ç´¢å¼•çš„æŸ¥æ‰¾é€Ÿåº¦å¯èƒ½æ¯” B-Tree æ›´å¿«ã€‚ä½†æ˜¯ï¼ŒHash ç´¢å¼•ä¸æ˜¯äº‹åŠ¡å®‰å…¨çš„ï¼ˆåœ¨ PostgreSQL 10 ä¹‹å‰ï¼‰ï¼Œå¹¶ä¸”ä¸èƒ½ä¿è¯æ’åºï¼Œä¹Ÿä¸èƒ½ç”¨äºèŒƒå›´æŸ¥è¯¢ã€‚</li><li>åˆ›å»ºï¼š<code>CREATE INDEX idx_name ON table_name USING HASH (column_name);</code></li></ul></li><li><p><strong>GiST (Generalized Search Tree)</strong>ï¼š</p><ul><li>ç”¨é€”ï¼šä¸€ç§é€šç”¨çš„ç´¢å¼•ç»“æ„ï¼Œå¯ä»¥å®ç°å¤šç§ä¸åŒçš„ç´¢å¼•ç­–ç•¥ã€‚å¸¸ç”¨äºç´¢å¼•å‡ ä½•æ•°æ®ç±»å‹ (PostGIS)ã€å…¨æ–‡æœç´¢ç±»å‹ (<code>tsvector</code>) ä»¥åŠå…¶ä»–å¤æ‚æ•°æ®ç±»å‹ã€‚</li><li>ç‰¹ç‚¹ï¼šéå¸¸çµæ´»ï¼Œå¯ä»¥é€šè¿‡æ‰©å±•æ”¯æŒæ–°çš„æ•°æ®ç±»å‹å’Œæ“ä½œç¬¦ã€‚</li><li>åˆ›å»ºï¼š<code>CREATE INDEX idx_name ON table_name USING GIST (column_name);</code> (ä¾‹å¦‚ï¼Œç”¨äº PostGIS çš„ <code>geometry</code> åˆ—)</li></ul></li><li><p><strong>GIN (Generalized Inverted Index)</strong>ï¼š</p><ul><li>ç”¨é€”ï¼šä¸“ä¸ºç´¢å¼•åŒ…å«å¤šä¸ªâ€œé”®â€çš„å¤åˆå€¼è€Œè®¾è®¡ï¼Œä¾‹å¦‚æ•°ç»„ã€JSONB æ–‡æ¡£ (<code>jsonb_path_ops</code>)ã€å…¨æ–‡æœç´¢ç±»å‹ (<code>tsvector</code>)ã€‚</li><li>ç‰¹ç‚¹ï¼šå½“ä¸€ä¸ªç´¢å¼•é¡¹å¯ä»¥æŒ‡å‘å¤šä¸ªè¡Œæ—¶ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªè¯å‡ºç°åœ¨å¤šä¸ªæ–‡æ¡£ä¸­ï¼Œæˆ–è€…ä¸€ä¸ªå…ƒç´ å­˜åœ¨äºå¤šä¸ªæ•°ç»„ä¸­ï¼‰ï¼ŒGIN ç´¢å¼•éå¸¸é«˜æ•ˆã€‚</li><li>åˆ›å»ºï¼š<code>CREATE INDEX idx_name ON table_name USING GIN (column_name);</code> (ä¾‹å¦‚ï¼Œç”¨äº <code>jsonb</code> åˆ—çš„ <code>jsonb_path_ops</code> æˆ– <code>tsvector</code> åˆ—)</li></ul></li><li><p><strong>SP-GiST (Space-Partitioned GiST)</strong>ï¼š</p><ul><li>ç”¨é€”ï¼šæ”¯æŒç©ºé—´åˆ†åŒºçš„æ•°æ®ç»“æ„ï¼Œå¦‚å››å‰æ ‘ã€k-dæ ‘ã€åŸºæ•°æ ‘ç­‰ã€‚é€‚ç”¨äºæŸäº›ç±»å‹çš„éå¹³è¡¡æ•°æ®ç»“æ„ã€‚</li><li>åˆ›å»ºï¼š<code>CREATE INDEX idx_name ON table_name USING SPGIST (column_name);</code></li></ul></li><li><p><strong>BRIN (Block Range Index)</strong>ï¼š</p><ul><li>ç”¨é€”ï¼šå­˜å‚¨æ•°æ®å—èŒƒå›´å†…æŸäº›åˆ—çš„æ‘˜è¦ä¿¡æ¯ï¼ˆä¾‹å¦‚æœ€å°å€¼ã€æœ€å¤§å€¼ï¼‰ã€‚é€‚ç”¨äºé‚£äº›ä¸ç‰©ç†å­˜å‚¨é¡ºåºé«˜åº¦ç›¸å…³çš„éå¸¸å¤§çš„è¡¨ï¼ˆä¾‹å¦‚ï¼ŒæŒ‰æ—¶é—´æˆ³æ’å…¥çš„æ•°æ®ï¼‰ã€‚</li><li>ç‰¹ç‚¹ï¼šç´¢å¼•éå¸¸å°ï¼Œç»´æŠ¤å¼€é”€ä½ï¼Œä½†åªåœ¨æ•°æ®å…·æœ‰æŸç§è‡ªç„¶æ’åºæˆ–èšé›†æ—¶æ‰æœ‰æ•ˆã€‚</li><li>åˆ›å»ºï¼š<code>CREATE INDEX idx_name ON table_name USING BRIN (column_name);</code></li></ul></li></ul><p><strong>3. åˆ›å»ºç´¢å¼• (CREATE INDEX)ï¼š</strong></p><ul><li><p><strong>åŸºæœ¬è¯­æ³•ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [UNIQUE]</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [CONCURRENTLY]</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [IF NOT EXISTS]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> index_name</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[USING method]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    { column_name | ( expression ) } </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[COLLATE collation]</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [opclass [ ( opclass_options ) ]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ] </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[ASC | DESC]</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [NULLS {FIRST | LAST}]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    [, ...]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[INCLUDE ( column_name [, ...]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> )]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[WITH ( storage_parameter [= value]</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [, ... ]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> )]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[TABLESPACE tablespace_name]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[WHERE predicate]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å¸¸ç”¨é€‰é¡¹ï¼š</strong></p><ul><li><code>UNIQUE</code>: åˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œç¡®ä¿ç´¢å¼•åˆ—ï¼ˆæˆ–åˆ—ç»„ï¼‰çš„å€¼æ˜¯å”¯ä¸€çš„ã€‚</li><li><code>CONCURRENTLY</code>: åˆ›å»ºç´¢å¼•æ—¶ä¸é˜»å¡å¯¹è¡¨çš„å†™æ“ä½œ (ä½†é€šå¸¸æ›´æ…¢ä¸”èµ„æºæ¶ˆè€—æ›´å¤š)ã€‚</li><li><code>IF NOT EXISTS</code>: å¦‚æœåŒåç´¢å¼•å·²å­˜åœ¨ï¼Œåˆ™ä¸æŠ¥é”™ã€‚</li><li><code>USING method</code>: æŒ‡å®šç´¢å¼•æ–¹æ³•ï¼Œå¦‚ <code>btree</code>, <code>hash</code>, <code>gist</code>, <code>gin</code>, <code>spgist</code>, <code>brin</code>ã€‚é»˜è®¤ä¸º <code>btree</code>ã€‚</li><li><strong>è¡¨è¾¾å¼ç´¢å¼• (Expression Indexes)</strong>ï¼šå¯ä»¥å¯¹åŸºäºä¸€ä¸ªæˆ–å¤šä¸ªåˆ—è¡¨è¾¾å¼çš„å‡½æ•°æˆ–è®¡ç®—ç»“æœåˆ›å»ºç´¢å¼•ã€‚<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> idx_lower_email</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> users ((</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">LOWER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(email))); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¹å°å†™emailåˆ›å»ºç´¢å¼•</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æŸ¥è¯¢: SELECT * FROM users WHERE LOWER(email) = &#39;test@example.com&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>éƒ¨åˆ†ç´¢å¼• (Partial Indexes - <code>WHERE</code> å­å¥)</strong>ï¼šåªå¯¹è¡¨ä¸­æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„è¡Œåˆ›å»ºç´¢å¼•ã€‚å¯ä»¥å‡å°ç´¢å¼•å¤§å°å¹¶æé«˜æ€§èƒ½ã€‚<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> idx_orders_unshipped</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> orders (order_date) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> status</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;pending&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æŸ¥è¯¢: SELECT * FROM orders WHERE status = &#39;pending&#39; AND order_date &gt; &#39;2023-01-01&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>å¤šåˆ—ç´¢å¼• (Multi-column Indexes)</strong>ï¼šåœ¨ä¸€ä¸ªç´¢å¼•ä¸­åŒ…å«å¤šä¸ªåˆ—ã€‚åˆ—çš„é¡ºåºå¾ˆé‡è¦ã€‚<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> idx_name_location</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> customers (last_name, first_name, city);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è¿™ä¸ªç´¢å¼•å¯ä»¥ç”¨äº WHERE last_name = &#39;X&#39; AND first_name = &#39;Y&#39; AND city = &#39;Z&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä¹Ÿå¯ä»¥ç”¨äº WHERE last_name = &#39;X&#39; AND first_name = &#39;Y&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä¹Ÿå¯ä»¥ç”¨äº WHERE last_name = &#39;X&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä½†é€šå¸¸ä¸èƒ½é«˜æ•ˆç”¨äº WHERE first_name = &#39;Y&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><code>INCLUDE</code>: åœ¨ B-Tree ç´¢å¼•ä¸­ï¼Œå…è®¸æŒ‡å®šä¸€äº›éé”®åˆ—åŒ…å«åœ¨ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­ã€‚è¿™å¯ä»¥å®ç°â€œä»…ç´¢å¼•æ‰«æ (Index-Only Scans)â€ï¼Œä»è€Œé¿å…è®¿é—®è¡¨æœ¬èº«ã€‚</li><li><code>ASC</code>/<code>DESC</code>, <code>NULLS FIRST</code>/<code>NULLS LAST</code>: æ§åˆ¶ç´¢å¼•çš„æ’åºé¡ºåºå’Œ NULL å€¼çš„æ’åºã€‚</li></ul></li></ul><p><strong>4. ä½•æ—¶åˆ›å»ºç´¢å¼•ï¼š</strong></p><ul><li>ç»å¸¸åœ¨ <code>WHERE</code> å­å¥ä¸­ç”¨ä½œæŸ¥è¯¢æ¡ä»¶çš„åˆ—ã€‚</li><li>ç”¨ä½œ <code>JOIN</code> æ¡ä»¶çš„åˆ— (å¤–é”®åˆ—é€šå¸¸åº”è¯¥æœ‰ç´¢å¼•)ã€‚</li><li>ç»å¸¸åœ¨ <code>ORDER BY</code> å­å¥ä¸­ä½¿ç”¨çš„åˆ—ã€‚</li><li>å½“ <code>MIN()</code> æˆ– <code>MAX()</code> åº”ç”¨äºæŸåˆ—æ—¶ã€‚</li><li>ä¸»é”®åˆ—ä¼šè‡ªåŠ¨åˆ›å»ºå”¯ä¸€ B-Tree ç´¢å¼•ã€‚</li></ul><p><strong>æŸ¥è¯¢ä¼˜åŒ– (Query Optimization)</strong></p><p>æŸ¥è¯¢ä¼˜åŒ–å™¨æ˜¯ PostgreSQL çš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒä¼šå°è¯•ä¸ºæ¯ä¸ª SQL æŸ¥è¯¢æ‰¾åˆ°æœ€æœ‰æ•ˆçš„æ‰§è¡Œè®¡åˆ’ã€‚</p><p><strong>1. <code>EXPLAIN</code> å’Œ <code>EXPLAIN ANALYZE</code>ï¼š</strong></p><p>è¿™æ˜¯ç†è§£å’Œä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½çš„æœ€é‡è¦å·¥å…·ã€‚</p><ul><li><code>EXPLAIN query;</code>: æ˜¾ç¤ºæŸ¥è¯¢ä¼˜åŒ–å™¨ä¸ºæŸ¥è¯¢ç”Ÿæˆçš„<strong>ä¼°è®¡</strong>æ‰§è¡Œè®¡åˆ’ï¼ŒåŒ…æ‹¬å°†ä½¿ç”¨çš„æ“ä½œï¼ˆå¦‚å…¨è¡¨æ‰«æã€ç´¢å¼•æ‰«æã€è¿æ¥ç±»å‹ç­‰ï¼‰ä»¥åŠä¼°è®¡çš„æˆæœ¬ã€è¡Œæ•°å’Œå®½åº¦ã€‚<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EXPLAIN </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> department_id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><code>EXPLAIN ANALYZE query;</code>: <strong>å®é™…æ‰§è¡Œ</strong>æŸ¥è¯¢ï¼Œå¹¶æ˜¾ç¤ºçœŸå®çš„æ‰§è¡Œè®¡åˆ’ã€å®é™…çš„æ‰§è¡Œæ—¶é—´ã€è¡Œæ•°ä»¥åŠå…¶ä»–ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¦‚ç¼“å†²åŒºä½¿ç”¨æƒ…å†µï¼‰ã€‚è¿™å¯¹äºæ¯”è¾ƒä¼°è®¡æˆæœ¬ä¸å®é™…æˆæœ¬è‡³å…³é‡è¦ã€‚<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EXPLAIN ANALYZE </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> employees </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> department_id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><strong><code>EXPLAIN</code> è¾“å‡ºè§£è¯»ï¼š</strong><ul><li><strong>èŠ‚ç‚¹ç±»å‹ (Node Type)</strong>ï¼šå¦‚ <code>Seq Scan</code> (å…¨è¡¨æ‰«æ), <code>Index Scan</code>, <code>Index Only Scan</code>, <code>Bitmap Heap Scan</code>, <code>Nested Loop Join</code>, <code>Hash Join</code>, <code>Merge Join</code>, <code>Sort</code>, <code>Aggregate</code> ç­‰ã€‚</li><li><strong>Cost (æˆæœ¬)</strong>ï¼š<code>cost=startup_cost..total_cost</code>ã€‚è¿™æ˜¯ä¸€ä¸ªä»»æ„çš„å•ä½ï¼Œè¡¨ç¤ºä¼˜åŒ–å™¨å¯¹æ‰§è¡Œè¯¥æ“ä½œçš„ä¼°è®¡æˆæœ¬ã€‚<code>startup_cost</code> æ˜¯è¿”å›ç¬¬ä¸€è¡Œä¹‹å‰çš„æˆæœ¬ï¼Œ<code>total_cost</code> æ˜¯è¿”å›æ‰€æœ‰è¡Œçš„æˆæœ¬ã€‚</li><li><strong>Rows (è¡Œæ•°)</strong>ï¼šä¼˜åŒ–å™¨ä¼°è®¡è¯¥èŠ‚ç‚¹å°†è¾“å‡ºçš„è¡Œæ•°ã€‚</li><li><strong>Width (å®½åº¦)</strong>ï¼šä¼˜åŒ–å™¨ä¼°è®¡æ¯è¡Œæ•°æ®çš„å¹³å‡å­—èŠ‚æ•°ã€‚</li><li><strong>(Actual time, rows, loops - <code>EXPLAIN ANALYZE</code> ç‰¹æœ‰)</strong>ï¼šå®é™…æ‰§è¡Œæ—¶é—´ã€å®é™…è¿”å›è¡Œæ•°ã€æ‰§è¡Œå¾ªç¯æ¬¡æ•°ã€‚</li><li><code>Buffers</code>: æ˜¾ç¤ºå…±äº«ç¼“å†²åŒº (<code>shared hit/read</code>)ã€æœ¬åœ°ç¼“å†²åŒº (<code>local hit/read</code>) å’Œä¸´æ—¶ç¼“å†²åŒº (<code>temp read/written</code>) çš„ä½¿ç”¨æƒ…å†µã€‚<code>hit</code> è¡¨ç¤ºæ•°æ®åœ¨å†…å­˜ä¸­æ‰¾åˆ°ï¼Œ<code>read</code> è¡¨ç¤ºä»ç£ç›˜è¯»å–ã€‚</li></ul></li></ul><p><strong>2. å¸¸è§çš„æŸ¥è¯¢ä¼˜åŒ–æŠ€å·§ï¼š</strong></p><ul><li><strong>ç¡®ä¿ç»Ÿè®¡ä¿¡æ¯æœ€æ–°</strong>ï¼šä¼˜åŒ–å™¨ä¾èµ–äºå…³äºè¡¨å’Œåˆ—ä¸­æ•°æ®åˆ†å¸ƒçš„ç»Ÿè®¡ä¿¡æ¯æ¥åšå‡ºæ˜æ™ºçš„å†³ç­–ã€‚<code>ANALYZE table_name;</code> æˆ– <code>VACUUM ANALYZE table_name;</code> å‘½ä»¤ç”¨äºæ”¶é›†è¿™äº›ç»Ÿè®¡ä¿¡æ¯ã€‚è‡ªåŠ¨æ¸…ç† (Autovacuum) è¿›ç¨‹é€šå¸¸ä¼šè‡ªåŠ¨å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œä½†æœ‰æ—¶å¯èƒ½éœ€è¦æ‰‹åŠ¨è¿è¡Œã€‚</li><li><strong>åˆç†ä½¿ç”¨ç´¢å¼•</strong>ï¼š <ul><li>ä¸º <code>WHERE</code> å­å¥ã€<code>JOIN</code> æ¡ä»¶å’Œ <code>ORDER BY</code> å­å¥ä¸­çš„åˆ—åˆ›å»ºåˆé€‚çš„ç´¢å¼•ã€‚</li><li>é¿å…å¯¹å°è¡¨åˆ›å»ºè¿‡å¤šç´¢å¼•ã€‚</li><li>è€ƒè™‘ä½¿ç”¨è¡¨è¾¾å¼ç´¢å¼•ã€éƒ¨åˆ†ç´¢å¼•æˆ–å¤šåˆ—ç´¢å¼•ã€‚</li><li>å®šæœŸæ£€æŸ¥æœªä½¿ç”¨çš„ç´¢å¼• (<code>SELECT * FROM pg_stat_user_indexes WHERE idx_scan = 0;</code>) å¹¶è€ƒè™‘åˆ é™¤å®ƒä»¬ã€‚</li></ul></li><li><strong>ç¼–å†™é«˜æ•ˆçš„ SQL</strong>ï¼š <ul><li><strong>é¿å… <code>SELECT *</code></strong>ï¼šåªé€‰æ‹©ä½ éœ€è¦çš„åˆ—ï¼Œè¿™å¯ä»¥å‡å°‘æ•°æ®ä¼ è¾“é‡ï¼Œå¹¶å¯èƒ½å…è®¸ä½¿ç”¨ä»…ç´¢å¼•æ‰«æã€‚</li><li><strong>è°¨æ…ä½¿ç”¨å‡½æ•°å’Œè®¡ç®—</strong>ï¼šåœ¨ <code>WHERE</code> å­å¥ä¸­å¯¹åˆ—ä½¿ç”¨å‡½æ•°å¯èƒ½ä¼šé˜»æ­¢ç´¢å¼•çš„ä½¿ç”¨ï¼Œé™¤éåˆ›å»ºäº†ç›¸åº”çš„è¡¨è¾¾å¼ç´¢å¼•ã€‚ä¾‹å¦‚ï¼Œ<code>WHERE my_date_col + interval &#39;1 day&#39; &gt; NOW()</code> å¯èƒ½æ¯” <code>WHERE my_date_col &gt; NOW() - interval &#39;1 day&#39;</code> æ•ˆç‡ä½ã€‚</li><li><strong>ä½¿ç”¨ <code>EXISTS</code> è€Œä¸æ˜¯ <code>COUNT(*)</code></strong>ï¼šå¦‚æœåªæ˜¯æ£€æŸ¥æ˜¯å¦å­˜åœ¨æŸäº›è¡Œï¼Œ<code>EXISTS</code> é€šå¸¸æ¯” <code>COUNT(*)</code> æ›´é«˜æ•ˆï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨æ‰¾åˆ°ç¬¬ä¸€è¡Œååœæ­¢ã€‚<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä½æ•ˆ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">IF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> COUNT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(*) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> orders </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> customer_id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> THEN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ...</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- é«˜æ•ˆ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">IF</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> orders </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> customer_id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">THEN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong><code>JOIN</code> vs. å­æŸ¥è¯¢</strong>ï¼šè™½ç„¶ä¼˜åŒ–å™¨é€šå¸¸èƒ½å¾ˆå¥½åœ°å¤„ç†ä¸¤è€…ï¼Œä½†æœ‰æ—¶å°†å­æŸ¥è¯¢é‡å†™ä¸º <code>JOIN</code> (åä¹‹äº¦ç„¶) å¯èƒ½ä¼šäº§ç”Ÿæ›´å¥½çš„è®¡åˆ’ã€‚</li><li><strong>ä½¿ç”¨ <code>UNION ALL</code> è€Œä¸æ˜¯ <code>UNION</code></strong>ï¼šå¦‚æœç¡®å®šç»“æœé›†ä¸­æ²¡æœ‰é‡å¤è¡Œï¼Œæˆ–è€…å…è®¸é‡å¤è¡Œï¼Œ<code>UNION ALL</code> æ¯” <code>UNION</code> æ›´å¿«ï¼Œå› ä¸ºå®ƒè·³è¿‡äº†å»é‡æ­¥éª¤ã€‚</li><li><strong>åˆ†é¡µä¼˜åŒ–</strong>ï¼šå¯¹äºéå¸¸å¤§çš„è¡¨ï¼ŒåŸºäº <code>OFFSET</code> çš„åˆ†é¡µ (å¦‚ <code>LIMIT 10 OFFSET 1000000</code>) å¯èƒ½ä¼šå˜æ…¢ï¼Œå› ä¸ºå®ƒä»ç„¶éœ€è¦æ‰«æå¹¶è·³è¿‡å‰é¢çš„å¤§é‡è¡Œã€‚å¯ä»¥è€ƒè™‘ä½¿ç”¨â€œé”®é›†åˆ†é¡µâ€ (Keyset Pagination) æˆ–â€œseek methodâ€ã€‚</li></ul></li><li><strong>æ•°æ®åº“è®¾è®¡</strong>ï¼š <ul><li><strong>è§„èŒƒåŒ–</strong>ï¼šé€‚å½“çš„è§„èŒƒåŒ–å¯ä»¥å‡å°‘æ•°æ®å†—ä½™ï¼Œæé«˜æ•°æ®ä¸€è‡´æ€§ï¼Œä½†è¿‡åº¦è§„èŒƒåŒ–æœ‰æ—¶ä¼šå¯¼è‡´è¿‡å¤šçš„è¿æ¥ã€‚</li><li><strong>æ•°æ®ç±»å‹é€‰æ‹©</strong>ï¼šé€‰æ‹©æœ€åˆé€‚ã€æœ€å°çš„æ•°æ®ç±»å‹å¯ä»¥èŠ‚çœç©ºé—´å¹¶æé«˜æ€§èƒ½ã€‚</li></ul></li><li><strong>æœåŠ¡å™¨é…ç½® (<code>postgresql.conf</code>)</strong>ï¼š <ul><li><code>shared_buffers</code>: PostgreSQL ç”¨äºç¼“å­˜æ•°æ®çš„å†…å­˜é‡ã€‚é€šå¸¸è®¾ç½®ä¸ºç³»ç»Ÿæ€»å†…å­˜çš„ 15-25%ã€‚</li><li><code>work_mem</code>: ç”¨äºæ’åºã€å“ˆå¸Œè¿æ¥ç­‰å†…éƒ¨æ“ä½œçš„å†…å­˜é‡ã€‚è®¾ç½®è¿‡ä½ä¼šå¯¼è‡´ä½¿ç”¨ç£ç›˜ä¸´æ—¶æ–‡ä»¶ã€‚</li><li><code>maintenance_work_mem</code>: ç”¨äºç»´æŠ¤æ“ä½œï¼ˆå¦‚ <code>VACUUM</code>, <code>CREATE INDEX</code>, <code>ALTER TABLE ADD FOREIGN KEY</code>ï¼‰çš„å†…å­˜é‡ã€‚</li><li><code>effective_cache_size</code>: ä¼˜åŒ–å™¨ç”¨æ¥ä¼°è®¡æ“ä½œç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿç¼“å­˜ä¸­å¯ç”¨å†…å­˜é‡çš„å‚æ•°ã€‚</li></ul></li><li><strong>ç›‘æ§å’Œè°ƒæ•´</strong>ï¼š <ul><li>å®šæœŸä½¿ç”¨ <code>pg_stat_statements</code> æ‰©å±•æ¥è¯†åˆ«æ‰§è¡Œé¢‘ç‡é«˜æˆ–æ€»æ‰§è¡Œæ—¶é—´é•¿çš„æŸ¥è¯¢ã€‚</li><li>ç›‘æ§æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚</li></ul></li></ul><p>ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦ç»“åˆå¯¹æ•°æ®ã€åº”ç”¨è´Ÿè½½å’Œ PostgreSQL å†…éƒ¨æœºåˆ¶çš„ç†è§£ã€‚<code>EXPLAIN ANALYZE</code> æ˜¯ä½ æœ€é‡è¦çš„ç›Ÿå‹ã€‚</p><hr><h3 id="äº‹åŠ¡ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡ç®¡ç†"><span>äº‹åŠ¡ç®¡ç†</span></a></h3><p>äº‹åŠ¡ (Transaction) æ˜¯ä¸€ç³»åˆ—æ•°æ®åº“æ“ä½œçš„é€»è¾‘å•å…ƒï¼Œè¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸæ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œï¼ˆå›æ»šï¼‰ã€‚PostgreSQL æä¾›äº†å¼ºå¤§çš„äº‹åŠ¡æ”¯æŒï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼Œéµå¾ª ACID åŸåˆ™ã€‚</p><p><strong>1. ACID åŸåˆ™ï¼š</strong></p><p>PostgreSQL çš„äº‹åŠ¡ç®¡ç†ä¸¥æ ¼éµå®ˆ ACID åŸåˆ™ï¼š</p><ul><li><strong>åŸå­æ€§ (Atomicity)</strong>ï¼šäº‹åŠ¡è¢«è§†ä¸ºä¸€ä¸ªä¸å¯åˆ†å‰²çš„æœ€å°å·¥ä½œå•å…ƒã€‚äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æäº¤æˆåŠŸï¼Œè¦ä¹ˆåœ¨å‘ç”Ÿé”™è¯¯æ—¶å…¨éƒ¨å›æ»šåˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ã€‚é€šè¿‡ <code>BEGIN</code>, <code>COMMIT</code>, å’Œ <code>ROLLBACK</code> å‘½ä»¤å®ç°ã€‚</li><li><strong>ä¸€è‡´æ€§ (Consistency)</strong>ï¼šäº‹åŠ¡å°†æ•°æ®åº“ä»ä¸€ä¸ªæœ‰æ•ˆçŠ¶æ€è½¬å˜åˆ°å¦ä¸€ä¸ªæœ‰æ•ˆçŠ¶æ€ã€‚æ‰€æœ‰æ•°æ®å®Œæ•´æ€§çº¦æŸï¼ˆå¦‚ä¸»é”®ã€å¤–é”®ã€æ£€æŸ¥çº¦æŸã€NOT NULLï¼‰å¿…é¡»åœ¨äº‹åŠ¡æäº¤æ—¶å¾—åˆ°æ»¡è¶³ã€‚å¦‚æœæŸä¸ªæ“ä½œè¿åäº†çº¦æŸï¼Œäº‹åŠ¡å°†å›æ»šã€‚</li><li><strong>éš”ç¦»æ€§ (Isolation)</strong>ï¼šå¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ä¹‹é—´åº”è¯¥ç›¸äº’éš”ç¦»ï¼Œä¸€ä¸ªäº‹åŠ¡çš„ä¸­é—´çŠ¶æ€ä¸åº”è¯¥å¯¹å…¶ä»–äº‹åŠ¡å¯è§ï¼Œä»¥é˜²æ­¢æ•°æ®ä¸ä¸€è‡´ã€‚PostgreSQL é€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ (MVCC) å’Œä¸åŒçš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ¥å®ç°ã€‚</li><li><strong>æŒä¹…æ€§ (Durability)</strong>ï¼šä¸€æ—¦äº‹åŠ¡æˆåŠŸæäº¤ (<code>COMMIT</code>)ï¼Œå…¶æ‰€åšçš„æ›´æ”¹å°†æ°¸ä¹…ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œå³ä½¿å‘ç”Ÿç³»ç»Ÿæ•…éšœï¼ˆå¦‚æ–­ç”µæˆ–æœåŠ¡å™¨å´©æºƒï¼‰ã€‚è¿™é€šå¸¸é€šè¿‡é¢„å†™æ—¥å¿— (Write-Ahead Logging, WAL) æ¥ä¿è¯ï¼Œå³åœ¨æ•°æ®å®é™…å†™å…¥æ•°æ®æ–‡ä»¶ä¹‹å‰ï¼Œæ›´æ”¹ä¼šå…ˆè®°å½•åˆ°æ—¥å¿—ä¸­ã€‚</li></ul><p><strong>2. äº‹åŠ¡æ§åˆ¶å‘½ä»¤ï¼š</strong></p><ul><li><p><strong><code>BEGIN</code> æˆ– <code>START TRANSACTION</code></strong>:<br> æ˜¾å¼å¼€å§‹ä¸€ä¸ªæ–°çš„äº‹åŠ¡å—ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">BEGIN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æˆ–è€…</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">START TRANSACTION</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ­¤å‘½ä»¤ä¹‹åçš„æ‰€æœ‰ SQL è¯­å¥éƒ½å°†åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ° <code>COMMIT</code> æˆ– <code>ROLLBACK</code>ã€‚</p></li><li><p><strong><code>COMMIT</code> æˆ– <code>END</code></strong>:<br> æˆåŠŸç»“æŸå½“å‰äº‹åŠ¡ï¼Œå¹¶å°†äº‹åŠ¡æœŸé—´æ‰€åšçš„æ‰€æœ‰æ›´æ”¹æ°¸ä¹…ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">COMMIT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æˆ–è€…</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">END</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- END æ˜¯ COMMIT çš„åŒä¹‰è¯</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>COMMIT AND CHAIN</code> (PostgreSQL 14+): æäº¤å½“å‰äº‹åŠ¡å¹¶ç«‹å³å¼€å§‹ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå…·æœ‰ä¸åˆšæäº¤çš„äº‹åŠ¡ç›¸åŒçš„äº‹åŠ¡ç‰¹æ€§ï¼ˆå¦‚éš”ç¦»çº§åˆ«ï¼‰ã€‚</p></li><li><p><strong><code>ROLLBACK</code></strong>:<br> ä¸­æ­¢å½“å‰äº‹åŠ¡ï¼Œå¹¶æ’¤é”€äº‹åŠ¡æœŸé—´æ‰€åšçš„æ‰€æœ‰æ›´æ”¹ï¼Œä½¿æ•°æ®åº“æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ROLLBACK</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>ROLLBACK AND CHAIN</code> (PostgreSQL 14+): å›æ»šå½“å‰äº‹åŠ¡å¹¶ç«‹å³å¼€å§‹ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå…·æœ‰ä¸åˆšå›æ»šçš„äº‹åŠ¡ç›¸åŒçš„äº‹åŠ¡ç‰¹æ€§ã€‚</p></li><li><p><strong><code>SAVEPOINT savepoint_name</code></strong>:<br> åœ¨å½“å‰äº‹åŠ¡ä¸­åˆ›å»ºä¸€ä¸ªâ€œä¿å­˜ç‚¹â€ã€‚ä¿å­˜ç‚¹å…è®¸ä½ å›æ»šäº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ•´ä¸ªäº‹åŠ¡ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">BEGIN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> mytable (id, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;first&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">SAVEPOINT my_savepoint;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">UPDATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> mytable </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> data</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;updated_first&#39;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å‡è®¾è¿™é‡Œå‡ºç°é—®é¢˜æˆ–éœ€è¦æ’¤é”€éƒ¨åˆ†æ“ä½œ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>ROLLBACK TO SAVEPOINT savepoint_name</code></strong>:<br> å°†äº‹åŠ¡å›æ»šåˆ°æŒ‡å®šçš„ä¿å­˜ç‚¹ã€‚åœ¨ä¿å­˜ç‚¹ä¹‹åæ‰€åšçš„æ›´æ”¹å°†è¢«æ’¤é”€ï¼Œä½†åœ¨ä¿å­˜ç‚¹ä¹‹å‰æ‰€åšçš„æ›´æ”¹ä»ç„¶æ˜¯äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥ç¨åæäº¤æˆ–å›æ»šã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æ¥ä¸Šä¾‹</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ROLLBACK</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> SAVEPOINT my_savepoint; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è¿™ä¼šæ’¤é”€ UPDATE æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æ­¤æ—¶ id=1 çš„è¡Œçš„ data ä»ç„¶æ˜¯ &#39;first&#39;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> mytable (id, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;second after rollback to savepoint&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">COMMIT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æäº¤ id=1 (å€¼ä¸º&#39;first&#39;) å’Œ id=2 çš„æ’å…¥</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœ <code>ROLLBACK TO SAVEPOINT</code> å‘½ä»¤æŒ‡å®šçš„ä¿å­˜ç‚¹ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå¼•å‘é”™è¯¯ã€‚æ‰§è¡Œ <code>ROLLBACK TO SAVEPOINT</code> åï¼Œè¯¥ä¿å­˜ç‚¹ä»¥åŠåœ¨å…¶ä¹‹åå®šä¹‰çš„æ‰€æœ‰ä¿å­˜ç‚¹éƒ½å°†è¢«é”€æ¯ï¼Œä½†è¯¥ä¿å­˜ç‚¹ä»ç„¶æœ‰æ•ˆï¼Œå¯ä»¥å†æ¬¡å›æ»šåˆ°å®ƒã€‚</p></li><li><p><strong><code>RELEASE SAVEPOINT savepoint_name</code></strong>:<br> é”€æ¯å…ˆå‰åœ¨å½“å‰äº‹åŠ¡ä¸­å®šä¹‰çš„æŒ‡å®šä¿å­˜ç‚¹ã€‚è¿™ä¼šé‡Šæ”¾ä¸ä¿å­˜ç‚¹ç›¸å…³çš„ä¸€äº›èµ„æºã€‚å®ƒä¸ä¼šæ’¤é”€ä»»ä½•æ›´æ”¹ã€‚</p></li></ul><p><strong>3. äº‹åŠ¡éš”ç¦»çº§åˆ« (Transaction Isolation Levels)ï¼š</strong></p><p>SQL æ ‡å‡†å®šä¹‰äº†å››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ŒPostgreSQL å…¨éƒ¨æ”¯æŒï¼Œå¹¶å¯¹å…¶ä¸­ä¸€äº›è¡Œä¸ºæœ‰ç‰¹å®šå®ç°ï¼š</p><ul><li><p><strong><code>READ UNCOMMITTED</code> (è¯»æœªæäº¤)</strong>ï¼š</p><ul><li>æœ€ä½çš„éš”ç¦»çº§åˆ«ã€‚ä¸€ä¸ªäº‹åŠ¡å¯ä»¥çœ‹åˆ°å…¶ä»–äº‹åŠ¡å°šæœªæäº¤çš„æ›´æ”¹ï¼ˆè„è¯»ï¼‰ã€‚</li><li><strong>åœ¨ PostgreSQL ä¸­ï¼Œ<code>READ UNCOMMITTED</code> çš„è¡Œä¸ºä¸ <code>READ COMMITTED</code> å®Œå…¨ç›¸åŒã€‚</strong> PostgreSQL ä¸å…è®¸è„è¯»ã€‚</li><li><code>SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</code></li></ul></li><li><p><strong><code>READ COMMITTED</code> (è¯»å·²æäº¤)</strong>ï¼š</p><ul><li><strong>PostgreSQL çš„é»˜è®¤éš”ç¦»çº§åˆ«ã€‚</strong></li><li>ä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹åˆ°å…¶ä»–äº‹åŠ¡å·²ç»æäº¤çš„æ›´æ”¹ã€‚</li><li>ä¿è¯ä¸ä¼šå‘ç”Ÿè„è¯»ã€‚</li><li>ä½†æ˜¯ï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨ï¼Œå¦‚æœå¤šæ¬¡æ‰§è¡Œç›¸åŒçš„æŸ¥è¯¢ï¼Œå¯èƒ½ä¼šçœ‹åˆ°ä¸åŒçš„ç»“æœï¼ˆä¸å¯é‡å¤è¯»ï¼‰ï¼Œå› ä¸ºå…¶ä»–å¹¶å‘äº‹åŠ¡å¯èƒ½åœ¨ä¸¤æ¬¡æŸ¥è¯¢ä¹‹é—´æäº¤äº†æ–°çš„æ›´æ”¹ã€‚</li><li>å¹»è¯» (Phantom Reads) ä¹Ÿæœ‰å¯èƒ½å‘ç”Ÿï¼šä¸€ä¸ªäº‹åŠ¡åœ¨ä¸¤æ¬¡æ‰§è¡Œç›¸åŒçš„èŒƒå›´æŸ¥è¯¢æ—¶ï¼Œç¬¬äºŒæ¬¡æŸ¥è¯¢å¯èƒ½ä¼šè¿”å›ç¬¬ä¸€æ¬¡æŸ¥è¯¢ä¸­æœªå‡ºç°çš„â€œå¹»å½±â€è¡Œï¼Œå› ä¸ºå…¶ä»–äº‹åŠ¡åœ¨æ­¤æœŸé—´æ’å…¥äº†ç¬¦åˆæ¡ä»¶çš„æ–°è¡Œå¹¶æäº¤äº†ã€‚</li><li><code>SET TRANSACTION ISOLATION LEVEL READ COMMITTED;</code></li></ul></li><li><p><strong><code>REPEATABLE READ</code> (å¯é‡å¤è¯»)</strong>ï¼š</p><ul><li>ä¿è¯åœ¨ä¸€ä¸ªäº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œå¤šæ¬¡è¯»å–ç›¸åŒæ•°æ®çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼ˆä¸ä¼šå‘ç”Ÿä¸å¯é‡å¤è¯»ï¼‰ã€‚äº‹åŠ¡åªèƒ½çœ‹åˆ°åœ¨å®ƒå¼€å§‹ä¹‹å‰å·²ç»æäº¤çš„æ•°æ®ã€‚</li><li>åœ¨ PostgreSQL ä¸­ï¼Œ<code>REPEATABLE READ</code> çº§åˆ«é€šè¿‡è·å–æ•°æ®å¿«ç…§æ¥å®ç°ã€‚</li><li>å¹»è¯»ä»ç„¶å¯èƒ½å‘ç”Ÿï¼Œä½† PostgreSQL çš„å®ç°é€šå¸¸èƒ½é˜²æ­¢å¤§éƒ¨åˆ†å¹»è¯»åœºæ™¯ã€‚</li><li><strong>é‡è¦</strong>ï¼šå¦‚æœä¸€ä¸ª <code>REPEATABLE READ</code> äº‹åŠ¡è¯•å›¾ä¿®æ”¹ä¸€ä¸ªå·²è¢«å¹¶å‘äº‹åŠ¡ï¼ˆåœ¨è¯¥ <code>REPEATABLE READ</code> äº‹åŠ¡å¯åŠ¨åæäº¤ï¼‰ä¿®æ”¹çš„è¡Œï¼Œå®ƒå°†æ”¶åˆ°ä¸€ä¸ª**åºåˆ—åŒ–å¤±è´¥ (serialization failure)**é”™è¯¯ï¼Œå¹¶è¢«å¼ºåˆ¶å›æ»šã€‚åº”ç”¨ç¨‹åºå¿…é¡»å‡†å¤‡å¥½æ•è·è¿™ç§é”™è¯¯å¹¶é‡è¯•äº‹åŠ¡ã€‚</li><li><code>SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;</code></li></ul></li><li><p><strong><code>SERIALIZABLE</code> (å¯ä¸²è¡ŒåŒ–)</strong>ï¼š</p><ul><li>æœ€é«˜çš„éš”ç¦»çº§åˆ«ã€‚ä¿è¯å¹¶å‘äº‹åŠ¡çš„æ‰§è¡Œç»“æœä¸æŒ‰æŸç§é¡ºåºé€ä¸ªæ‰§è¡Œå®ƒä»¬çš„ç»“æœå®Œå…¨ç›¸åŒã€‚</li><li>å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚</li><li>PostgreSQL é€šè¿‡ä¸€ç§ç§°ä¸ºâ€œå¯ä¸²è¡ŒåŒ–å¿«ç…§éš”ç¦» (Serializable Snapshot Isolation, SSI)â€çš„æŠ€æœ¯æ¥å®ç°ã€‚</li><li>ä¸ <code>REPEATABLE READ</code> ç±»ä¼¼ï¼Œå¦‚æœ PostgreSQL æ£€æµ‹åˆ°ä¸€ç»„å¹¶å‘çš„ <code>SERIALIZABLE</code> äº‹åŠ¡ç”±äºç›¸äº’ä¾èµ–è€Œæ— æ³•æ‰¾åˆ°ä¸€ä¸ªä¸²è¡Œæ‰§è¡Œé¡ºåºæ¥äº§ç”Ÿç›¸åŒçš„ç»“æœï¼Œé‚£ä¹ˆå…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡å°†è¢«å¼ºåˆ¶å›æ»šï¼Œå¹¶æŠ¥å‘Šä¸€ä¸ªåºåˆ—åŒ–å¤±è´¥é”™è¯¯ã€‚åº”ç”¨ç¨‹åºå¿…é¡»å‡†å¤‡å¥½é‡è¯•è¿™äº›äº‹åŠ¡ã€‚</li><li>è¿™æ˜¯æœ€å¼ºçš„éš”ç¦»çº§åˆ«ï¼Œä½†é€šå¸¸æ€§èƒ½å¼€é”€ä¹Ÿæœ€å¤§ã€‚</li><li><code>SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;</code></li></ul></li></ul><p>å¯ä»¥ä½¿ç”¨ <code>SET TRANSACTION</code> å‘½ä»¤åœ¨äº‹åŠ¡å¼€å§‹æ—¶è®¾ç½®éš”ç¦»çº§åˆ«ï¼Œæˆ–è€…ä½¿ç”¨ <code>SET SESSION CHARACTERISTICS AS TRANSACTION ISOLATION LEVEL ...</code> ä¸ºæ•´ä¸ªä¼šè¯è®¾ç½®é»˜è®¤éš”ç¦»çº§åˆ«ã€‚</p><p><strong>éšå¼äº‹åŠ¡ï¼š</strong></p><p>å¦‚æœåœ¨ <code>psql</code> æˆ–å¤§å¤šæ•°æ•°æ®åº“è¿æ¥åº“ä¸­ï¼Œä½ æ²¡æœ‰æ˜¾å¼ä½¿ç”¨ <code>BEGIN</code>ï¼Œé‚£ä¹ˆæ¯æ¡å•ç‹¬çš„ SQL è¯­å¥ï¼ˆå¦‚ <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>CREATE TABLE</code> ç­‰ï¼Œé™¤äº†äº‹åŠ¡æ§åˆ¶å‘½ä»¤æœ¬èº«ï¼‰éƒ½ä¼šè¢«è§†ä¸ºä¸€ä¸ªç‹¬ç«‹çš„äº‹åŠ¡ï¼Œå¹¶åœ¨æ‰§è¡ŒæˆåŠŸåè‡ªåŠ¨æäº¤ï¼ˆå¦‚æœå¤±è´¥åˆ™è‡ªåŠ¨å›æ»šï¼‰ã€‚è¿™ç§°ä¸ºâ€œè‡ªåŠ¨æäº¤ (autocommit)â€æ¨¡å¼ã€‚</p><p>ç†è§£å¹¶æ­£ç¡®ä½¿ç”¨äº‹åŠ¡å¯¹äºç»´æŠ¤æ•°æ®ä¸€è‡´æ€§å’Œæ„å»ºå¯é çš„åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ã€‚åº”æ ¹æ®åº”ç”¨çš„å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„éš”ç¦»çº§åˆ«ã€‚</p><h3 id="json-æ”¯æŒ" tabindex="-1"><a class="header-anchor" href="#json-æ”¯æŒ"><span>JSON æ”¯æŒ</span></a></h3><p>PostgreSQL å¯¹ JSON (JavaScript Object Notation) æ•°æ®æä¾›äº†å¼ºå¤§çš„åŸç”Ÿæ”¯æŒï¼Œä½¿å…¶èƒ½å¤Ÿæœ‰æ•ˆåœ°å­˜å‚¨ã€ç´¢å¼•å’ŒæŸ¥è¯¢ JSON æ–‡æ¡£ã€‚</p><p><strong>1. JSON æ•°æ®ç±»å‹ï¼š</strong></p><p>PostgreSQL æä¾›äº†ä¸¤ç§ç”¨äºå­˜å‚¨ JSON æ•°æ®çš„åŸç”Ÿç±»å‹ï¼š</p><ul><li><p><strong><code>json</code></strong>:</p><ul><li>å­˜å‚¨è¾“å…¥æ–‡æœ¬çš„<strong>ç²¾ç¡®å‰¯æœ¬</strong>ã€‚è¿™æ„å‘³ç€å®ƒä¼šä¿ç•™åŸå§‹ JSON æ–‡æœ¬ä¸­çš„æ‰€æœ‰ç©ºæ ¼ã€é”®çš„é¡ºåºä»¥åŠé‡å¤çš„é”®ã€‚</li><li>å¤„ç†å‡½æ•°å¿…é¡»åœ¨æ¯æ¬¡æ‰§è¡Œæ—¶é‡æ–°è§£ææ•´ä¸ª JSON æ–‡æœ¬ã€‚</li><li>å› æ­¤ï¼Œå¯¹äºå¤§å¤šæ•°æ“ä½œæ¥è¯´ï¼Œ<code>json</code> ç±»å‹é€šå¸¸æ¯” <code>jsonb</code> æ…¢ã€‚</li><li>ä¸»è¦ä¼˜ç‚¹æ˜¯ä¿ç•™äº†åŸå§‹æ ¼å¼ï¼Œå¦‚æœè¿™ä¸€ç‚¹å¾ˆé‡è¦çš„è¯ã€‚</li></ul></li><li><p><strong><code>jsonb</code> (JSON Binary)</strong>:</p><ul><li>å­˜å‚¨ JSON æ•°æ®çš„<strong>åˆ†è§£çš„äºŒè¿›åˆ¶æ ¼å¼</strong>ã€‚è¿™ç§æ ¼å¼åœ¨è¾“å…¥æ—¶ä¼šè¿›è¡Œè½¬æ¢ï¼Œæ¯” <code>json</code> ç±»å‹ç•¥æ…¢ï¼Œä½†åœ¨å¤„ç†æ—¶é€šå¸¸å¿«å¾—å¤šï¼Œå› ä¸ºå®ƒä¸éœ€è¦é‡æ–°è§£æã€‚</li><li><code>jsonb</code> ä¸ä¼šä¿ç•™ä¸é‡è¦çš„ç©ºæ ¼ã€é”®çš„åŸå§‹é¡ºåºï¼Œå¹¶ä¸”å¦‚æœå­˜åœ¨é‡å¤çš„é”®ï¼Œåªä¼šä¿ç•™æœ€åä¸€ä¸ªé”®/å€¼å¯¹ã€‚</li><li><strong><code>jsonb</code> æ”¯æŒç´¢å¼•</strong>ï¼Œè¿™å¯¹äºæŸ¥è¯¢æ€§èƒ½è‡³å…³é‡è¦ã€‚GIN (Generalized Inverted Index) ç´¢å¼•æ˜¯ <code>jsonb</code> å¸¸ç”¨çš„ç´¢å¼•ç±»å‹ã€‚</li><li><strong>é€šå¸¸æ¨èä½¿ç”¨ <code>jsonb</code> ç±»å‹</strong>ï¼Œé™¤éæœ‰ç‰¹æ®Šç†ç”±éœ€è¦ä¿ç•™ JSON æ–‡æœ¬çš„ç²¾ç¡®åŸå§‹æ ¼å¼ã€‚</li></ul></li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> products</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SERIAL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> PRIMARY KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    name</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TEXT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    attributes JSONB</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, attributes) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Laptop&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;{&quot;brand&quot;: &quot;AwesomeBrand&quot;, &quot;ram_gb&quot;: 16, &quot;tags&quot;: [&quot;electronics&quot;, &quot;computer&quot;], &quot;specs&quot;: {&quot;cpu&quot;: &quot;i7&quot;, &quot;disk&quot;: &quot;512GB SSD&quot;}}&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Mouse&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;{&quot;brand&quot;: &quot;ClickFast&quot;, &quot;color&quot;: &quot;black&quot;, &quot;tags&quot;: [&quot;electronics&quot;, &quot;peripheral&quot;], &quot;wireless&quot;: true}&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. JSON æ“ä½œç¬¦ï¼š</strong></p><p>PostgreSQL ä¸º <code>json</code> å’Œ <code>jsonb</code> æä¾›äº†ä¸°å¯Œçš„æ“ä½œç¬¦æ¥æå–å’Œæ“ä½œæ•°æ®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ <code>jsonb</code> æ“ä½œç¬¦ (è®¸å¤šä¹Ÿé€‚ç”¨äº <code>json</code>ï¼Œä½† <code>jsonb</code> é€šå¸¸æ›´é«˜æ•ˆä¸”æ”¯æŒæ›´å¤šç´¢å¼•)ï¼š</p><ul><li><p><strong><code>-&gt;</code></strong>: è·å– JSON å¯¹è±¡å­—æ®µçš„å€¼ï¼ˆä½œä¸º <code>jsonb</code> ç±»å‹ï¼‰ã€‚</p><ul><li><code>jsonb_object -&gt; &#39;field_name&#39;</code></li><li><code>jsonb_array -&gt; index</code> (ç´¢å¼•ä» 0 å¼€å§‹)</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> attributes -</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;brand&#39;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> brand </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;Laptop&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ç»“æœ: &quot;AwesomeBrand&quot; (jsonb ç±»å‹)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> attributes -</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;tags&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> first_tag </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;Laptop&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ç»“æœ: &quot;electronics&quot; (jsonb ç±»å‹)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>-&gt;&gt;</code></strong>: è·å– JSON å¯¹è±¡å­—æ®µçš„å€¼ï¼ˆä½œä¸º <code>text</code> ç±»å‹ï¼‰ã€‚</p><ul><li><code>jsonb_object -&gt;&gt; &#39;field_name&#39;</code></li><li><code>jsonb_array -&gt;&gt; index</code></li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> attributes -</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;brand&#39;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> brand_text </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;Laptop&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ç»“æœ: AwesomeBrand (text ç±»å‹)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> attributes -</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;tags&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> first_tag_text </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;Laptop&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ç»“æœ: electronics (text ç±»å‹)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>#&gt;</code></strong>: æŒ‰è·¯å¾„è·å– JSON å­å¯¹è±¡ï¼ˆä½œä¸º <code>jsonb</code> ç±»å‹ï¼‰ã€‚è·¯å¾„æ˜¯ä¸€ä¸ª <code>text</code> æ•°ç»„ã€‚</p><ul><li><code>jsonb_value #&gt; &#39;{path, element, ...}&#39;</code></li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> attributes #</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;{specs, cpu}&#39;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> cpu_spec </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;Laptop&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ç»“æœ: &quot;i7&quot; (jsonb ç±»å‹)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>#&gt;&gt;</code></strong>: æŒ‰è·¯å¾„è·å– JSON å­å¯¹è±¡çš„å€¼ï¼ˆä½œä¸º <code>text</code> ç±»å‹ï¼‰ã€‚</p><ul><li><code>jsonb_value #&gt;&gt; &#39;{path, element, ...}&#39;</code></li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> attributes #</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;{specs, cpu}&#39;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> cpu_spec_text </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;Laptop&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ç»“æœ: i7 (text ç±»å‹)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>@&gt;</code></strong>: å·¦è¾¹çš„ <code>jsonb</code> å€¼æ˜¯å¦åŒ…å«å³è¾¹çš„ <code>jsonb</code> å€¼ (containment)ã€‚</p><ul><li><code>jsonb_container @&gt; jsonb_contained</code></li><li>è¿™æ˜¯ GIN ç´¢å¼• (<code>jsonb_ops</code> æˆ– <code>jsonb_path_ops</code>) ä¸»è¦æ”¯æŒçš„æ“ä½œç¬¦ä¹‹ä¸€ï¼Œå¯¹äºé«˜æ•ˆæŸ¥è¯¢éå¸¸é‡è¦ã€‚</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æŸ¥æ‰¾æ‰€æœ‰å“ç‰Œä¸º AwesomeBrand çš„äº§å“</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, attributes </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> attributes @</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;{&quot;brand&quot;: &quot;AwesomeBrand&quot;}&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æŸ¥æ‰¾æ‰€æœ‰æ ‡ç­¾åŒ…å« &quot;electronics&quot; çš„äº§å“</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, attributes </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> attributes -</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;tags&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;[&quot;electronics&quot;]&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>&lt;@</code></strong>: å·¦è¾¹çš„ <code>jsonb</code> å€¼æ˜¯å¦è¢«å³è¾¹çš„ <code>jsonb</code> å€¼æ‰€åŒ…å«ã€‚</p><ul><li><code>jsonb_contained &lt;@ jsonb_container</code></li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, attributes </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;{&quot;brand&quot;: &quot;ClickFast&quot;, &quot;color&quot;: &quot;black&quot;}&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@ attributes;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong><code>?</code></strong>: å­—ç¬¦ä¸²æ˜¯å¦å­˜åœ¨ä½œä¸ºé¡¶å±‚é”®æˆ–æ•°ç»„å…ƒç´ ã€‚</p><ul><li><code>jsonb_object ? &#39;key_name&#39;</code></li><li><code>jsonb_array ? &#39;element_value&#39;</code></li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, attributes </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> attributes ? </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;color&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æŸ¥æ‰¾æœ‰ &#39;color&#39; é”®çš„äº§å“</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, attributes </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> attributes -</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;tags&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ? </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;peripheral&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æŸ¥æ‰¾æ ‡ç­¾åŒ…å« &quot;peripheral&quot; çš„äº§å“</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>?|</code></strong>: æ•°ç»„ä¸­çš„ä»»ä½•ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦å­˜åœ¨ä½œä¸ºé¡¶å±‚é”®æˆ–æ•°ç»„å…ƒç´ ã€‚</p><ul><li><code>jsonb_value ?| text[]</code></li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, attributes </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> attributes ?| </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ARRAY</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[&#39;ram_gb&#39;, &#39;color&#39;]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong><code>?&amp;</code></strong>: æ•°ç»„ä¸­çš„æ‰€æœ‰å­—ç¬¦ä¸²æ˜¯å¦å­˜åœ¨ä½œä¸ºé¡¶å±‚é”®æˆ–æ•°ç»„å…ƒç´ ã€‚</p><ul><li><code>jsonb_value ?&amp; text[]</code></li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, attributes </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> attributes -</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;specs&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ?&amp; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ARRAY</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[&#39;cpu&#39;, &#39;disk&#39;]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong><code>||</code></strong>: è¿æ¥ä¸¤ä¸ª <code>jsonb</code> å€¼ã€‚</p><ul><li>å¯¹äºå¯¹è±¡ï¼Œå®ƒåˆå¹¶å®ƒä»¬ï¼Œå¦‚æœé”®å†²çªï¼Œåˆ™å³è¾¹çš„å€¼è¦†ç›–å·¦è¾¹çš„å€¼ã€‚</li><li>å¯¹äºæ•°ç»„ï¼Œå®ƒè¿æ¥æ•°ç»„ã€‚</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;{&quot;a&quot;: 1, &quot;b&quot;: 2}&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::jsonb || </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;{&quot;b&quot;: 3, &quot;c&quot;: 4}&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::jsonb;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ç»“æœ: {&quot;a&quot;: 1, &quot;b&quot;: 3, &quot;c&quot;: 4}</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;[1, 2]&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::jsonb || </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;[3, 4]&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::jsonb;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ç»“æœ: [1, 2, 3, 4]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>-</code></strong>: åˆ é™¤é”®/å€¼å¯¹æˆ–æ•°ç»„å…ƒç´ ã€‚</p><ul><li><code>jsonb_object - &#39;key_name&#39;</code></li><li><code>jsonb_array - array_index</code> (è´Ÿæ•°ç´¢å¼•ä»æœ«å°¾å¼€å§‹)</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;{&quot;a&quot;: 1, &quot;b&quot;: 2, &quot;c&quot;: 3}&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::jsonb - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;b&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ç»“æœ: {&quot;a&quot;: 1, &quot;c&quot;: 3}</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::jsonb - </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- åˆ é™¤ç´¢å¼•ä¸º1çš„å…ƒç´  &quot;b&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ç»“æœ: [&quot;a&quot;, &quot;c&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>#-</code></strong>: æŒ‰è·¯å¾„åˆ é™¤å­—æ®µæˆ–å…ƒç´ ã€‚</p><ul><li><code>jsonb_value #- &#39;{path, element, ...}&#39;</code></li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;{&quot;a&quot;: {&quot;b&quot;: 1, &quot;c&quot;: 2}}&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::jsonb #- </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;{a,b}&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ç»“æœ: {&quot;a&quot;: {&quot;c&quot;: 2}}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p><strong>3. JSON å‡½æ•°ï¼š</strong></p><p>PostgreSQL æä¾›äº†å¤§é‡ç”¨äºåˆ›å»ºã€å¤„ç†å’Œè½¬æ¢ JSON æ•°æ®çš„å‡½æ•°ã€‚è®¸å¤šå‡½æ•°éƒ½æœ‰ <code>json_</code> å’Œ <code>jsonb_</code> ä¸¤ä¸ªç‰ˆæœ¬ã€‚</p><ul><li><p><strong>åˆ›å»ºå‡½æ•°ï¼š</strong></p><ul><li><code>to_jsonb(anyelement)</code>: å°† SQL å€¼è½¬æ¢ä¸º <code>jsonb</code>ã€‚</li><li><code>jsonb_build_array(...)</code>: ä»å‚æ•°åˆ—è¡¨æ„å»º <code>jsonb</code> æ•°ç»„ã€‚</li><li><code>jsonb_build_object(...)</code>: ä»å‚æ•°åˆ—è¡¨ï¼ˆé”®/å€¼å¯¹ï¼‰æ„å»º <code>jsonb</code> å¯¹è±¡ã€‚</li><li><code>jsonb_object(text[])</code>: ä»é”®/å€¼å¯¹æ•°ç»„æ„å»º <code>jsonb</code> å¯¹è±¡ã€‚</li><li><code>array_to_json(anyarray)</code>: å°† SQL æ•°ç»„è½¬æ¢ä¸º JSON æ•°ç»„ã€‚</li><li><code>row_to_json(record)</code>: å°† SQL è¡Œ/è®°å½•è½¬æ¢ä¸º JSON å¯¹è±¡ã€‚</li></ul></li><li><p><strong>å¤„ç†å’Œæå–å‡½æ•°ï¼š</strong></p><ul><li><code>jsonb_array_elements(jsonb_array)</code>: å°† <code>jsonb</code> æ•°ç»„æ‰©å±•ä¸ºä¸€ç»„ <code>jsonb</code> å€¼ã€‚</li><li><code>jsonb_array_elements_text(jsonb_array)</code>: å°† <code>jsonb</code> æ•°ç»„æ‰©å±•ä¸ºä¸€ç»„ <code>text</code> å€¼ã€‚</li><li><code>jsonb_array_length(jsonb_array)</code>: è¿”å› <code>jsonb</code> æ•°ç»„çš„é•¿åº¦ã€‚</li><li><code>jsonb_each(jsonb_object)</code>: å°† <code>jsonb</code> å¯¹è±¡æ‰©å±•ä¸ºä¸€ç»„é”®/å€¼å¯¹ï¼ˆ<code>key text</code>, <code>value jsonb</code>ï¼‰ã€‚</li><li><code>jsonb_each_text(jsonb_object)</code>: å°† <code>jsonb</code> å¯¹è±¡æ‰©å±•ä¸ºä¸€ç»„é”®/å€¼å¯¹ï¼ˆ<code>key text</code>, <code>value text</code>ï¼‰ã€‚</li><li><code>jsonb_object_keys(jsonb_object)</code>: è¿”å› <code>jsonb</code> å¯¹è±¡çš„æ‰€æœ‰é”®çš„é›†åˆï¼ˆä½œä¸º <code>text</code>ï¼‰ã€‚</li><li><code>jsonb_extract_path(from_json jsonb, VARIADIC path_elems text[])</code>: æŒ‰è·¯å¾„æå– <code>jsonb</code> å­å¯¹è±¡ã€‚ç­‰æ•ˆäº <code>#&gt;</code> æ“ä½œç¬¦ã€‚</li><li><code>jsonb_extract_path_text(from_json jsonb, VARIADIC path_elems text[])</code>: æŒ‰è·¯å¾„æå– <code>jsonb</code> å­å¯¹è±¡çš„å€¼ï¼ˆä½œä¸º <code>text</code>ï¼‰ã€‚ç­‰æ•ˆäº <code>#&gt;&gt;</code> æ“ä½œç¬¦ã€‚</li><li><code>jsonb_pretty(jsonb)</code>: å°† <code>jsonb</code> å€¼æ ¼å¼åŒ–ä¸ºæ˜“è¯»çš„å¸¦ç¼©è¿›çš„æ–‡æœ¬ã€‚</li><li><code>jsonb_typeof(jsonb)</code>: è¿”å›é¡¶å±‚ <code>jsonb</code> å€¼çš„ç±»å‹ (<code>object</code>, <code>array</code>, <code>string</code>, <code>number</code>, <code>boolean</code>, <code>null</code>)ã€‚</li><li><code>jsonb_strip_nulls(from_json jsonb)</code>: ä» <code>jsonb</code> å¯¹è±¡ä¸­åˆ é™¤æ‰€æœ‰å…·æœ‰ null å€¼çš„é”®/å€¼å¯¹ã€‚</li><li><code>jsonb_set(target jsonb, path text[], new_value jsonb [, create_missing boolean])</code>: åœ¨æŒ‡å®šè·¯å¾„è®¾ç½®æ–°çš„ <code>jsonb</code> å€¼ã€‚å¦‚æœ <code>create_missing</code> ä¸º <code>true</code> (é»˜è®¤)ï¼Œåˆ™è·¯å¾„ä¸å­˜åœ¨æ—¶ä¼šåˆ›å»ºã€‚</li><li><code>jsonb_insert(target jsonb, path text[], new_value jsonb [, insert_after boolean])</code>: åœ¨æŒ‡å®šè·¯å¾„æ’å…¥æ–°çš„ <code>jsonb</code> å€¼ï¼ˆç”¨äºæ•°ç»„æˆ–åœ¨å¯¹è±¡ä¸­æ’å…¥æ–°é”®ï¼‰ã€‚</li><li><code>jsonb_path_exists(target jsonb, path jsonpath [, vars jsonb, silent boolean])</code>: æ£€æŸ¥ JSON è·¯å¾„æ˜¯å¦åœ¨ <code>jsonb</code> å€¼ä¸­è¿”å›ä»»ä½•é¡¹ã€‚</li><li><code>jsonb_path_match(target jsonb, path jsonpath [, vars jsonb, silent boolean])</code>: æ£€æŸ¥ JSON è·¯å¾„æ˜¯å¦åœ¨ <code>jsonb</code> å€¼ä¸­è¿”å›åŒ¹é…é¡¹ã€‚</li><li><code>jsonb_path_query(target jsonb, path jsonpath [, vars jsonb, silent boolean])</code>: æ‰§è¡Œ JSON è·¯å¾„æŸ¥è¯¢å¹¶è¿”å›æ‰€æœ‰åŒ¹é…çš„ <code>jsonb</code> é¡¹ã€‚</li><li><code>jsonb_path_query_array(target jsonb, path jsonpath [, vars jsonb, silent boolean])</code>: æ‰§è¡Œ JSON è·¯å¾„æŸ¥è¯¢å¹¶å°†æ‰€æœ‰åŒ¹é…çš„ <code>jsonb</code> é¡¹ä½œä¸ºæ•°ç»„è¿”å›ã€‚</li><li><code>jsonb_path_query_first(target jsonb, path jsonpath [, vars jsonb, silent boolean])</code>: æ‰§è¡Œ JSON è·¯å¾„æŸ¥è¯¢å¹¶è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„ <code>jsonb</code> é¡¹ã€‚</li></ul></li></ul><p><strong>4. JSON ç´¢å¼•ï¼š</strong></p><p>å¦‚å‰æ‰€è¿°ï¼Œ<code>jsonb</code> ç±»å‹æ”¯æŒç´¢å¼•ï¼Œè¿™å¯¹äºæŸ¥è¯¢æ€§èƒ½è‡³å…³é‡è¦ã€‚</p><ul><li><p><strong>GIN ç´¢å¼• (<code>jsonb_ops</code> - é»˜è®¤)</strong>ï¼š</p><ul><li>ä¸º <code>jsonb</code> åˆ—ä¸­çš„æ¯ä¸ªé”®å’Œå€¼åˆ›å»ºç´¢å¼•æ¡ç›®ã€‚</li><li>æ”¯æŒ <code>@&gt;</code> (åŒ…å«), <code>?</code> (é”®æ˜¯å¦å­˜åœ¨), <code>?|</code> (ä»»ä¸€é”®æ˜¯å¦å­˜åœ¨), <code>?&amp;</code> (æ‰€æœ‰é”®æ˜¯å¦å­˜åœ¨) ç­‰æ“ä½œç¬¦ã€‚</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> idx_products_attributes_gin</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> GIN (attributes);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯ä»¥åŠ é€Ÿè¿™ç±»æŸ¥è¯¢:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- SELECT * FROM products WHERE attributes @&gt; &#39;{&quot;brand&quot;: &quot;AwesomeBrand&quot;}&#39;;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- SELECT * FROM products WHERE attributes ? &#39;color&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>GIN ç´¢å¼• (<code>jsonb_path_ops</code>)</strong>:</p><ul><li><code>jsonb_path_ops</code> GIN æ“ä½œç¬¦ç±»åªç´¢å¼•è·¯å¾„å“ˆå¸Œå’Œå€¼ï¼Œè€Œä¸æ˜¯æ¯ä¸ªé”®å’Œå€¼ã€‚è¿™ä½¿å¾—ç´¢å¼•æ›´å°ï¼Œå¹¶ä¸”å¯¹äº <code>@&gt;</code> (åŒ…å«) æŸ¥è¯¢é€šå¸¸æ›´å¿«ï¼Œä½†å®ƒä¸æ”¯æŒ <code>?</code>, <code>?|</code>, <code>?&amp;</code> æ“ä½œç¬¦ã€‚</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> idx_products_attributes_gin_path_ops</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> GIN (attributes jsonb_path_ops);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä¸»è¦ç”¨äºåŠ é€Ÿ `@&gt;` æŸ¥è¯¢</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è¡¨è¾¾å¼ç´¢å¼•</strong>ï¼š<br> å¯ä»¥å¯¹ä» JSONB åˆ—ä¸­æå–çš„ç‰¹å®šå€¼åˆ›å»º B-Tree ç´¢å¼•ï¼Œå¦‚æœç»å¸¸å¯¹è¿™äº›ç‰¹å®šå€¼è¿›è¡Œç²¾ç¡®åŒ¹é…æˆ–èŒƒå›´æŸ¥è¯¢ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> idx_products_brand</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products ((attributes-</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;brand&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯ä»¥åŠ é€Ÿè¿™ç±»æŸ¥è¯¢:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- SELECT * FROM products WHERE attributes-&gt;&gt;&#39;brand&#39; = &#39;AwesomeBrand&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> idx_products_ram_gb</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> products (((attributes-</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;ram_gb&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)::</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">integer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯ä»¥åŠ é€Ÿè¿™ç±»æŸ¥è¯¢:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- SELECT * FROM products WHERE (attributes-&gt;&gt;&#39;ram_gb&#39;)::integer &gt; 8;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>PostgreSQL å¼ºå¤§çš„ JSON åŠŸèƒ½ä½¿å…¶æˆä¸ºéœ€è¦å¤„ç†åŠç»“æ„åŒ–æ•°æ®çš„åº”ç”¨çš„ç†æƒ³é€‰æ‹©ï¼Œä¾‹å¦‚å­˜å‚¨æ–‡æ¡£ã€é…ç½®ä¿¡æ¯ã€æ—¥å¿—æ•°æ®ç­‰ã€‚<code>jsonb</code> ç±»å‹åŠå…¶ä¸°å¯Œçš„æ“ä½œç¬¦ã€å‡½æ•°å’Œç´¢å¼•é€‰é¡¹æä¾›äº†æå¤§çš„çµæ´»æ€§å’Œæ€§èƒ½ã€‚</p><hr><h2 id="æ‰©å±•-extensions" tabindex="-1"><a class="header-anchor" href="#æ‰©å±•-extensions"><span>æ‰©å±• (Extensions)</span></a></h2><p>PostgreSQL çš„ä¸€ä¸ªå¼ºå¤§ç‰¹æ€§æ˜¯å…¶é«˜åº¦çš„å¯æ‰©å±•æ€§ã€‚<strong>æ‰©å±• (Extensions)</strong> æ˜¯ä¸€ç§æ‰“åŒ…æœºåˆ¶ï¼Œå…è®¸å°†ä¸€ç»„ç›¸å…³çš„ SQL å¯¹è±¡ï¼ˆå¦‚è‡ªå®šä¹‰æ•°æ®ç±»å‹ã€å‡½æ•°ã€æ“ä½œç¬¦ã€ç´¢å¼•æ–¹æ³•ã€è¿‡ç¨‹è¯­è¨€ç­‰ï¼‰æ†ç»‘åœ¨ä¸€èµ·ï¼Œå¹¶é€šè¿‡ç®€å•çš„ <code>CREATE EXTENSION</code> å‘½ä»¤åŠ è½½åˆ°æ•°æ®åº“ä¸­ã€‚</p><p><strong>æ‰©å±•çš„åŸç†å’Œç®¡ç†ï¼š</strong></p><ol><li><p><strong>æ‰“åŒ… SQL å¯¹è±¡</strong>ï¼šæ‰©å±•é€šå¸¸åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª SQL è„šæœ¬æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶å®šä¹‰äº†æ‰©å±•æä¾›çš„å¯¹è±¡ã€‚è¿˜å¯èƒ½åŒ…æ‹¬å…±äº«åº“æ–‡ä»¶ï¼ˆç”¨ C æˆ–å…¶ä»–è¯­è¨€ç¼–å†™çš„ç¼–è¯‘ä»£ç ï¼‰ã€é…ç½®æ–‡ä»¶ç­‰ã€‚</p></li><li><p><strong>æ§åˆ¶æ–‡ä»¶ (<code>.control</code>)</strong>ï¼šæ¯ä¸ªæ‰©å±•éƒ½æœ‰ä¸€ä¸ªæ§åˆ¶æ–‡ä»¶ï¼ˆä¾‹å¦‚ <code>myextension.control</code>ï¼‰ï¼Œå…¶ä¸­åŒ…å«å…³äºæ‰©å±•çš„å…ƒæ•°æ®ï¼Œå¦‚ç‰ˆæœ¬å·ã€ä¾èµ–å…³ç³»ã€æ¨¡å—è·¯å¾„åç­‰ã€‚</p></li><li><p><strong>å®‰è£…</strong>ï¼šæ‰©å±•çš„æ–‡ä»¶ï¼ˆSQL è„šæœ¬ã€å…±äº«åº“ã€æ§åˆ¶æ–‡ä»¶ï¼‰éœ€è¦è¢«æ”¾ç½®åœ¨ PostgreSQL å®‰è£…çš„ç‰¹å®šç›®å½•ä¸­ï¼ˆé€šå¸¸æ˜¯å…±äº«ç›®å½•ä¸‹çš„ <code>extension</code> å­ç›®å½•å’Œåº“ç›®å½•ï¼‰ã€‚</p></li><li><p><strong>åŠ è½½åˆ°æ•°æ®åº“ (<code>CREATE EXTENSION</code>)</strong>:</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> EXTENSION </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[IF NOT EXISTS]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> extension_name</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    [WITH [SCHEMA schema_name]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">          [VERSION version]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">          [FROM old_version]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">          [CASCADE]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>extension_name</code>: è¦åŠ è½½çš„æ‰©å±•çš„åç§°ã€‚</li><li><code>SCHEMA schema_name</code>: æŒ‡å®šå°†æ‰©å±•çš„å¯¹è±¡å®‰è£…åˆ°å“ªä¸ªæ¨¡å¼ä¸­ã€‚å¦‚æœæ‰©å±•å…è®¸ï¼Œè¿™æœ‰åŠ©äºå°†æ‰©å±•çš„å¯¹è±¡ä¸å…¶ä»–æ•°æ®åº“å¯¹è±¡éš”ç¦»å¼€ã€‚å¦‚æœçœç•¥ï¼Œé€šå¸¸ä¼šä½¿ç”¨é»˜è®¤æ¨¡å¼ï¼ˆå¦‚ <code>public</code>ï¼‰æˆ–æ‰©å±•æŒ‡å®šçš„æ¨¡å¼ã€‚</li><li><code>VERSION version</code>: æŒ‡å®šè¦å®‰è£…çš„æ‰©å±•ç‰ˆæœ¬ã€‚</li><li><code>CASCADE</code>: è‡ªåŠ¨å®‰è£…æ­¤æ‰©å±•æ‰€ä¾èµ–çš„ä»»ä½•å°šæœªå®‰è£…çš„æ‰©å±•ã€‚<br> PostgreSQL ä¼šæ‰§è¡Œæ‰©å±•çš„å®‰è£…è„šæœ¬ï¼Œåœ¨æ•°æ®åº“ä¸­åˆ›å»ºæ‰€éœ€çš„ SQL å¯¹è±¡ã€‚</li></ul></li><li><p><strong>åˆ—å‡ºå¯ç”¨çš„æ‰©å±•</strong>:<br> å¯ä»¥æŸ¥è¯¢ <code>pg_available_extensions</code> è§†å›¾ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> pg_available_extensions;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æˆ–è€…åœ¨ <code>psql</code> ä¸­ä½¿ç”¨ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\dx+ * </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨æ‰©å±•çš„è¯¦ç»†ä¿¡æ¯</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>åˆ—å‡ºå·²å®‰è£…çš„æ‰©å±•</strong>:<br> å¯ä»¥æŸ¥è¯¢ <code>pg_extension</code> ç³»ç»Ÿç›®å½•ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> extname, extversion </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> pg_extension;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æˆ–è€…åœ¨ <code>psql</code> ä¸­ä½¿ç”¨ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\dx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>æ›´æ–°æ‰©å±• (<code>ALTER EXTENSION</code>)</strong>:</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> EXTENSION extension_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">UPDATE</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [TO new_version]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¼šå°†å·²å®‰è£…çš„æ‰©å±•æ›´æ–°åˆ°å…¶å¯ç”¨çš„æœ€æ–°ç‰ˆæœ¬æˆ–æŒ‡å®šçš„ <code>new_version</code>ã€‚PostgreSQL ä¼šæ‰§è¡Œç›¸åº”çš„æ›´æ–°è„šæœ¬ã€‚<br> è¿˜å¯ä»¥ç”¨ <code>ALTER EXTENSION extension_name SET SCHEMA new_schema;</code> æ¥ç§»åŠ¨æ‰©å±•åˆ°æ–°çš„æ¨¡å¼ï¼ˆå¦‚æœæ‰©å±•æ”¯æŒï¼‰ã€‚</p></li><li><p><strong>åˆ é™¤æ‰©å±• (<code>DROP EXTENSION</code>)</strong>:</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> EXTENSION </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[IF EXISTS]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> extension_name </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[, ...]</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [CASCADE | RESTRICT]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>CASCADE</code>: è‡ªåŠ¨åˆ é™¤ä¾èµ–äºæ­¤æ‰©å±•çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬å…¶ä»–æ‰©å±•ï¼‰ã€‚</li><li><code>RESTRICT</code> (é»˜è®¤): å¦‚æœæœ‰ä»»ä½•å¯¹è±¡ä¾èµ–äºæ­¤æ‰©å±•ï¼Œåˆ™æ‹’ç»åˆ é™¤ã€‚<br> è¿™å°†ä»æ•°æ®åº“ä¸­ç§»é™¤æ‰©å±•åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡ã€‚</li></ul></li></ol><p>è®¸å¤šæœ‰ç”¨çš„åŠŸèƒ½éƒ½æ˜¯é€šè¿‡æ‰©å±•æä¾›çš„ï¼Œè¿™ä½¿å¾— PostgreSQL æ ¸å¿ƒä¿æŒç›¸å¯¹ç²¾ç®€ï¼ŒåŒæ—¶å…è®¸ç”¨æˆ·æ ¹æ®éœ€è¦æ·»åŠ ç‰¹å®šåŠŸèƒ½ã€‚</p><h3 id="pgvector" tabindex="-1"><a class="header-anchor" href="#pgvector"><span>PGVector</span></a></h3><p><code>pgvector</code> æ˜¯ä¸€ä¸ª PostgreSQL æ‰©å±•ï¼Œç”¨äºå­˜å‚¨å’Œæœç´¢<strong>å‘é‡åµŒå…¥ (vector embeddings)</strong>ã€‚å‘é‡åµŒå…¥æ˜¯å°†æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘æˆ–å…¶ä»–æ•°æ®ç±»å‹è¡¨ç¤ºä¸ºé«˜ç»´ç©ºé—´ä¸­çš„æ•°å­—å‘é‡çš„æ–¹æ³•ï¼Œå¸¸ç”¨äºæœºå™¨å­¦ä¹ åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯ç›¸ä¼¼æ€§æœç´¢ã€æ¨èç³»ç»Ÿã€è¯­ä¹‰æœç´¢ç­‰ã€‚</p><div class="hint-container info"><p class="hint-container-title">æ ¸å¿ƒåŠŸèƒ½</p><ul><li><strong><code>vector</code> æ•°æ®ç±»å‹</strong>ï¼šæä¾›ä¸€ç§æ–°çš„æ•°æ®ç±»å‹æ¥å­˜å‚¨å‘é‡ã€‚</li><li><strong>ç›¸ä¼¼æ€§åº¦é‡</strong>ï¼šæ”¯æŒå¤šç§è®¡ç®—å‘é‡ä¹‹é—´ç›¸ä¼¼åº¦ï¼ˆæˆ–è·ç¦»ï¼‰çš„æ–¹æ³•ï¼š <ul><li><strong>L2 è·ç¦» (æ¬§æ°è·ç¦»)</strong>ï¼š<code>&lt;-&gt;</code> æ“ä½œç¬¦</li><li><strong>å†…ç§¯ (Inner Product)</strong>ï¼š<code>&lt;#&gt;</code> æ“ä½œç¬¦</li><li><strong>ä½™å¼¦ç›¸ä¼¼åº¦ (Cosine Similarity)</strong> / <strong>ä½™å¼¦è·ç¦» (Cosine Distance)</strong>ï¼š<code>&lt;=&gt;</code> æ“ä½œç¬¦</li></ul></li><li><strong>ç´¢å¼•æ”¯æŒ</strong>ï¼šä¸ºäº†åŠ é€Ÿç›¸ä¼¼æ€§æœç´¢ï¼Œ<code>pgvector</code> æ”¯æŒä½¿ç”¨ <code>ivfflat</code> å’Œ <code>hnsw</code> ç´¢å¼•æ–¹æ³•åˆ›å»ºè¿‘ä¼¼æœ€è¿‘é‚» (ANN) ç´¢å¼•ã€‚ <ul><li><strong>IVFFlat (Inverted File with Flat lists)</strong>ï¼šä¸€ç§åŸºäºèšç±»çš„ç´¢å¼•æ–¹æ³•ã€‚åœ¨æ„å»ºæ—¶ï¼Œå‘é‡è¢«åˆ†é…åˆ°æœ€è¿‘çš„ç°‡ä¸­å¿ƒï¼ŒæŸ¥è¯¢æ—¶åªæœç´¢æŸ¥è¯¢å‘é‡æ‰€åœ¨ç°‡ï¼ˆæˆ–é™„è¿‘ç°‡ï¼‰å†…çš„å‘é‡ã€‚ <ul><li>å‚æ•°ï¼š<code>lists</code> (ç°‡çš„æ•°é‡)ã€‚</li></ul></li><li><strong>HNSW (Hierarchical Navigable Small World graphs)</strong>ï¼šä¸€ç§åŸºäºå›¾çš„ç´¢å¼•æ–¹æ³•ï¼Œé€šè¿‡æ„å»ºå±‚æ¬¡åŒ–çš„å›¾ç»“æ„æ¥å®ç°é«˜æ•ˆçš„è¿‘é‚»æœç´¢ã€‚ <ul><li>å‚æ•°ï¼š<code>m</code> (æ¯ä¸ªèŠ‚ç‚¹çš„æœ€å¤§è¿æ¥æ•°), <code>ef_construction</code> (æ„å»ºæ—¶åŠ¨æ€å€™é€‰åˆ—è¡¨çš„å¤§å°)ã€‚æŸ¥è¯¢æ—¶ä¹Ÿæœ‰ <code>ef_search</code> å‚æ•°ã€‚</li></ul></li></ul></li></ul></div><p><strong>å®‰è£…ä¸å¯ç”¨ï¼š</strong></p><p><a href="https://github.com/pgvector/pgvector?tab=readme-ov-file#installation" target="_blank" rel="noopener noreferrer">GitHub ä»“åº“</a> çš„æ–‡æ¡£æä¾›äº†å„ç§å®‰è£…å’Œå¯ç”¨æ–¹æ³•ï¼Œè¿™é‡Œä»¥ Docker çš„æ–¹å¼ä¸ºä¾‹ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postgres16</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --restart=always</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 5432:5432</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  -v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /docker_data/postgre/pg16/data:/var/lib/postgresql/data</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> POSTGRES_PASSWORD=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">123456</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  pgvector/pgvector:pg16</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>pgvector/pgvector</code>è¿™ä¸ªé•œåƒæ˜¯ä»¥ postgres é•œåƒä¸ºåŸºç¡€æ„å»ºçš„ï¼Œæ‰€ä»¥ä½¿ç”¨æ–¹å¼ä¸ postgres é•œåƒä¸€è‡´</p><p>è¿æ¥æ•°æ®åº“åä½¿ç”¨ä¸‹åˆ—å‘½ä»¤éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> pg_available_extensions </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;vector&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong> å‚ç…§ <a href="https://github.com/pgvector/pgvector?tab=readme-ov-file#getting-started" target="_blank" rel="noopener noreferrer">getting-started</a></p><p>ä½¿ç”¨ vector, éœ€è¦å…ˆåœ¨ database ä¸­æ‰§è¡Œï¼š<code>CREATE EXTENSION vector;</code>, ä¾‹å¦‚ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">create</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> database</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> vector_demo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">create</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> extension </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> not</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> exists</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> vector;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"># æ£€æŸ¥æ˜¯å¦åˆ›å»ºæˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> extname, extversion </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> pg_extension;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>åˆ›å»ºç´¢å¼•</strong>ï¼š<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> items </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ivfflat (embedding vector_l2_ops) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WITH</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (lists </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><ol><li><p><strong>åˆ›å»ºå¸¦æœ‰ <code>vector</code> åˆ—çš„è¡¨</strong>ï¼š<br> å‘é‡åˆ—éœ€è¦æŒ‡å®šç»´åº¦ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> items</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SERIAL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> PRIMARY KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    embedding VECTOR(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å‡è®¾æ˜¯3ç»´å‘é‡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æ’å…¥å‘é‡æ•°æ®</strong>ï¼š<br> å‘é‡ä»¥æ–‡æœ¬å½¢å¼ <code>[x1, x2, ..., xn]</code> æ’å…¥ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> items (embedding) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;[1,2,3]&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;[4,5,6]&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;[1.5,2.5,3.5]&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æ‰§è¡Œç›¸ä¼¼æ€§æœç´¢</strong>ï¼š</p><ul><li><strong>L2 è·ç¦» (è¶Šå°è¶Šç›¸ä¼¼)</strong>ï¼š<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id, embedding, embedding </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;[1,1,1]&#39;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> distance</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> items</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ORDER BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> distance</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">LIMIT</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>å†…ç§¯ (è¶Šå¤§è¶Šç›¸ä¼¼ï¼Œå¦‚æœå‘é‡å·²å½’ä¸€åŒ–)</strong>ï¼š<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¹äºå·²å½’ä¸€åŒ–çš„å‘é‡ï¼Œå†…ç§¯è¶Šå¤§ï¼Œä½™å¼¦ç›¸ä¼¼åº¦è¶Šé«˜ï¼ŒL2è·ç¦»è¶Šå°</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æ“ä½œç¬¦ `&lt;#&gt;` è¿”å›çš„æ˜¯è´Ÿå†…ç§¯ï¼Œæ‰€ä»¥ä»ç„¶æ˜¯è¶Šå°è¶Šç›¸ä¼¼</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id, embedding, embedding </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">#</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;[1,1,1]&#39;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> neg_inner_product</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> items</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ORDER BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> neg_inner_product</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">LIMIT</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>ä½™å¼¦è·ç¦» (è¶Šå°è¶Šç›¸ä¼¼ï¼Œ0 è¡¨ç¤ºå®Œå…¨ç›¸åŒï¼Œ1 è¡¨ç¤ºæ­£äº¤ï¼Œ2 è¡¨ç¤ºå®Œå…¨ç›¸å)</strong>ï¼š<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id, embedding, embedding </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;=&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;[1,1,1]&#39;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> cosine_distance</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> items</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ORDER BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> cosine_distance</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">LIMIT</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>ä½™å¼¦ç›¸ä¼¼åº¦ = <code>1 - ä½™å¼¦è·ç¦»</code>ã€‚</li></ul></li><li><p><strong>åˆ›å»ºç´¢å¼•ä»¥åŠ é€Ÿæœç´¢</strong>ï¼š</p><ul><li><p><strong>IVFFlat ç´¢å¼•</strong>ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> items </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ivfflat (embedding vector_l2_ops) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WITH</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (lists </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¹äºå†…ç§¯ä½¿ç”¨ vector_ip_ops</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¹äºä½™å¼¦ç›¸ä¼¼åº¦ä½¿ç”¨ vector_cosine_ops</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æŸ¥è¯¢å‰ï¼Œè®¾ç½® <code>ivfflat.probes</code> å‚æ•°ï¼ˆé»˜è®¤ä¸º1ï¼‰ï¼ŒæŒ‡å®šæŸ¥è¯¢æ—¶è¦æ£€æŸ¥çš„ç°‡çš„æ•°é‡ã€‚å€¼è¶Šå¤§ï¼Œå¬å›ç‡è¶Šé«˜ï¼Œä½†é€Ÿåº¦è¶Šæ…¢ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ivfflat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">probes</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ... </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æ‰§è¡Œä½ çš„æŸ¥è¯¢</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>HNSW ç´¢å¼•</strong> (é€šå¸¸æ¨èï¼Œé€šå¸¸æœ‰æ›´å¥½çš„æ€§èƒ½/å¬å›ç‡æƒè¡¡)ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> items </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> hnsw (embedding vector_l2_ops) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WITH</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (m </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 16</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, ef_construction </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¹äºå†…ç§¯ä½¿ç”¨ vector_ip_ops</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¹äºä½™å¼¦ç›¸ä¼¼åº¦ä½¿ç”¨ vector_cosine_ops</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æŸ¥è¯¢å‰ï¼Œè®¾ç½® <code>hnsw.ef_search</code> å‚æ•°ï¼ˆé»˜è®¤ä¸º <code>ef_construction</code> çš„å€¼ï¼‰ï¼ŒæŒ‡å®šæœç´¢æ—¶åŠ¨æ€å€™é€‰åˆ—è¡¨çš„å¤§å°ã€‚å€¼è¶Šå¤§ï¼Œå¬å›ç‡è¶Šé«˜ï¼Œä½†é€Ÿåº¦è¶Šæ…¢ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> hnsw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">ef_search</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ... </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æ‰§è¡Œä½ çš„æŸ¥è¯¢</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ol><p><strong>åº”ç”¨åœºæ™¯ï¼š</strong></p><ul><li><strong>è¯­ä¹‰æœç´¢</strong>ï¼šæŸ¥æ‰¾ä¸æŸ¥è¯¢æ–‡æœ¬è¯­ä¹‰ç›¸ä¼¼çš„æ–‡æ¡£æˆ–æ®µè½ã€‚</li><li><strong>å›¾åƒæ£€ç´¢</strong>ï¼šæŸ¥æ‰¾ä¸æŸ¥è¯¢å›¾åƒå†…å®¹ç›¸ä¼¼çš„å›¾ç‰‡ã€‚</li><li><strong>æ¨èç³»ç»Ÿ</strong>ï¼šæ ¹æ®ç”¨æˆ·æˆ–ç‰©å“çš„åµŒå…¥å‘é‡æ¨èç›¸ä¼¼çš„ç‰©å“æˆ–å†…å®¹ã€‚</li><li><strong>å¼‚å¸¸æ£€æµ‹</strong>ï¼šè¯†åˆ«ä¸æ­£å¸¸æ•°æ®ç‚¹å‘é‡å·®å¼‚è¾ƒå¤§çš„ç¦»ç¾¤ç‚¹ã€‚</li><li><strong>é—®ç­”ç³»ç»Ÿ/RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰</strong>ï¼šä¸å¤§å‹è¯­è¨€æ¨¡å‹ (LLM) ç»“åˆï¼Œé€šè¿‡ä»å‘é‡æ•°æ®åº“ä¸­æ£€ç´¢ç›¸å…³ä¸Šä¸‹æ–‡æ¥å¢å¼º LLM çš„å›ç­”ã€‚</li></ul><p><code>pgvector</code> çš„å‡ºç°æå¤§åœ°ç®€åŒ–äº†åœ¨ PostgreSQL ä¸­æ„å»ºå’Œéƒ¨ç½²åŸºäºå‘é‡åµŒå…¥çš„åº”ç”¨ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥åœ¨ç†Ÿæ‚‰çš„ SQL ç¯å¢ƒä¸­åˆ©ç”¨å‘é‡æœç´¢çš„å¼ºå¤§åŠŸèƒ½ã€‚</p><h3 id="postgis" tabindex="-1"><a class="header-anchor" href="#postgis"><span>PostGIS</span></a></h3><p>PostGIS æ˜¯ PostgreSQL çš„ä¸€ä¸ªè‘—åæ‰©å±•ï¼Œå®ƒä¸ºæ•°æ®åº“æ·»åŠ äº†å¯¹<strong>åœ°ç†å¯¹è±¡ (geographic objects)</strong> çš„æ”¯æŒï¼Œå…è®¸å­˜å‚¨ã€ç´¢å¼•å’ŒæŸ¥è¯¢ç©ºé—´æ•°æ®ã€‚PostGIS æ˜¯ä¸€ä¸ªåŠŸèƒ½éå¸¸å…¨é¢çš„åœ°ç†ä¿¡æ¯ç³»ç»Ÿ (GIS)ï¼Œéµå¾ª Open Geospatial Consortium (OGC) çš„ SQL è§„èŒƒã€‚</p><p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong></p><ul><li><p><strong>ç©ºé—´æ•°æ®ç±»å‹</strong>ï¼šå®šä¹‰äº†ä¸€ç³»åˆ—ç”¨äºè¡¨ç¤ºåœ°ç†è¦ç´ çš„ OGC æ ‡å‡†æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚ï¼š</p><ul><li><code>GEOMETRY</code>: é€šç”¨å‡ ä½•ç±»å‹ï¼Œå¯ä»¥æ˜¯ä»¥ä¸‹ä»»ä½•ä¸€ç§ã€‚</li><li><code>POINT</code>: ç‚¹ (å¦‚ GPS åæ ‡)ã€‚</li><li><code>LINESTRING</code>: çº¿ (å¦‚é“è·¯ã€æ²³æµ)ã€‚</li><li><code>POLYGON</code>: å¤šè¾¹å½¢ (å¦‚å›½å®¶è¾¹ç•Œã€æ¹–æ³ŠåŒºåŸŸ)ã€‚</li><li><code>MULTIPOINT</code>, <code>MULTILINESTRING</code>, <code>MULTIPOLYGON</code>: å¤šä¸ªç‚¹ã€çº¿ã€å¤šè¾¹å½¢çš„é›†åˆã€‚</li><li><code>GEOMETRYCOLLECTION</code>: ä¸åŒç±»å‹å‡ ä½•å¯¹è±¡çš„é›†åˆã€‚</li><li>æ”¯æŒ 2Dã€3D (XYZ) å’Œ 4D (XYZM, M ä»£è¡¨åº¦é‡å€¼) å‡ ä½•ã€‚</li><li><code>GEOGRAPHY</code>: ä¸€ç§åŸºäºæ¤­çƒä½“ï¼ˆé€šå¸¸æ˜¯ WGS84ï¼‰è®¡ç®—çš„åœ°ç†åæ ‡ç±»å‹ï¼Œç”¨äºå¤„ç†å…¨çƒèŒƒå›´çš„ç»çº¬åº¦æ•°æ®ï¼Œè®¡ç®—ç»“æœæ›´ç²¾ç¡®ï¼ˆä¾‹å¦‚è·ç¦»å’Œé¢ç§¯ï¼‰ã€‚</li><li><code>RASTER</code>: ç”¨äºå­˜å‚¨å’Œåˆ†ææ …æ ¼æ•°æ®ï¼ˆå¦‚å«æ˜Ÿå½±åƒã€é«˜ç¨‹æ¨¡å‹ï¼‰ã€‚</li></ul></li><li><p><strong>ç©ºé—´å‡½æ•°</strong>ï¼šæä¾›äº†æ•°ç™¾ä¸ªç”¨äºåˆ†æå’Œå¤„ç†ç©ºé—´æ•°æ®çš„å‡½æ•°ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><strong>å‡ ä½•æ„é€ </strong>ï¼š<code>ST_MakePoint()</code>, <code>ST_MakeLine()</code>, <code>ST_MakePolygon()</code>, <code>ST_GeomFromText()</code>, <code>ST_GeomFromGeoJSON()</code>, <code>ST_Collect()</code>.</li><li><strong>å‡ ä½•å±æ€§</strong>ï¼š<code>ST_Area()</code>, <code>ST_Length()</code>, <code>ST_Perimeter()</code>, <code>ST_NumPoints()</code>, <code>ST_SRID()</code>, <code>ST_GeometryType()</code>, <code>ST_IsValid()</code>.</li><li><strong>ç©ºé—´å…³ç³» (æ‹“æ‰‘)</strong>ï¼š<code>ST_Intersects()</code> (ç›¸äº¤), <code>ST_Contains()</code> (åŒ…å«), <code>ST_Within()</code> (åœ¨å†…éƒ¨), <code>ST_Overlaps()</code> (é‡å ), <code>ST_Touches()</code> (æ¥è§¦), <code>ST_Crosses()</code> (ç›¸äº¤), <code>ST_Equals()</code> (ç›¸ç­‰).</li><li><strong>ç©ºé—´åˆ†æ</strong>ï¼š<code>ST_Distance()</code> (è·ç¦»), <code>ST_Buffer()</code> (ç¼“å†²åŒºåˆ†æ), <code>ST_Intersection()</code> (äº¤é›†), <code>ST_Union()</code> (å¹¶é›†), <code>ST_Difference()</code> (å·®é›†), <code>ST_Centroid()</code> (è´¨å¿ƒ), <code>ST_Transform()</code> (åæ ‡ç³»è½¬æ¢).</li><li><strong>æ …æ ¼å¤„ç†å‡½æ•°</strong>ã€‚</li></ul></li><li><p><strong>ç©ºé—´ç´¢å¼•</strong>ï¼šä½¿ç”¨ GiST (Generalized Search Tree) ç´¢å¼•æ¥é«˜æ•ˆåœ°æŸ¥è¯¢ç©ºé—´æ•°æ®ã€‚é€šå¸¸ä½¿ç”¨ R-Tree over GiST å®ç°ã€‚è¿™å¯¹äºåŸºäºä½ç½®çš„æŸ¥è¯¢ï¼ˆä¾‹å¦‚ï¼Œâ€œæŸ¥æ‰¾æŸä¸ªç‚¹é™„è¿‘çš„é¤é¦†â€ï¼‰è‡³å…³é‡è¦ã€‚</p></li><li><p><strong>åæ ‡ç³»å’ŒæŠ•å½±æ”¯æŒ</strong>ï¼šé€šè¿‡ <code>spatial_ref_sys</code> è¡¨å’Œ <code>ST_Transform()</code> å‡½æ•°æ”¯æŒå¤§é‡çš„ç©ºé—´å‚è€ƒç³»ç»Ÿ (SRS) å’Œåæ ‡è½¬æ¢ã€‚SRID (Spatial Reference System Identifier) ç”¨äºæ ‡è¯†æ¯ä¸ªå‡ ä½•å¯¹è±¡æ‰€ä½¿ç”¨çš„åæ ‡ç³»ã€‚</p></li></ul><p><strong>å®‰è£…ä¸å¯ç”¨ï¼š</strong></p><ol><li><p><strong>å®‰è£… PostGIS æ‰©å±•åº“</strong>ï¼š</p><ul><li>é€šå¸¸å¯ä»¥é€šè¿‡æ“ä½œç³»ç»Ÿçš„åŒ…ç®¡ç†å™¨å®‰è£… (ä¾‹å¦‚ <code>sudo apt install postgis postgresql-XX-postgis-Y</code>)ã€‚</li><li>è®¸å¤š PostgreSQL å‘è¡Œç‰ˆæˆ–äº‘æœåŠ¡å¯èƒ½å·²é¢„è£…æˆ–å…è®¸è½»æ¾å¯ç”¨ã€‚</li><li>PostGIS ç½‘ç«™ (<code>postgis.net</code>) æä¾›è¯¦ç»†çš„å®‰è£…æŒ‡å—ã€‚</li></ul></li><li><p><strong>åœ¨æ•°æ®åº“ä¸­å¯ç”¨æ‰©å±•</strong>ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯ç”¨å‡ ä½•/åœ°ç†ç±»å‹å’Œå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> EXTENSION postgis;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- (å¯é€‰) å¯ç”¨æ …æ ¼æ”¯æŒ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> EXTENSION postgis_raster;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- (å¯é€‰) å¯ç”¨æ‹“æ‰‘æ”¯æŒ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> EXTENSION postgis_topology;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- (å¯é€‰) å¯ç”¨ SFCGAL é«˜çº§3Då‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> EXTENSION postgis_sfcgal;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- (å¯é€‰) å¯ç”¨åœ°å€æ ‡å‡†åŒ–å™¨</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> EXTENSION address_standardizer;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> EXTENSION address_standardizer_data_us; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- (ç¤ºä¾‹ç¾å›½æ•°æ®)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- (å¯é€‰) å¯ç”¨ PostGIS Tiger Geocoder (ç¾å›½)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> EXTENSION postgis_tiger_geocoder;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šå¸¸ï¼Œ<code>CREATE EXTENSION postgis;</code> æ˜¯æœ€åŸºæœ¬å’Œæœ€å¸¸ç”¨çš„ã€‚</p></li><li><p><strong>éªŒè¯å®‰è£…</strong>ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> PostGIS_Full_Version();</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æˆ–è€…</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> postgis_version();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p><strong>ä½¿ç”¨æ–¹æ³•ç¤ºä¾‹ï¼š</strong></p><ol><li><p><strong>åˆ›å»ºå¸¦æœ‰ç©ºé—´åˆ—çš„è¡¨</strong>ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> locations</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SERIAL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> PRIMARY KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    name</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">255</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    geom </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">GEOMETRY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">Point</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4326</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å­˜å‚¨ç‚¹æ•°æ®ï¼ŒSRID 4326 (WGS 84 ç»çº¬åº¦)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> regions</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SERIAL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> PRIMARY KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    region_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    boundary </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">GEOMETRY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">Polygon</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3857</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å­˜å‚¨å¤šè¾¹å½¢ï¼ŒSRID 3857 (Web Mercator)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æ’å…¥ç©ºé—´æ•°æ®</strong>ï¼š<br> ä½¿ç”¨ Well-Known Text (WKT) æˆ– Well-Known Binary (WKB) æ ¼å¼ï¼Œé€šå¸¸é€šè¿‡ <code>ST_GeomFromText()</code> æˆ– <code>ST_SetSRID()</code> å‡½æ•°ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> locations (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, geom) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Central Park&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, ST_SetSRID(ST_MakePoint(-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">73</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">9654</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">40</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7829</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4326</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Eiffel Tower&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, ST_SetSRID(ST_MakePoint(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2945</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">48</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8584</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4326</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- WKT ç¤ºä¾‹</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> regions (region_name, boundary) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Sample Area&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, ST_GeomFromText(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;POLYGON((0 0, 0 10, 10 10, 10 0, 0 0))&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3857</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>åˆ›å»ºç©ºé—´ç´¢å¼•</strong>ï¼š<br> ä½¿ç”¨ <code>USING GIST</code>ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> idx_locations_geom</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> locations </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> GIST (geom);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> idx_regions_boundary</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> regions </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> GIST (boundary);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æ‰§è¡Œç©ºé—´æŸ¥è¯¢</strong>ï¼š</p><ul><li><strong>æŸ¥æ‰¾ç‰¹å®šç‚¹é™„è¿‘çš„è¦ç´  (è·ç¦»æŸ¥è¯¢)</strong>ï¼š<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, ST_Distance(</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    geom,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ST_SetSRID(ST_MakePoint(-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">73</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">985130</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">40</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">758896</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4326</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- Times Square</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> distance_meters </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¦‚æœ geom æ˜¯ geography ç±»å‹ï¼Œè·ç¦»å•ä½é€šå¸¸æ˜¯ç±³</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> locations</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ST_DWithin(</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    geom,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ST_SetSRID(ST_MakePoint(-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">73</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">985130</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">40</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">758896</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4326</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    1000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> -- æŸ¥æ‰¾ 1000 ä¸ªå•ä½ (å–å†³äºåæ ‡ç³»ï¼Œå¯¹äº4326åœ°ç†åæ ‡ï¼Œæ­¤å•ä½å¯èƒ½ä¸æ˜¯ç±³) å†…çš„åœ°ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">          -- å¯¹äº geography ç±»å‹ï¼Œ1000 å°±æ˜¯ 1000 ç±³</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ORDER BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> distance_meters;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æ›´ç²¾ç¡®çš„è·ç¦»æŸ¥è¯¢ä½¿ç”¨ geography ç±»å‹ï¼š</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- SELECT name, ST_Distance(geom::geography, &#39;SRID=4326;POINT(-73.985130 40.758896)&#39;::geography) AS distance_meters</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- FROM locations</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- WHERE ST_DWithin(geom::geography, &#39;SRID=4326;POINT(-73.985130 40.758896)&#39;::geography, 1000)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ORDER BY distance_meters;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>æŸ¥æ‰¾æŸä¸ªå¤šè¾¹å½¢å†…çš„ç‚¹</strong>ï¼š<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> l</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">name</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> locations l, regions r</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> r</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">region_name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;Sample Area&#39;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AND</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ST_Contains(ST_Transform(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">r</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">boundary</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4326</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">l</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">geom</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æ³¨æ„åæ ‡ç³»è½¬æ¢</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>è®¡ç®—é¢ç§¯</strong>ï¼š<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> region_name, ST_Area(boundary) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> regions; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- é¢ç§¯å•ä½å–å†³äºåæ ‡ç³»</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¹äº geography ç±»å‹ï¼Œé¢ç§¯å•ä½æ˜¯å¹³æ–¹ç±³</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- SELECT region_name, ST_Area(boundary::geography) FROM regions;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ol><p><strong>å…¸å‹åº”ç”¨åœºæ™¯ï¼š</strong></p><ul><li><strong>åœ°å›¾æœåŠ¡å’Œ Web GIS</strong>ï¼šä½œä¸ºåç«¯æ•°æ®å­˜å‚¨ï¼Œä¸ºåœ°å›¾åº”ç”¨æä¾›ç©ºé—´æ•°æ®ã€‚</li><li><strong>ä½ç½®æœåŠ¡ (LBS)</strong>ï¼šå¦‚â€œæŸ¥æ‰¾æˆ‘é™„è¿‘çš„ Xâ€ã€â€œèµ„äº§è¿½è¸ªâ€ã€‚</li><li><strong>åŸå¸‚è§„åˆ’å’Œèµ„æºç®¡ç†</strong>ã€‚</li><li><strong>ç¯å¢ƒç›‘æµ‹å’Œåˆ†æ</strong>ã€‚</li><li><strong>ç‰©æµå’Œè·¯çº¿è§„åˆ’</strong>ã€‚</li><li><strong>æˆ¿åœ°äº§åˆ†æ</strong>ã€‚</li></ul><p>PostGIS æ˜¯ PostgreSQL ç”Ÿæ€ç³»ç»Ÿä¸­æœ€å¼ºå¤§å’Œæœ€å¹¿æ³›ä½¿ç”¨çš„æ‰©å±•ä¹‹ä¸€ï¼Œä¸ºå¤„ç†åœ°ç†ç©ºé—´æ•°æ®æä¾›äº†æ— ä¸ä¼¦Ø³Ù‰çš„çµæ´»æ€§å’ŒåŠŸèƒ½ã€‚å®ƒå¯ä»¥ä¸è®¸å¤šæ¡Œé¢ GIS è½¯ä»¶ï¼ˆå¦‚ QGISã€ArcGISï¼‰å’Œ Web åœ°å›¾åº“ï¼ˆå¦‚ Leafletã€OpenLayersï¼‰æ— ç¼é›†æˆã€‚</p><h3 id="timescaledb" tabindex="-1"><a class="header-anchor" href="#timescaledb"><span>TimescaleDB</span></a></h3><p>TimescaleDB æ˜¯ä¸€ä¸ªå¼€æºçš„ PostgreSQL æ‰©å±•ï¼Œä¸“é—¨è®¾è®¡ç”¨äºå¤„ç†<strong>æ—¶é—´åºåˆ—æ•°æ® (time-series data)</strong>ã€‚å®ƒé€šè¿‡è‡ªåŠ¨åˆ†åŒºã€ä¼˜åŒ–çš„æŸ¥è¯¢ä»¥åŠé’ˆå¯¹æ—¶é—´åºåˆ—çš„ç‰¹å®šåŠŸèƒ½ï¼Œä½¿å¾— PostgreSQL èƒ½å¤Ÿé«˜æ•ˆåœ°å­˜å‚¨å’Œåˆ†æå¤§è§„æ¨¡çš„æ—¶é—´åºåˆ—å·¥ä½œè´Ÿè½½ã€‚</p><p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong></p><ol><li><p><strong>Hypertables (è¶…è¡¨)</strong>ï¼š</p><ul><li>Hypertables æ˜¯ TimescaleDB çš„æ ¸å¿ƒæŠ½è±¡ã€‚ä»ç”¨æˆ·è§’åº¦çœ‹ï¼Œå®ƒå°±åƒä¸€ä¸ªæ™®é€šçš„ SQL è¡¨ï¼Œä½†å®é™…ä¸Šå®ƒåœ¨åº•å±‚è¢«è‡ªåŠ¨åˆ†å‰²æˆè®¸å¤šå°çš„å­è¡¨ï¼ˆç§°ä¸º <strong>chunks</strong>ï¼‰ï¼Œé€šå¸¸æ˜¯æŒ‰æ—¶é—´èŒƒå›´å’Œå¯é€‰çš„ç©ºé—´ç»´åº¦ï¼ˆå¦‚è®¾å¤‡IDã€ä½ç½®ï¼‰è¿›è¡Œåˆ†åŒºã€‚</li><li>è¿™ç§è‡ªåŠ¨åˆ†åŒºå¯¹ç”¨æˆ·é€æ˜ï¼Œç”¨æˆ·ä»ç„¶å¯ä»¥é€šè¿‡ hypertable åç§°è¿›è¡ŒæŸ¥è¯¢å’Œæ’å…¥ã€‚</li><li>ä¼˜ç‚¹ï¼š <ul><li><strong>æé«˜æ’å…¥æ€§èƒ½</strong>ï¼šæ–°æ•°æ®é€šå¸¸å†™å…¥æœ€è¿‘çš„ chunkï¼Œå‡å°‘ç´¢å¼•å‹åŠ›ã€‚</li><li><strong>æé«˜æŸ¥è¯¢æ€§èƒ½</strong>ï¼šæŸ¥è¯¢é€šå¸¸åªæ¶‰åŠç›¸å…³çš„ chunks (æ—¶é—´è°“è¯ä¸‹æ¨)ï¼Œè€Œä¸æ˜¯æ‰«ææ•´ä¸ªå·¨å¤§çš„è¡¨ã€‚</li><li><strong>ç®€åŒ–æ•°æ®ç®¡ç†</strong>ï¼šå¯ä»¥è½»æ¾åœ°å¯¹æ—§çš„ chunks æ‰§è¡Œæ•°æ®ä¿ç•™ç­–ç•¥ï¼ˆå¦‚åˆ é™¤æˆ–å½’æ¡£ï¼‰ã€‚</li></ul></li></ul></li><li><p><strong>è‡ªåŠ¨åˆ†åŒº (Chunking)</strong>ï¼š</p><ul><li>Hypertables ä¸»è¦æŒ‰æ—¶é—´ç»´åº¦åˆ†åŒºã€‚æ¯ä¸ª chunk å¯¹åº”ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´é—´éš”ã€‚</li><li>è¿˜å¯ä»¥æ ¹æ®ä¸€ä¸ªæˆ–å¤šä¸ªç©ºé—´ç»´åº¦ï¼ˆå¦‚è®¾å¤‡IDã€æœåŠ¡å™¨IDã€ä½ç½®æ ‡ç­¾ç­‰ï¼‰è¿›ä¸€æ­¥å¯¹ chunk è¿›è¡Œåˆ†åŒºï¼Œä»¥æé«˜é’ˆå¯¹ç‰¹å®šè®¾å¤‡æˆ–æ ‡ç­¾çš„æŸ¥è¯¢æ€§èƒ½ã€‚</li></ul></li><li><p><strong>æ•°æ®ä¿ç•™ç­–ç•¥ (Data Retention Policies)</strong>ï¼š</p><ul><li>å¯ä»¥è½»æ¾è®¾ç½®ç­–ç•¥ï¼Œè‡ªåŠ¨åˆ é™¤æˆ–å½’æ¡£è¶…è¿‡ä¸€å®šæ—¶é—´çš„æ—§æ•°æ®ï¼ˆå³åˆ é™¤æ—§çš„ chunksï¼‰ã€‚</li><li><code>add_retention_policy(&#39;hypertable_name&#39;, INTERVAL &#39;7 days&#39;)</code></li></ul></li><li><p><strong>è¿ç»­èšåˆ (Continuous Aggregates)</strong>ï¼š</p><ul><li>å…è®¸ç”¨æˆ·åˆ›å»ºé¢„å…ˆè®¡ç®—çš„èšåˆè§†å›¾ï¼Œè¿™äº›è§†å›¾ä¼šè‡ªåŠ¨ã€å¢é‡åœ°æ›´æ–°ã€‚</li><li>ä¾‹å¦‚ï¼Œå¯ä»¥ä¸ºæ¯å°æ—¶çš„å¹³å‡æ¸©åº¦ã€æ¯æ—¥çš„äº¤æ˜“æ€»é¢ç­‰åˆ›å»ºè¿ç»­èšåˆã€‚</li><li>æŸ¥è¯¢è¿™äº›è¿ç»­èšåˆæ¯”å®æ—¶è®¡ç®—åŸå§‹æ•°æ®çš„èšåˆè¦å¿«å¾—å¤šã€‚</li><li><code>CREATE MATERIALIZED VIEW ... WITH (timescaledb.continuous) AS SELECT ... GROUP BY time_bucket(...) ...;</code></li><li>å¯ä»¥è®¾ç½®åˆ·æ–°ç­–ç•¥ï¼Œä½¿è¿ç»­èšåˆåœ¨åå°è‡ªåŠ¨æ›´æ–°ã€‚</li></ul></li><li><p><strong>æ•°æ®å‹ç¼© (Compression)</strong>ï¼š</p><ul><li>TimescaleDB æä¾›äº†åˆ—å¼å‹ç¼©åŠŸèƒ½ï¼Œå¯ä»¥æ˜¾è‘—å‡å°æ—§æ•°æ®çš„å­˜å‚¨ç©ºé—´ï¼ŒåŒæ—¶ä»ç„¶å…è®¸å¿«é€ŸæŸ¥è¯¢ã€‚</li><li>å‹ç¼©æ˜¯æŒ‰ chunk è¿›è¡Œçš„ï¼Œé€šå¸¸å¯¹ä¸å†é¢‘ç¹æ›´æ–°çš„æ—§æ•°æ®å—å¯ç”¨ã€‚</li><li><code>ALTER TABLE conditions SET (timescaledb.compress, timescaledb.compress_segmentby = &#39;device_id&#39;);</code></li><li><code>add_compression_policy(&#39;conditions&#39;, INTERVAL &#39;14 days&#39;);</code></li></ul></li><li><p><strong>æ—¶é—´åºåˆ—ä¸“ç”¨ SQL å‡½æ•°</strong>ï¼š</p><ul><li><code>time_bucket(bucket_width, time_column, [origin])</code>: å°†æ—¶é—´æˆ³èšåˆåˆ°å®šä¹‰çš„æ—¶é—´æ¡¶ä¸­ (ä¾‹å¦‚ï¼Œæ¯5åˆ†é’Ÿã€æ¯1å°æ—¶)ã€‚</li><li><code>first(value_column, time_column)</code>: åœ¨èšåˆç»„ä¸­æŒ‰æ—¶é—´æ’åºçš„ç¬¬ä¸€ä¸ªå€¼ã€‚</li><li><code>last(value_column, time_column)</code>: åœ¨èšåˆç»„ä¸­æŒ‰æ—¶é—´æ’åºçš„æœ€åä¸€ä¸ªå€¼ã€‚</li><li><code>histogram(value_column, min_value, max_value, num_bins)</code>: è®¡ç®—å€¼çš„ç›´æ–¹å›¾ã€‚</li><li>çª—å£å‡½æ•°å’Œé—´éš™å¡«å……å‡½æ•°ã€‚</li></ul></li><li><p><strong>PostgreSQL ç”Ÿæ€å…¼å®¹æ€§</strong>ï¼š</p><ul><li>ç”±äº TimescaleDB æ˜¯ PostgreSQL çš„æ‰©å±•ï¼Œå®ƒç»§æ‰¿äº† PostgreSQL çš„æ‰€æœ‰ç‰¹æ€§ï¼ŒåŒ…æ‹¬å¯é æ€§ã€SQL å…¼å®¹æ€§ã€ä¸°å¯Œçš„å·¥å…·å’Œè¿æ¥å™¨ç”Ÿæ€ç³»ç»Ÿã€‚</li></ul></li></ol><p><strong>å®‰è£…ä¸å¯ç”¨ï¼š</strong></p><ol><li><p><strong>å®‰è£… TimescaleDB æ‰©å±•åº“</strong>ï¼š</p><ul><li>TimescaleDB æä¾›äº†é€‚ç”¨äºå¤šç§æ“ä½œç³»ç»Ÿå’Œç¯å¢ƒçš„å®‰è£…åŒ…ï¼ˆå¦‚ .deb, .rpm, Docker é•œåƒ, Kubernetes Helm chartsï¼‰ã€‚</li><li>ä¹Ÿå¯ä»¥ä»æºç ç¼–è¯‘ã€‚</li><li>è®¸å¤šäº‘ PostgreSQL æœåŠ¡ä¹Ÿæ”¯æŒ TimescaleDBã€‚</li></ul></li><li><p><strong>é…ç½® PostgreSQL</strong>ï¼š</p><ul><li>éœ€è¦å°† <code>timescaledb</code> æ·»åŠ åˆ° <code>postgresql.conf</code> æ–‡ä»¶ä¸­çš„ <code>shared_preload_libraries</code> å‚æ•°ä¸­ï¼Œç„¶åé‡å¯ PostgreSQL æœåŠ¡å™¨ã€‚</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>shared_preload_libraries = &#39;timescaledb&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>åœ¨æ•°æ®åº“ä¸­å¯ç”¨æ‰©å±•</strong>ï¼š<br> è¿æ¥åˆ°ä½ çš„ PostgreSQL æ•°æ®åº“ï¼Œç„¶åæ‰§è¡Œï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> EXTENSION </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">IF</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> timescaledb;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>é€šå¸¸ä¼šæç¤ºè¿è¡Œ <code>timescaledb-tune</code> å·¥å…·æ¥ä¼˜åŒ– PostgreSQL é…ç½®å‚æ•°ã€‚</p></li></ol><p><strong>ä½¿ç”¨æ–¹æ³•ç¤ºä¾‹ï¼š</strong></p><ol><li><p><strong>åˆ›å»º Hypertable</strong>ï¼š<br> é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ™®é€šçš„ SQL è¡¨ï¼Œç„¶åå°†å…¶è½¬æ¢ä¸º hypertableã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. åˆ›å»ºæ™®é€šè¡¨</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> conditions</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    time</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TIMESTAMPTZ</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    device_id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TEXT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    temperature </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DOUBLE PRECISION</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    humidity </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DOUBLE PRECISION</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. å°†å…¶è½¬æ¢ä¸º hypertableï¼ŒæŒ‰ &#39;time&#39; åˆ—åˆ†åŒº</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> create_hypertable(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;conditions&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;time&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- (å¯é€‰) æŒ‰ &#39;device_id&#39; è¿›è¡Œç©ºé—´åˆ†åŒº (ä¾‹å¦‚ï¼Œ10ä¸ªåˆ†åŒº)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- SELECT create_hypertable(&#39;conditions&#39;, &#39;time&#39;, &#39;device_id&#39;, number_partitions =&gt; 10);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æ’å…¥æ•°æ®</strong>ï¼š<br> åƒæ“ä½œæ™®é€šè¡¨ä¸€æ ·æ’å…¥æ•°æ®ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> conditions (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, device_id, temperature, humidity) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NOW</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;device001&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">23</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">60</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NOW</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() - INTERVAL </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;1 minute&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;device002&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">24</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">59</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æŸ¥è¯¢æ•°æ®</strong>ï¼š<br> ä½¿ç”¨æ ‡å‡†çš„ SQL æŸ¥è¯¢ã€‚æ—¶é—´è°“è¯ä¼šè‡ªåŠ¨ä¸‹æ¨åˆ°ç›¸å…³çš„ chunksã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è·å–è¿‡å»ä¸€å°æ—¶å†… device001 çš„å¹³å‡æ¸©åº¦</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> AVG</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(temperature)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> conditions</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> device_id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;device001&#39;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AND</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOW</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() - INTERVAL </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;1 hour&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è·å–æ¯5åˆ†é’Ÿçš„å¹³å‡æ¸©åº¦å’Œæ¹¿åº¦</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    time_bucket(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;5 minutes&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> five_min_bucket,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    device_id,</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    AVG</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(temperature) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> avg_temp,</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    AVG</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(humidity) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> avg_humidity</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> conditions</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">GROUP BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> five_min_bucket, device_id</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ORDER BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> five_min_bucket </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DESC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, device_id;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>åˆ›å»ºè¿ç»­èšåˆ</strong>ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> MATERIALIZED VIEW conditions_summary_hourly</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WITH</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">timescaledb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">continuous</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">AS</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    time_bucket(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;1 hour&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> hour_bucket,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    device_id,</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    AVG</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(temperature) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> avg_temp,</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    MAX</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(temperature) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> max_temp,</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    MIN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(temperature) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> min_temp</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> conditions</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">GROUP BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> hour_bucket, device_id;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æ·»åŠ ç­–ç•¥ä»¥æ¯å°æ—¶åˆ·æ–°ä¸€æ¬¡è¿ç»­èšåˆ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> add_continuous_aggregate_policy(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;conditions_summary_hourly&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    start_offset </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> INTERVAL </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;3 hours&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¼€å§‹èšåˆæ¯”å½“å‰æ—¶é—´æ—©3å°æ—¶çš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    end_offset   </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> INTERVAL </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;1 hour&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ç»“æŸèšåˆæ¯”å½“å‰æ—¶é—´æ—©1å°æ—¶çš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    schedule_interval </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> INTERVAL </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;1 hour&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥è¯¢è¿ç»­èšåˆè§†å›¾ä¼šéå¸¸å¿«ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> conditions_summary_hourly </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> device_id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;device001&#39;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ORDER BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> hour_bucket </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DESC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><p><strong>å…¸å‹åº”ç”¨åœºæ™¯ï¼š</strong></p><ul><li><strong>ç‰©è”ç½‘ (IoT)</strong>ï¼šå­˜å‚¨å’Œåˆ†ææ¥è‡ªä¼ æ„Ÿå™¨å’Œè®¾å¤‡çš„å¤§é‡æ•°æ®ã€‚</li><li><strong>ç›‘æ§å’Œå¯è§‚æµ‹æ€§</strong>ï¼šæ”¶é›†å’Œåˆ†æåº”ç”¨æ€§èƒ½æŒ‡æ ‡ã€æœåŠ¡å™¨æŒ‡æ ‡ã€æ—¥å¿—æ•°æ®ã€‚</li><li><strong>é‡‘èæœåŠ¡</strong>ï¼šå­˜å‚¨å’Œåˆ†æè‚¡ç¥¨ä»·æ ¼ã€äº¤æ˜“æ•°æ®ã€å¸‚åœºæŒ‡æ ‡ã€‚</li><li><strong>å•†ä¸šæ™ºèƒ½</strong>ï¼šè·Ÿè¸ªç”¨æˆ·è¡Œä¸ºã€ç½‘ç«™åˆ†æã€é”€å”®è¶‹åŠ¿ã€‚</li><li><strong>åœ°ç†ç©ºé—´æ—¶é—´åºåˆ—</strong>ï¼šä¾‹å¦‚ï¼Œè·Ÿè¸ªç§»åŠ¨ç‰©ä½“çš„è½¨è¿¹ã€‚</li></ul><p>TimescaleDB é€šè¿‡å°† PostgreSQL è½¬å˜ä¸ºä¸€ä¸ªå¼ºå¤§çš„æ—¶é—´åºåˆ—æ•°æ®åº“ï¼Œä¸ºå¤„ç†è¿™ç±»ç‰¹å®šå·¥ä½œè´Ÿè½½æä¾›äº†æ˜¾è‘—çš„æ€§èƒ½å’Œå¯ç®¡ç†æ€§ä¼˜åŠ¿ã€‚</p><h3 id="citus" tabindex="-1"><a class="header-anchor" href="#citus"><span>Citus</span></a></h3><p>Citus æ˜¯ PostgreSQL çš„ä¸€ä¸ªå¼€æºæ‰©å±•ï¼Œå®ƒé€šè¿‡<strong>åˆ†ç‰‡ (sharding)</strong> å’Œ<strong>åˆ†å¸ƒå¼æŸ¥è¯¢æ‰§è¡Œ</strong>å°† PostgreSQL è½¬æ¢ä¸ºä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ã€‚è¿™ä½¿å¾— PostgreSQL èƒ½å¤Ÿæ°´å¹³æ‰©å±•ï¼Œå¤„ç†æ›´å¤§çš„æ•°æ®é›†å’Œæ›´é«˜çš„æŸ¥è¯¢ååé‡ï¼Œè¶…è¶Šäº†å•èŠ‚ç‚¹ PostgreSQL çš„èƒ½åŠ›ã€‚</p><p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong></p><ol><li><p><strong>æ°´å¹³æ‰©å±• (Scale-Out)</strong>ï¼š</p><ul><li>Citus å…è®¸ä½ å°†æ•°æ®å’ŒæŸ¥è¯¢è´Ÿè½½åˆ†å¸ƒåˆ°ä¸€ä¸ªç”±å¤šä¸ª PostgreSQL æœåŠ¡å™¨ï¼ˆç§°ä¸º<strong>å·¥ä½œèŠ‚ç‚¹ (worker nodes)</strong>ï¼‰ç»„æˆçš„é›†ç¾¤ä¸Šã€‚</li><li>ä¸€ä¸ª<strong>åè°ƒèŠ‚ç‚¹ (coordinator node)</strong> è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ã€ç®¡ç†å…ƒæ•°æ®ã€è§„åˆ’åˆ†å¸ƒå¼æŸ¥è¯¢ï¼Œå¹¶å°†æŸ¥è¯¢ç‰‡æ®µåˆ†å‘ç»™å·¥ä½œèŠ‚ç‚¹æ‰§è¡Œã€‚</li></ul></li><li><p><strong>åˆ†å¸ƒå¼è¡¨ (Distributed Tables)</strong>ï¼š</p><ul><li>å¤§å‹è¡¨å¯ä»¥è¢«å£°æ˜ä¸ºåˆ†å¸ƒå¼è¡¨ã€‚Citus ä¼šæ ¹æ®ä¸€ä¸ªæŒ‡å®šçš„<strong>åˆ†å¸ƒåˆ— (distribution column)</strong>ï¼ˆä¹Ÿç§°ä¸ºåˆ†ç‰‡é”®ï¼‰å°†è¡¨çš„æ•°æ®æ°´å¹³åˆ†å‰²æˆå¤šä¸ª<strong>åˆ†ç‰‡ (shards)</strong>ã€‚</li><li>æ¯ä¸ªåˆ†ç‰‡æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ PostgreSQL è¡¨ï¼Œå­˜å‚¨åœ¨æŸä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šã€‚</li><li>é€‰æ‹©åˆé€‚çš„åˆ†å¸ƒåˆ—å¯¹äºæ€§èƒ½è‡³å…³é‡è¦ï¼Œç›®æ ‡æ˜¯ä½¿æŸ¥è¯¢å°½å¯èƒ½åœ°åœ¨å•ä¸ªå·¥ä½œèŠ‚ç‚¹å†…å®Œæˆï¼ˆä¸‹æ¨ï¼‰ï¼Œæˆ–è€…å‡åŒ€åœ°åˆ†å¸ƒåˆ°å¤šä¸ªå·¥ä½œèŠ‚ç‚¹ã€‚</li></ul></li><li><p><strong>å¼•ç”¨è¡¨ (Reference Tables)</strong>ï¼š</p><ul><li>å¯¹äºé‚£äº›ç›¸å¯¹è¾ƒå°ã€ç»å¸¸éœ€è¦ä¸åˆ†å¸ƒå¼è¡¨è¿æ¥ä¸”ä¸ç»å¸¸å˜åŒ–çš„è¡¨ï¼Œå¯ä»¥å£°æ˜ä¸ºå¼•ç”¨è¡¨ã€‚</li><li>å¼•ç”¨è¡¨çš„å®Œæ•´å‰¯æœ¬ä¼šå­˜åœ¨äºé›†ç¾¤ä¸­çš„æ‰€æœ‰å·¥ä½œèŠ‚ç‚¹ä¸Šã€‚</li><li>è¿™ä½¿å¾—åˆ†å¸ƒå¼è¡¨ä¸å¼•ç”¨è¡¨çš„è¿æ¥å¯ä»¥åœ¨å·¥ä½œèŠ‚ç‚¹æœ¬åœ°é«˜æ•ˆæ‰§è¡Œï¼Œæ— éœ€è·¨èŠ‚ç‚¹æ•°æ®ä¼ è¾“ã€‚</li></ul></li><li><p><strong>åˆ†å¸ƒå¼æŸ¥è¯¢å¼•æ“</strong>ï¼š</p><ul><li>åè°ƒèŠ‚ç‚¹æ¥æ”¶ SQL æŸ¥è¯¢ï¼Œè§£æå®ƒï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåˆ†å¸ƒå¼æŸ¥è¯¢è®¡åˆ’ã€‚</li><li>å¦‚æœæŸ¥è¯¢æ¶‰åŠåˆ°åˆ†å¸ƒå¼è¡¨ï¼Œåè°ƒèŠ‚ç‚¹ä¼šå°†æŸ¥è¯¢ç‰‡æ®µè·¯ç”±åˆ°åŒ…å«ç›¸å…³åˆ†ç‰‡çš„å·¥ä½œèŠ‚ç‚¹ä¸Šå¹¶è¡Œæ‰§è¡Œã€‚</li><li>å·¥ä½œèŠ‚ç‚¹æ‰§è¡Œå…¶æœ¬åœ°æŸ¥è¯¢ç‰‡æ®µï¼Œå¹¶å°†ç»“æœè¿”å›ç»™åè°ƒèŠ‚ç‚¹ã€‚</li><li>åè°ƒèŠ‚ç‚¹æ”¶é›†å¹¶èšåˆæ¥è‡ªå·¥ä½œèŠ‚ç‚¹çš„ç»“æœï¼Œç„¶åè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li>Citus æ”¯æŒå¤§éƒ¨åˆ† PostgreSQL SQL åŠŸèƒ½ï¼ŒåŒ…æ‹¬äº‹åŠ¡ã€å¤–é”®ï¼ˆåœ¨æŸäº›æ¡ä»¶ä¸‹ï¼‰ã€JOINsã€çª—å£å‡½æ•°ã€èšåˆã€å…¨æ–‡æœç´¢ç­‰ã€‚</li></ul></li><li><p><strong>å…±ç½® (Colocation)</strong>ï¼š</p><ul><li>å¦‚æœå¤šä¸ªåˆ†å¸ƒå¼è¡¨ä½¿ç”¨ç›¸åŒçš„åˆ†å¸ƒåˆ—ç±»å‹å¹¶ä¸”å…·æœ‰ç›¸åŒçš„å‰¯æœ¬æ•°é‡å’Œåˆ†ç‰‡æ•°é‡ï¼ŒCitus å¯ä»¥ç¡®ä¿å…·æœ‰ç›¸åŒåˆ†å¸ƒåˆ—å€¼çš„è¿™äº›è¡¨çš„åˆ†ç‰‡å­˜å‚¨åœ¨åŒä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šã€‚</li><li>è¿™å¯¹äºæ¶‰åŠè¿™äº›è¡¨ä¹‹é—´è¿æ¥çš„æŸ¥è¯¢éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒå…è®¸è¿æ¥æ“ä½œåœ¨å·¥ä½œèŠ‚ç‚¹æœ¬åœ°é«˜æ•ˆæ‰§è¡Œã€‚</li></ul></li><li><p><strong>ç§Ÿæˆ·éš”ç¦» (Tenant Isolation)</strong>ï¼š</p><ul><li>Citus ç‰¹åˆ«é€‚åˆå¤šç§Ÿæˆ· SaaS åº”ç”¨ï¼Œå¯ä»¥å°†æ¯ä¸ªç§Ÿæˆ·çš„æ•°æ®ï¼ˆé€šè¿‡ç§Ÿæˆ·IDä½œä¸ºåˆ†å¸ƒåˆ—ï¼‰éš”ç¦»åˆ°ç‰¹å®šçš„åˆ†ç‰‡é›†ï¼Œç”šè‡³ç‰¹å®šçš„å·¥ä½œèŠ‚ç‚¹é›†ã€‚</li></ul></li><li><p><strong>åœ¨çº¿æ·»åŠ èŠ‚ç‚¹å’Œåˆ†ç‰‡é‡å¹³è¡¡</strong>ï¼š</p><ul><li>å¯ä»¥å‘ Citus é›†ç¾¤ä¸­åŠ¨æ€æ·»åŠ æ–°çš„å·¥ä½œèŠ‚ç‚¹ã€‚</li><li>Citus æä¾›äº†åˆ†ç‰‡é‡å¹³è¡¡å™¨ï¼Œå¯ä»¥åœ¨ä¸ä¸­æ–­æœåŠ¡çš„æƒ…å†µä¸‹å°†åˆ†ç‰‡ä»è´Ÿè½½è¾ƒé‡çš„èŠ‚ç‚¹ç§»åŠ¨åˆ°è´Ÿè½½è¾ƒè½»çš„èŠ‚ç‚¹æˆ–æ–°æ·»åŠ çš„èŠ‚ç‚¹ã€‚</li></ul></li></ol><p><strong>å®‰è£…ä¸å¯ç”¨ï¼š</strong></p><ol><li><p><strong>è®¾ç½® Citus é›†ç¾¤</strong>ï¼š</p><ul><li>è¿™é€šå¸¸æ¶‰åŠé…ç½®ä¸€ä¸ªåè°ƒèŠ‚ç‚¹å’Œå¤šä¸ªå·¥ä½œèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ PostgreSQL å®ä¾‹ã€‚</li><li>Citus å¯ä»¥é€šè¿‡æºç ç¼–è¯‘å®‰è£…ï¼Œä¹Ÿæœ‰é€‚ç”¨äºå„ç§å¹³å°çš„äºŒè¿›åˆ¶åŒ…å’Œ Docker é•œåƒã€‚</li><li>äº‘æœåŠ¡å¦‚ Microsoft Azure Database for PostgreSQL - Hyperscale (Citus) æä¾›äº†æ‰˜ç®¡çš„ Citus æœåŠ¡ã€‚</li></ul></li><li><p><strong>åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šå®‰è£… Citus æ‰©å±•</strong>ï¼š<br> åœ¨åè°ƒèŠ‚ç‚¹å’Œæ‰€æœ‰å·¥ä½œèŠ‚ç‚¹çš„ PostgreSQL å®ä¾‹ä¸­éƒ½éœ€è¦å®‰è£… Citus æ‰©å±•ã€‚</p></li><li><p><strong>é…ç½® PostgreSQL (<code>postgresql.conf</code>)</strong>ï¼š</p><ul><li>åœ¨æ¯ä¸ªèŠ‚ç‚¹çš„ <code>postgresql.conf</code> ä¸­å°† <code>citus</code> æ·»åŠ åˆ° <code>shared_preload_libraries</code>ï¼Œç„¶åé‡å¯ PostgreSQLã€‚</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>shared_preload_libraries = &#39;citus&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>åœ¨åè°ƒèŠ‚ç‚¹ä¸Šå¯ç”¨æ‰©å±•å¹¶æ·»åŠ å·¥ä½œèŠ‚ç‚¹ä¿¡æ¯</strong>ï¼š<br> è¿æ¥åˆ°åè°ƒèŠ‚ç‚¹çš„æ•°æ®åº“ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> EXTENSION citus;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶åï¼Œä½¿ç”¨ <code>master_add_node</code> (æ—§ç‰ˆæœ¬) æˆ– <code>citus_add_node</code> (æ–°ç‰ˆæœ¬) å‡½æ•°å°†å·¥ä½œèŠ‚ç‚¹çš„ä¿¡æ¯æ³¨å†Œåˆ°åè°ƒèŠ‚ç‚¹ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¹äº Citus 11.0+</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> citus_add_node(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;worker_host_1&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5432</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> citus_add_node(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;worker_host_2&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5432</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- éªŒè¯å·¥ä½œèŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> citus_get_active_worker_nodes();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p><strong>ä½¿ç”¨æ–¹æ³•ç¤ºä¾‹ï¼š</strong></p><ol><li><p><strong>é€‰æ‹©åˆ†å¸ƒåˆ—å¹¶åˆ›å»ºåˆ†å¸ƒå¼è¡¨</strong>ï¼š<br> å‡è®¾æœ‰ä¸€ä¸ªè®°å½•ç½‘ç«™äº‹ä»¶çš„è¡¨ï¼Œ<code>site_id</code> æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åˆ†å¸ƒåˆ—å€™é€‰ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> events</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    site_id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INTEGER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    event_type </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TEXT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    event_data JSONB,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    created_at </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TIMESTAMPTZ</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOW</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å°† events è¡¨å£°æ˜ä¸ºåˆ†å¸ƒå¼è¡¨ï¼Œå¹¶ä»¥ site_id ä½œä¸ºåˆ†å¸ƒåˆ—</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> create_distributed_table(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;events&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;site_id&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>åˆ›å»ºå¼•ç”¨è¡¨</strong>ï¼š<br> å‡è®¾æœ‰ä¸€ä¸ªå°çš„ <code>event_categories</code> è¡¨ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> event_categories</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    event_type </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TEXT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> PRIMARY KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    category </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">TEXT</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> event_categories </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;view&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;engagement&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;click&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;engagement&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;purchase&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;conversion&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å°† event_categories å£°æ˜ä¸ºå¼•ç”¨è¡¨</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> create_reference_table(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;event_categories&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æ’å…¥æ•°æ®</strong>ï¼š<br> åƒæ“ä½œæ™®é€šè¡¨ä¸€æ ·å‘åè°ƒèŠ‚ç‚¹æ’å…¥æ•°æ®ã€‚Citus ä¼šæ ¹æ®åˆ†å¸ƒåˆ—çš„å€¼å°†æ•°æ®è·¯ç”±åˆ°æ­£ç¡®çš„åˆ†ç‰‡ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> events (site_id, event_type, event_data) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;view&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;{&quot;page&quot;: &quot;/home&quot;}&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;click&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;{&quot;button&quot;: &quot;buy_now&quot;}&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;purchase&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;{&quot;item_id&quot;: 123, &quot;amount&quot;: 19.99}&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æŸ¥è¯¢æ•°æ®</strong>ï¼š<br> æ‰€æœ‰æŸ¥è¯¢éƒ½å‘é€åˆ°åè°ƒèŠ‚ç‚¹ã€‚</p><ul><li><strong>è·¯ç”±åˆ°å•ä¸ªå·¥ä½œèŠ‚ç‚¹çš„æŸ¥è¯¢ (é«˜æ•ˆ)</strong>ï¼š<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¦‚æœ WHERE å­å¥ä¸­åŒ…å«å¯¹åˆ†å¸ƒåˆ—çš„ç­‰å€¼æ¡ä»¶ï¼ŒæŸ¥è¯¢é€šå¸¸ä¼šè¢«è·¯ç”±åˆ°å•ä¸ªå·¥ä½œèŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> COUNT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(*) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> events </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> site_id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>æ¶‰åŠå¤šä¸ªå·¥ä½œèŠ‚ç‚¹çš„æŸ¥è¯¢ (å¹¶è¡Œæ‰§è¡Œ)</strong>ï¼š<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¦‚æœæŸ¥è¯¢ä¸åŒ…å«å¯¹åˆ†å¸ƒåˆ—çš„è¿‡æ»¤ï¼Œæˆ–è€…éœ€è¦è·¨åˆ†ç‰‡èšåˆ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> event_type, </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">COUNT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(*)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> events</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">GROUP BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> event_type</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ORDER BY</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> COUNT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(*) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DESC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>è¿æ¥åˆ†å¸ƒå¼è¡¨å’Œå¼•ç”¨è¡¨ (é«˜æ•ˆ)</strong>ï¼š<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">site_id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">event_type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">ec</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">category</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">created_at</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> events e</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">JOIN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> event_categories ec </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ON</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">event_type</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ec</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">event_type</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">site_id</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AND</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">created_at</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOW</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() - INTERVAL </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;1 day&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ol><p><strong>å…¸å‹åº”ç”¨åœºæ™¯ï¼š</strong></p><ul><li><strong>å¤šç§Ÿæˆ· SaaS åº”ç”¨</strong>ï¼šæ¯ä¸ªç§Ÿæˆ·çš„æ•°æ®é€šè¿‡ <code>tenant_id</code> åˆ†å¸ƒï¼Œå®ç°æ•°æ®éš”ç¦»å’Œæ°´å¹³æ‰©å±•ã€‚</li><li><strong>å®æ—¶åˆ†æä»ªè¡¨ç›˜</strong>ï¼šå¤„ç†å¤§é‡æµå…¥æ•°æ®å¹¶å¿«é€Ÿç”ŸæˆèšåˆæŠ¥å‘Šï¼Œä¾‹å¦‚ç½‘ç«™æµé‡åˆ†æã€ç”¨æˆ·è¡Œä¸ºåˆ†æã€‚</li><li><strong>é«˜ååé‡äº‹åŠ¡å‹åº”ç”¨</strong>ï¼šéœ€è¦å¤„ç†å¤§é‡å¹¶å‘è¯»å†™æ“ä½œçš„ç³»ç»Ÿï¼Œå¦‚å¤§å‹ç”µå•†çš„è®¢å•ç³»ç»Ÿæˆ–æ¸¸æˆåç«¯ã€‚</li><li><strong>æ—¶é—´åºåˆ—æ•°æ®</strong>ï¼ˆè™½ç„¶ TimescaleDB æ›´ä¸“æ³¨ï¼Œä½† Citus ä¹Ÿèƒ½å¤„ç†ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦ä¸å…¶ä»–éæ—¶é—´åºåˆ—æ•°æ®ç»“åˆæ—¶ï¼‰ã€‚</li><li><strong>å¾®æœåŠ¡æ¶æ„</strong>ï¼šä½œä¸ºå¾®æœåŠ¡çš„æ•°æ®å­˜å‚¨å±‚ï¼Œæä¾›å¯æ‰©å±•çš„ PostgreSQL å®ä¾‹ã€‚</li><li><strong>ä¸ PostGIS ç»“åˆç”¨äºå¤§è§„æ¨¡åœ°ç†ç©ºé—´åˆ†æ</strong>ã€‚</li></ul><p>Citus é€šè¿‡å…¶åˆ†å¸ƒå¼æ¶æ„ï¼Œæ˜¾è‘—å¢å¼ºäº† PostgreSQL çš„å¯ä¼¸ç¼©æ€§å’Œå¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œä½¿å…¶èƒ½å¤Ÿåº”å¯¹æ›´å¤§è§„æ¨¡çš„æ•°æ®æŒ‘æˆ˜ã€‚é€‰æ‹©åˆé€‚çš„åˆ†å¸ƒåˆ—å’Œç†è§£æ•°æ®åˆ†å‘ç­–ç•¥æ˜¯æˆåŠŸä½¿ç”¨ Citus çš„å…³é”®ã€‚</p><hr><h2 id="æ•°æ®å¤‡ä»½ä¸æ¢å¤" tabindex="-1"><a class="header-anchor" href="#æ•°æ®å¤‡ä»½ä¸æ¢å¤"><span>æ•°æ®å¤‡ä»½ä¸æ¢å¤</span></a></h2><p><strong>1. é€»è¾‘å¤‡ä»½ (Logical Backups)ï¼š</strong></p><p>é€»è¾‘å¤‡ä»½æ˜¯ä»æ•°æ®åº“ä¸­æå–æ•°æ®å¹¶å°†å…¶å­˜å‚¨ä¸ºä¸€ç»„ SQL è¯­å¥æˆ–å…¶ä»–å¯ç§»æ¤æ ¼å¼ï¼ˆå¦‚ CSVï¼‰çš„è¿‡ç¨‹ã€‚è¿™äº› SQL è¯­å¥åœ¨æ¢å¤æ—¶å¯ä»¥é‡æ–°æ‰§è¡Œä»¥é‡å»ºæ•°æ®åº“å¯¹è±¡å’Œæ•°æ®ã€‚</p><ul><li><p><strong><code>pg_dump</code></strong>:</p><ul><li>ç”¨é€”ï¼šç”¨äºå¤‡ä»½å•ä¸ª PostgreSQL æ•°æ®åº“ã€‚å®ƒä¸ä¼šå¤‡ä»½è§’è‰²ä¿¡æ¯æˆ–è¡¨ç©ºé—´å®šä¹‰ç­‰å…¨å±€å¯¹è±¡ã€‚</li><li>è¾“å‡ºæ ¼å¼ï¼š <ul><li><strong>çº¯æ–‡æœ¬ SQL è„šæœ¬ (<code>-Fp</code> æˆ–é»˜è®¤)</strong>ï¼šç”Ÿæˆä¸€ä¸ªåŒ…å« <code>CREATE TABLE</code>, <code>ALTER TABLE</code>, <code>COPY</code> (ç”¨äºæ•°æ®) ç­‰å‘½ä»¤çš„ <code>.sql</code> æ–‡ä»¶ã€‚å¯ä»¥ç›´æ¥ç”¨ <code>psql</code> æ¢å¤ã€‚</li><li><strong>è‡ªå®šä¹‰å½’æ¡£æ ¼å¼ (<code>-Fc</code>)</strong>: ç”Ÿæˆä¸€ä¸ªç»è¿‡å‹ç¼©çš„è‡ªå®šä¹‰æ ¼å¼æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ <code>.dump</code> æˆ– <code>.custom</code>ï¼‰ã€‚è¿™ç§æ ¼å¼æ›´çµæ´»ï¼Œå…è®¸åœ¨æ¢å¤æ—¶é€‰æ‹©æ€§åœ°æ¢å¤å¯¹è±¡ã€å¹¶è¡Œæ¢å¤ï¼Œå¹¶ä¸”é€šå¸¸æ¯”çº¯æ–‡æœ¬æ ¼å¼æ›´å°ã€‚éœ€è¦ä½¿ç”¨ <code>pg_restore</code> æ¢å¤ã€‚</li><li><strong>ç›®å½•å½’æ¡£æ ¼å¼ (<code>-Fd</code>)</strong>: å°†å¤‡ä»½è¾“å‡ºåˆ°ä¸€ä¸ªç›®å½•ï¼Œæ¯ä¸ªè¡¨çš„æ•°æ®å’Œæ¨¡å¼åˆ†åˆ«å­˜å‚¨åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œå¹¶æœ‰ä¸€ä¸ªç›®å½•æ–‡ä»¶ã€‚æ­¤æ ¼å¼ä¹Ÿæ”¯æŒå¹¶è¡Œå¤‡ä»½å’Œæ¢å¤ï¼Œå¹¶ä½¿ç”¨ <code>pg_restore</code> æ¢å¤ã€‚</li><li><strong>tar å½’æ¡£æ ¼å¼ (<code>-Ft</code>)</strong>: ç”Ÿæˆä¸€ä¸ª <code>.tar</code> æ–‡ä»¶ï¼Œç±»ä¼¼äºè‡ªå®šä¹‰æ ¼å¼ï¼Œä¹Ÿç”¨ <code>pg_restore</code> æ¢å¤ã€‚</li></ul></li><li><strong>å¸¸ç”¨é€‰é¡¹ï¼š</strong><ul><li><code>-U username</code>: æŒ‡å®šè¿æ¥çš„ç”¨æˆ·åã€‚</li><li><code>-W</code>: æç¤ºè¾“å…¥å¯†ç ã€‚</li><li><code>-h hostname</code>: æŒ‡å®šæœåŠ¡å™¨ä¸»æœºã€‚</li><li><code>-p port</code>: æŒ‡å®šæœåŠ¡å™¨ç«¯å£ã€‚</li><li><code>-d dbname</code>: è¦å¤‡ä»½çš„æ•°æ®åº“å (ä¹Ÿå¯ä»¥ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°)ã€‚</li><li><code>-f filename</code>: æŒ‡å®šè¾“å‡ºæ–‡ä»¶åã€‚</li><li><code>-F format</code>: æŒ‡å®šè¾“å‡ºæ ¼å¼ (<code>p</code>=plain, <code>c</code>=custom, <code>d</code>=directory, <code>t</code>=tar)ã€‚</li><li><code>-Z level</code>: æŒ‡å®šå‹ç¼©çº§åˆ« (0-9ï¼Œä»…ç”¨äºè‡ªå®šä¹‰ã€ç›®å½•å’Œ tar æ ¼å¼)ã€‚</li><li><code>-n schema</code> / <code>-N schema</code>: åªå¤‡ä»½/ä¸å¤‡ä»½æŒ‡å®šçš„æ¨¡å¼ã€‚</li><li><code>-t table</code> / <code>-T table</code>: åªå¤‡ä»½/ä¸å¤‡ä»½æŒ‡å®šçš„è¡¨ã€‚</li><li><code>--inserts</code> æˆ– <code>--column-inserts</code>: ä½¿ç”¨ <code>INSERT</code> å‘½ä»¤è€Œä¸æ˜¯ <code>COPY</code> æ¥è½¬å‚¨æ•°æ® (éå¸¸æ…¢ï¼Œä½†å¯èƒ½æ›´å…·å¯ç§»æ¤æ€§æˆ–æ˜“äºç¼–è¾‘)ã€‚</li><li><code>--data-only</code>: åªå¤‡ä»½æ•°æ®ï¼Œä¸å¤‡ä»½æ¨¡å¼ã€‚</li><li><code>--schema-only</code>: åªå¤‡ä»½æ¨¡å¼ï¼ˆè¡¨å®šä¹‰ã€å‡½æ•°ç­‰ï¼‰ï¼Œä¸å¤‡ä»½æ•°æ®ã€‚</li><li><code>--clean</code>: åœ¨åˆ›å»ºå‘½ä»¤ä¹‹å‰åŒ…å« <code>DROP</code> å‘½ä»¤ã€‚</li><li><code>--create</code>: åŒ…å« <code>CREATE DATABASE</code> å‘½ä»¤ã€‚</li><li><code>-j num_jobs</code>: (ç”¨äºç›®å½•æ ¼å¼) å¹¶è¡Œè½¬å‚¨æŒ‡å®šæ•°é‡çš„è¡¨ã€‚</li></ul></li><li><strong>ç¤ºä¾‹ï¼š</strong><br> å¤‡ä»½ <code>mydatabase</code> åˆ° <code>mydatabase_backup.sql</code> (çº¯æ–‡æœ¬)ï¼š<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pg_dump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myuser</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -W</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mydatabase</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mydatabase_backup.sql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>å¤‡ä»½ <code>mydatabase</code> åˆ° <code>mydatabase_backup.dump</code> (è‡ªå®šä¹‰æ ¼å¼ï¼Œå‹ç¼©)ï¼š<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pg_dump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myuser</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -W</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Fc</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Z5</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mydatabase_backup.dump</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mydatabase</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></li><li><p><strong><code>pg_dumpall</code></strong>:</p><ul><li>ç”¨é€”ï¼šç”¨äºå¤‡ä»½æ•´ä¸ª PostgreSQL é›†ç¾¤ï¼ŒåŒ…æ‹¬æ‰€æœ‰æ•°æ®åº“ã€è§’è‰²ã€è¡¨ç©ºé—´ä»¥åŠå…¶ä»–å…¨å±€å¯¹è±¡ã€‚</li><li>è¾“å‡ºæ ¼å¼ï¼šæ€»æ˜¯çº¯æ–‡æœ¬ SQL è„šæœ¬ã€‚</li><li><strong>å¸¸ç”¨é€‰é¡¹ï¼š</strong> ç±»ä¼¼ <code>pg_dump</code>ï¼Œä½†ä¸æŒ‡å®šç‰¹å®šæ•°æ®åº“ã€‚ <ul><li><code>--globals-only</code>: åªå¤‡ä»½å…¨å±€å¯¹è±¡ï¼ˆè§’è‰²ã€è¡¨ç©ºé—´ï¼‰ï¼Œä¸å¤‡ä»½ä»»ä½•æ•°æ®åº“å†…å®¹ã€‚</li><li><code>--roles-only</code>: åªå¤‡ä»½è§’è‰²ã€‚</li><li><code>--tablespaces-only</code>: åªå¤‡ä»½è¡¨ç©ºé—´ã€‚</li></ul></li><li><strong>ç¤ºä¾‹ï¼š</strong><br> å¤‡ä»½æ•´ä¸ªé›†ç¾¤ï¼š<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pg_dumpall</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postgres</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -W</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cluster_backup.sql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>åªå¤‡ä»½å…¨å±€å¯¹è±¡ï¼š<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pg_dumpall</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postgres</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -W</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --globals-only</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">globals_backup.sql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></li></ul><p><strong>2. æ¢å¤é€»è¾‘å¤‡ä»½ï¼š</strong></p><ul><li><p><strong>ä½¿ç”¨ <code>psql</code> (ç”¨äºçº¯æ–‡æœ¬ SQL è„šæœ¬)</strong>ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ¢å¤ pg_dumpall çš„å¤‡ä»½ (é€šå¸¸éœ€è¦è¿æ¥åˆ° postgres æ•°æ®åº“ï¼Œå¹¶ä½œä¸ºè¶…çº§ç”¨æˆ·)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">psql</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postgres</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cluster_backup.sql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ¢å¤ pg_dump çš„å•ä¸ªæ•°æ®åº“å¤‡ä»½</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 1. (å¦‚æœå¤‡ä»½æ–‡ä»¶ä¸­ä¸åŒ…å« CREATE DATABASE) å…ˆåˆ›å»ºç©ºæ•°æ®åº“</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">createdb</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myuser</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> new_database</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 2. å¯¼å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">psql</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myuser</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> new_database</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mydatabase_backup.sql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ä½¿ç”¨ <code>pg_restore</code> (ç”¨äºè‡ªå®šä¹‰ã€ç›®å½•æˆ– tar æ ¼å¼çš„ <code>pg_dump</code> å¤‡ä»½)</strong>ï¼š<br><code>pg_restore</code> æä¾›äº†æ›´å¤šçµæ´»æ€§ï¼Œä¾‹å¦‚é€‰æ‹©æ€§æ¢å¤ã€å¹¶è¡Œæ¢å¤ã€‚</p><ul><li><strong>å¸¸ç”¨é€‰é¡¹ï¼š</strong><ul><li><code>-U username</code>, <code>-W</code>, <code>-h hostname</code>, <code>-p port</code></li><li><code>-d dbname</code>: æŒ‡å®šè¦æ¢å¤åˆ°çš„ç›®æ ‡æ•°æ®åº“ï¼ˆå¿…é¡»å·²å­˜åœ¨ï¼‰ã€‚</li><li><code>-l backup_file.dump</code>: åˆ—å‡ºå½’æ¡£æ–‡ä»¶çš„å†…å®¹ã€‚</li><li><code>-F format</code>: æŒ‡å®šè¾“å…¥å¤‡ä»½æ–‡ä»¶çš„æ ¼å¼ (é€šå¸¸å¯ä»¥è‡ªåŠ¨æ£€æµ‹)ã€‚</li><li><code>-C</code>: (ä¸ <code>-d</code> ä¸€èµ·ä½¿ç”¨) ä»å¤‡ä»½æ–‡ä»¶ä¸­åŒ…å«çš„ <code>CREATE DATABASE</code> å‘½ä»¤åˆ›å»ºæ•°æ®åº“ã€‚</li><li><code>-c</code> (<code>--clean</code>): åœ¨é‡æ–°åˆ›å»ºæ•°æ®åº“å¯¹è±¡ä¹‹å‰ï¼Œå…ˆæ¸…ç†ï¼ˆåˆ é™¤ï¼‰å®ƒä»¬ã€‚</li><li><code>-j num_jobs</code>: å¹¶è¡Œæ¢å¤ã€‚</li><li><code>-n schema</code> / <code>-t table</code>: åªæ¢å¤æŒ‡å®šçš„æ¨¡å¼/è¡¨ã€‚</li></ul></li><li><strong>ç¤ºä¾‹ï¼š</strong><br> æ¢å¤ <code>mydatabase_backup.dump</code> åˆ° <code>new_database</code> (å‡è®¾å·²åˆ›å»º)ï¼š<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pg_restore</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myuser</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -W</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> new_database</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mydatabase_backup.dump</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>åˆ—å‡ºå¤‡ä»½å†…å®¹ï¼š<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pg_restore</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -l</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mydatabase_backup.dump</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>å¹¶è¡Œæ¢å¤ï¼ˆä¾‹å¦‚ä½¿ç”¨4ä¸ªä½œä¸šï¼‰ï¼š<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pg_restore</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myuser</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -W</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> new_database</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mydatabase_backup.dump</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></li></ul><p><strong>é€»è¾‘å¤‡ä»½çš„ä¼˜ç¼ºç‚¹ï¼š</strong></p><ul><li>ä¼˜ç‚¹ï¼šçµæ´»ï¼ˆå¯ä»¥é€‰æ‹©æ€§æ¢å¤ï¼‰ã€å¯ç§»æ¤ï¼ˆå¯ä»¥åœ¨ä¸åŒç‰ˆæœ¬çš„ PostgreSQL ç”šè‡³ä¸åŒæ¶æ„çš„æœºå™¨ä¹‹é—´è¿ç§»ï¼‰ã€å¤‡ä»½æ–‡ä»¶ç›¸å¯¹è¾ƒå°ï¼ˆå°¤å…¶æ˜¯å‹ç¼©åï¼‰ã€‚</li><li>ç¼ºç‚¹ï¼šå¤‡ä»½å’Œæ¢å¤è¿‡ç¨‹å¯èƒ½è¾ƒæ…¢ï¼ˆç‰¹åˆ«æ˜¯å¯¹äºéå¸¸å¤§çš„æ•°æ®åº“ï¼‰ï¼Œæ¢å¤æ—¶éœ€è¦é‡å»ºç´¢å¼•ï¼Œè¿™å¯èƒ½éå¸¸è€—æ—¶ã€‚ä¸é€‚åˆéå¸¸å¤§çš„æ•°æ®åº“çš„å¿«é€Ÿæ¢å¤æˆ– PITRã€‚</li></ul><p><strong>3. ç‰©ç†å¤‡ä»½ (Physical Backups)ï¼š</strong></p><p>ç‰©ç†å¤‡ä»½æ˜¯é€šè¿‡ç›´æ¥å¤åˆ¶æ„æˆæ•°æ®åº“é›†ç¾¤çš„æ•°æ®æ–‡ä»¶å’Œ WAL (Write-Ahead Log) æ–‡ä»¶æ¥è¿›è¡Œçš„ã€‚</p><ul><li><p><strong>æ–‡ä»¶ç³»ç»Ÿçº§åˆ«å¤‡ä»½ (Cold Backup)</strong>ï¼š</p><ul><li>æœ€ç®€å•çš„æ–¹æ³•æ˜¯å…³é—­ PostgreSQL æœåŠ¡å™¨ï¼Œç„¶åå¤åˆ¶æ•´ä¸ªæ•°æ®ç›®å½• (<code>PGDATA</code>)ã€‚</li><li>æ¢å¤æ—¶ï¼Œå…³é—­æœåŠ¡å™¨ï¼Œç”¨å¤‡ä»½çš„æ–‡ä»¶æ›¿æ¢æ•°æ®ç›®å½•ï¼Œç„¶åé‡å¯æœåŠ¡å™¨ã€‚</li><li>ä¼˜ç‚¹ï¼šç®€å•ã€‚</li><li>ç¼ºç‚¹ï¼šéœ€è¦åœæœºï¼Œå¤‡ä»½å¯èƒ½å¾ˆå¤§ï¼Œä¸èƒ½è¿›è¡Œæ—¶é—´ç‚¹æ¢å¤ã€‚</li></ul></li><li><p><strong>æŒç»­å½’æ¡£å’Œæ—¶é—´ç‚¹æ¢å¤ (Point-in-Time Recovery - PITR)</strong>ï¼š<br> è¿™æ˜¯ PostgreSQL æœ€å¼ºå¤§å’Œæ¨èçš„ç‰©ç†å¤‡ä»½æ–¹æ³•ï¼Œå…è®¸å°†æ•°æ®åº“æ¢å¤åˆ°è¿‡å»çš„ä»»æ„æ—¶é—´ç‚¹ã€‚</p><ul><li><strong>æ¦‚å¿µ</strong>ï¼š <ol><li><strong>åŸºç¡€å¤‡ä»½ (Base Backup)</strong>ï¼šé¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ•°æ®åº“é›†ç¾¤æ–‡ä»¶çš„ä¸€è‡´æ€§å¿«ç…§ã€‚è¿™å¯ä»¥ä½¿ç”¨ <code>pg_basebackup</code> å·¥å…·æˆ–é€šè¿‡æ‰‹åŠ¨è®¾ç½®ä½çº§ API æ¥å®Œæˆã€‚</li><li><strong>WAL å½’æ¡£ (WAL Archiving)</strong>ï¼šé…ç½® PostgreSQL å°†å…¶ç”Ÿæˆçš„ WAL æ®µæ–‡ä»¶æŒç»­å¤åˆ¶åˆ°ä¸€ä¸ªå®‰å…¨çš„å½’æ¡£ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå¦ä¸€å°æœåŠ¡å™¨ã€NFSã€äº‘å­˜å‚¨ï¼‰ã€‚WAL æ–‡ä»¶åŒ…å«äº†å¯¹æ•°æ®åº“çš„æ‰€æœ‰æ›´æ”¹è®°å½•ã€‚ <ul><li>åœ¨ <code>postgresql.conf</code> ä¸­è®¾ç½®ï¼š <ul><li><code>wal_level = replica</code> (æˆ– <code>logical</code>ï¼Œæˆ–æ›´é«˜ç‰ˆæœ¬ä¸­çš„ <code>archive</code>)</li><li><code>archive_mode = on</code></li><li><code>archive_command = &#39;cp %p /path/to/archive/%f&#39;</code> (ç®€å•ç¤ºä¾‹ï¼Œç”Ÿäº§ä¸­ä¼šä½¿ç”¨æ›´å¥å£®çš„å‘½ä»¤æˆ–å·¥å…·å¦‚ <code>pg_receivewal</code>, <code>wal-g</code>, <code>pgBackRest</code>)</li></ul></li></ul></li></ol></li><li><strong>æ¢å¤è¿‡ç¨‹ (PITR)</strong>ï¼š <ol><li>ä»å½’æ¡£ä¸­æ¢å¤æœ€è¿‘çš„åŸºç¡€å¤‡ä»½åˆ°æ–°çš„æ•°æ®ç›®å½•ã€‚</li><li>åˆ›å»ºä¸€ä¸ª <code>recovery.signal</code> æ–‡ä»¶ï¼ˆæˆ– <code>standby.signal</code> ç”¨äºå¤‡åº“ï¼‰åœ¨æ–°çš„æ•°æ®ç›®å½•ä¸­ï¼Œå¹¶é…ç½® <code>postgresql.conf</code> (æˆ– <code>recovery.conf</code> åœ¨æ—§ç‰ˆæœ¬ä¸­) ä»¥æŒ‡å®šä» WAL å½’æ¡£ä¸­æ¢å¤ WAL æ–‡ä»¶ã€‚</li><li>åœ¨ <code>postgresql.conf</code> ä¸­ï¼ˆæˆ– <code>recovery.conf</code>ï¼‰è®¾ç½® <code>restore_command</code> æ¥å‘Šè¯‰ PostgreSQL å¦‚ä½•ä»å½’æ¡£è·å– WAL æ–‡ä»¶ (ä¾‹å¦‚ <code>restore_command = &#39;cp /path/to/archive/%f %p&#39;</code>)ã€‚</li><li>å¯ä»¥æŒ‡å®šä¸€ä¸ªæ¢å¤ç›®æ ‡ï¼Œä¾‹å¦‚æ¢å¤åˆ°ç‰¹å®šæ—¶é—´ç‚¹ (<code>recovery_target_time</code>)ã€ç‰¹å®šäº‹åŠ¡ ID (<code>recovery_target_xid</code>) æˆ–å‘½åæ¢å¤ç‚¹ (<code>recovery_target_name</code>)ã€‚</li><li>å¯åŠ¨ PostgreSQL æœåŠ¡å™¨ã€‚å®ƒå°†è¿›å…¥æ¢å¤æ¨¡å¼ï¼Œé‡æ”¾åŸºç¡€å¤‡ä»½ä¹‹åå’Œæ¢å¤ç›®æ ‡ä¹‹å‰çš„æ‰€æœ‰ WAL æ—¥å¿—ã€‚</li></ol></li><li><strong>å·¥å…·</strong>ï¼š <ul><li><code>pg_basebackup</code>: ç”¨äºåˆ›å»ºåœ¨çº¿çš„åŸºç¡€å¤‡ä»½ã€‚</li><li><code>pg_receivewal</code>: ç”¨äºä»ä¸»æœåŠ¡å™¨æµå¼æ¥æ”¶ WAL æ–‡ä»¶å¹¶å­˜å‚¨å®ƒä»¬ã€‚</li><li><code>pgBackRest</code>, <code>Barman</code>, <code>WAL-G</code>: ä¸“é—¨çš„ç¬¬ä¸‰æ–¹å¤‡ä»½å’Œæ¢å¤ç®¡ç†å·¥å…·ï¼Œç®€åŒ–äº† PITR çš„è®¾ç½®å’Œç®¡ç†ï¼Œå¹¶æä¾›äº†æ›´å¤šé«˜çº§åŠŸèƒ½ï¼ˆå¦‚å¢é‡å¤‡ä»½ã€å¹¶è¡Œå¤‡ä»½/æ¢å¤ã€å‹ç¼©ã€äº‘å­˜å‚¨é›†æˆç­‰ï¼‰ã€‚</li></ul></li></ul></li></ul><p><strong>ç‰©ç†å¤‡ä»½çš„ä¼˜ç¼ºç‚¹ï¼š</strong></p><ul><li>ä¼˜ç‚¹ï¼šæ¢å¤é€Ÿåº¦é€šå¸¸æ¯”é€»è¾‘å¤‡ä»½å¿«å¾—å¤šï¼ˆç‰¹åˆ«æ˜¯å¯¹äºå¤§æ•°æ®åº“ï¼‰ï¼Œæ”¯æŒ PITRã€‚</li><li>ç¼ºç‚¹ï¼šå¤‡ä»½å¯èƒ½éå¸¸å¤§ï¼Œè®¾ç½® PITR ç›¸å¯¹å¤æ‚ä¸€äº›ï¼ˆå°½ç®¡æœ‰å·¥å…·å¯ä»¥ç®€åŒ–ï¼‰ã€‚åŸºç¡€å¤‡ä»½é€šå¸¸æ˜¯æ•´ä¸ªæ•°æ®ç›®å½•çš„å¤§å°ã€‚</li></ul><p><strong>4. Docker ç¯å¢ƒä¸‹çš„å¤‡ä»½ä¸æ¢å¤ï¼š</strong></p><p>å½“ PostgreSQL åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œæ—¶ï¼Œå¤‡ä»½å’Œæ¢å¤ç­–ç•¥éœ€è¦è€ƒè™‘å®¹å™¨çš„ç‰¹æ€§ã€‚</p><ul><li><p><strong>æ ¸å¿ƒåŸåˆ™</strong>ï¼šæ•°æ®åº”è¯¥å­˜å‚¨åœ¨ Docker å· (Volumes) ä¸­ï¼Œè€Œä¸æ˜¯å®¹å™¨çš„å¯å†™å±‚ï¼Œä»¥ç¡®ä¿æ•°æ®æŒä¹…æ€§ã€‚</p></li><li><p><strong>ä½¿ç”¨ <code>docker exec</code> æ‰§è¡Œ <code>pg_dump</code> / <code>pg_dumpall</code></strong>ï¼š<br> è¿™æ˜¯æœ€å¸¸è§çš„æ–¹æ³•ï¼Œç”¨äºé€»è¾‘å¤‡ä»½ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¤‡ä»½å•ä¸ªæ•°æ®åº“ (è¾“å‡ºåˆ°ä¸»æœº)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> your_postgres_container_name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg_dump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> your_pg_user</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> your_db_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/host/path/to/backup.sql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¤‡ä»½æ‰€æœ‰æ•°æ®åº“ (è¾“å‡ºåˆ°ä¸»æœº)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> your_postgres_container_name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg_dumpall</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> your_pg_user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/host/path/to/cluster_backup.sql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä½¿ç”¨è‡ªå®šä¹‰æ ¼å¼å¹¶è¾“å‡ºåˆ°å®¹å™¨å†…æ˜ å°„çš„å·ï¼Œç„¶åå†ä»ä¸»æœºè®¿é—®</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å‡è®¾å®¹å™¨å†… /backup ç›®å½•æ˜ å°„åˆ°ä¸»æœºçš„ /opt/pg_backups</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># docker run ... -v /opt/pg_backups:/backup ... postgres</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> your_postgres_container_name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg_dump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> your_pg_user</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Fc</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /backup/mydatabase.dump</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mydatabase</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ³¨æ„</strong>ï¼š<code>-t</code> (åˆ†é…ä¸€ä¸ªä¼ª TTY) å¯¹äº <code>pg_dump</code> è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºçš„æŸäº›æ ¼å¼ï¼ˆå¦‚è‡ªå®šä¹‰æ ¼å¼ï¼‰å¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ã€‚å¯¹äºç›´æ¥é‡å®šå‘åˆ°æ–‡ä»¶çš„ SQL æ ¼å¼æˆ–ä½¿ç”¨ <code>-f</code> é€‰é¡¹åœ¨å®¹å™¨å†…æŒ‡å®šè¾“å‡ºæ–‡ä»¶é€šå¸¸æ›´å®‰å…¨ã€‚</p></li><li><p><strong>æ¢å¤ä½¿ç”¨ <code>docker exec</code> å’Œ <code>psql</code> / <code>pg_restore</code></strong>ï¼š<br> å°†å¤‡ä»½æ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨å†…ï¼Œæˆ–è€…ä»æ˜ å°„çš„å·ä¸­è¯»å–ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ¢å¤ SQL æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 1. å°†å¤‡ä»½æ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨ (å¦‚æœä¸åœ¨å·ä¸­)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># docker cp /host/path/to/backup.sql your_postgres_container_name:/tmp/backup.sql</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 2. åœ¨å®¹å™¨å†…æ‰§è¡Œ psql</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># docker exec -i your_postgres_container_name psql -U your_pg_user -d new_db_name &lt; /host/path/to/backup.sql (ç›´æ¥ä»ä¸»æœº stdin)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æˆ–è€…ï¼Œå¦‚æœæ–‡ä»¶å·²åœ¨å®¹å™¨å†…ï¼š</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> your_postgres_container_name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> psql</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> your_pg_user</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> new_db_name</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /tmp/backup.sql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ¢å¤è‡ªå®šä¹‰æ ¼å¼æ–‡ä»¶ (å‡è®¾æ–‡ä»¶åœ¨å®¹å™¨çš„ /backup ç›®å½•)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> your_postgres_container_name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg_restore</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> your_pg_user</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> new_db_name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /backup/mydatabase.dump</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å¤‡ä»½ Docker å· (ç‰©ç†å±‚é¢ï¼Œä½†éœ€è°¨æ…)</strong>ï¼š<br> å¦‚æœ PostgreSQL æœåŠ¡å™¨åœ¨å®¹å™¨å†…åœæ­¢ï¼Œä½ å¯ä»¥ç›´æ¥å¤‡ä»½åŒ…å« <code>PGDATA</code> çš„ Docker å·çš„å†…å®¹ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å‡è®¾ PGDATA åœ¨åä¸º &#39;pgdata_volume&#39; çš„å·ä¸­</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 1. åœæ­¢ PostgreSQL å®¹å™¨</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> your_postgres_container_name</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 2. è¿è¡Œä¸€ä¸ªä¸´æ—¶å®¹å™¨æŒ‚è½½è¯¥å·ï¼Œå¹¶ä½¿ç”¨ tar å¤‡ä»½</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --rm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pgdata_volume:/data_to_backup</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /host/backup_dir:/backup</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> alpine</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       tar</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> czf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /backup/pgdata_backup.tar.gz</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -C</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /data_to_backup</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 3. (å¯é€‰) é‡æ–°å¯åŠ¨ PostgreSQL å®¹å™¨</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> your_postgres_container_name</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¢å¤æ—¶ï¼Œéœ€è¦å°†å¤‡ä»½è§£å‹åˆ°å·ä¸­ã€‚è¿™ç§æ–¹æ³•ç±»ä¼¼äºå†·ç‰©ç†å¤‡ä»½ã€‚</p></li><li><p><strong>ä½¿ç”¨ PITR å’Œ WAL å½’æ¡£</strong>ï¼š<br> å¯ä»¥åœ¨ Docker å®¹å™¨å†…é…ç½® PostgreSQL è¿›è¡Œ WAL å½’æ¡£ã€‚ä½ éœ€è¦ç¡®ä¿ WAL å½’æ¡£ç›®å½•å’ŒåŸºç¡€å¤‡ä»½çš„å­˜å‚¨ä½ç½®å¯¹äº PostgreSQL å®¹å™¨æ˜¯æŒä¹…ä¸”å¯è®¿é—®çš„ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡æ˜ å°„çš„ Docker å·æˆ–ä¸“ç”¨çš„å¤‡ä»½å®¹å™¨/æœåŠ¡ï¼‰ã€‚<br> åƒ <code>pgBackRest</code> è¿™æ ·çš„å·¥å…·ä¹Ÿå¯ä»¥åœ¨ Docker ç¯å¢ƒä¸­ä¸ PostgreSQL ä¸€èµ·éƒ¨ç½²å’Œä½¿ç”¨ï¼Œä»¥ç®¡ç† PITRã€‚</p></li><li><p><strong>è‡ªåŠ¨åŒ–</strong>ï¼š<br> ä½¿ç”¨ cron ä½œä¸šæˆ–ç¼–æ’å·¥å…·ï¼ˆå¦‚ Kubernetes CronJobsï¼‰æ¥å®šæœŸæ‰§è¡Œ <code>docker exec pg_dump ...</code> å‘½ä»¤ã€‚</p></li></ul><p><strong>é€‰æ‹©å¤‡ä»½ç­–ç•¥çš„å…³é”®è€ƒè™‘å› ç´ ï¼š</strong></p><ul><li><strong>RPO (Recovery Point Objective)</strong>ï¼šå¯æ¥å—çš„æœ€å¤§æ•°æ®ä¸¢å¤±é‡ã€‚PITR å¯ä»¥å®ç°éå¸¸ä½çš„ RPOã€‚</li><li><strong>RTO (Recovery Time Objective)</strong>ï¼šä»æ•…éšœåˆ°æ¢å¤æœåŠ¡æ‰€éœ€çš„æœ€é•¿æ—¶é—´ã€‚ç‰©ç†å¤‡ä»½é€šå¸¸æ¯”é€»è¾‘å¤‡ä»½å…·æœ‰æ›´çŸ­çš„ RTOã€‚</li><li><strong>æ•°æ®å¤§å°</strong>ã€‚</li><li><strong>å¯ç”¨å­˜å‚¨ç©ºé—´</strong>ã€‚</li><li><strong>ç³»ç»Ÿèµ„æºï¼ˆCPUã€I/Oï¼‰</strong>ã€‚</li><li><strong>æ“ä½œå¤æ‚æ€§</strong>ã€‚</li></ul><p>å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå¼ºçƒˆå»ºè®®å®æ–½ PITR ç­–ç•¥ï¼Œå¹¶å®šæœŸæµ‹è¯•å¤‡ä»½å’Œæ¢å¤è¿‡ç¨‹ã€‚ç¬¬ä¸‰æ–¹å·¥å…·å¦‚ <code>pgBackRest</code> å¯ä»¥å¤§å¤§ç®€åŒ–è¿™ä¸€è¿‡ç¨‹ã€‚</p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/ventixy/notebook/edit/main/src/posts/db/postgres.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">Last update: </span><!----></div><div class="contributors"><span class="vp-meta-label">Contributors: </span><!--[--><!--[--><span class="vp-meta-info" title="email: msdrizzle@outlook.com">drizzle</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/posts/db/ulimit.html" aria-label="MySQL5.7å†…å­˜å¼‚å¸¸"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->MySQL5.7å†…å­˜å¼‚å¸¸</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">Default footer</div><div class="vp-copyright">Copyright Â© 2025 ventixy </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BptLyOzL.js" defer></script>
  </body>
</html>
